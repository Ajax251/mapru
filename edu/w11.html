<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 Emulator Final</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root {
            --bg-color: #f3f3f3;
            --win-bg: rgba(255, 255, 255, 0.96);
            --win-border: rgba(255, 255, 255, 0.6);
            --taskbar-bg: rgba(243, 243, 243, 0.85);
            --primary-color: #0067c0;
            --glass-blur: blur(20px);
            --sel-color: #cce8ff;
            --hover-color: #e5f3ff;
        }

        * { box-sizing: border-box; user-select: none; margin: 0; padding: 0; outline: none; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            overflow: hidden; height: 100vh;
            background: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop') no-repeat center center/cover;
            display: flex; flex-direction: column;
        }

        .desktop { flex: 1; padding: 10px; display: flex; flex-direction: column; gap: 10px; z-index: 1; position: relative; align-items: flex-start; }
        .desktop-icon {
            width: 80px; display: flex; flex-direction: column; align-items: center;
            cursor: pointer; padding: 8px 5px; border-radius: 4px; color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7); transition: 0.2s;
        }
        .desktop-icon:hover { background: rgba(255,255,255,0.1); }
        .desktop-icon i { font-size: 32px; margin-bottom: 5px; color: #4db2ff; }
        .desktop-icon span { font-size: 12px; text-align: center; line-height: 1.2; }

        .taskbar {
            height: 48px; background: var(--taskbar-bg); backdrop-filter: var(--glass-blur);
            display: flex; justify-content: center; align-items: center; z-index: 9999;
            border-top: 1px solid rgba(255,255,255,0.4); position: relative;
        }
        .taskbar-icons { display: flex; gap: 6px; height: 100%; align-items: center; }
        .tb-icon {
            width: 40px; height: 40px; border-radius: 4px; display: flex;
            justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; position: relative;
        }
        .tb-icon:hover { background: rgba(255,255,255,0.5); }
        .tb-icon:active { transform: scale(0.9); }
        .tb-icon.active::after {
            content: ''; position: absolute; bottom: 3px; width: 6px; height: 3px;
            background: var(--primary-color); border-radius: 2px; transition: width 0.2s;
        }
        .tb-icon.active.open::after { width: 16px; }
        .tb-icon i { font-size: 24px; }
        .clock { position: absolute; right: 15px; text-align: right; font-size: 12px; color: #111; cursor: default;}

        .window {
            position: absolute; background: var(--win-bg); backdrop-filter: blur(25px);
            border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 1px solid #aaa; display: flex; flex-direction: column;
            overflow: hidden; opacity: 0; pointer-events: none; transform: scale(0.95);
            transition: opacity 0.2s, transform 0.2s, width 0.2s, height 0.2s, top 0.2s, left 0.2s, border-radius 0.2s;
        }
        .window.show { opacity: 1; pointer-events: auto; transform: scale(1); }
        .window.minimized { opacity: 0; pointer-events: none; transform: scale(0.7) translateY(200px); }
        .window.maximized {
            top: 0 !important; left: 0 !important; width: 100% !important; height: calc(100vh - 48px) !important;
            border-radius: 0; transform: none !important;
        }

        .win-header-strip {
            height: 32px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 0 0 10px; background: transparent; flex-shrink: 0;
        }
        .win-title { flex: 1; height: 100%; display: flex; align-items: center; font-size: 12px; gap: 10px; color: #444; }
        .win-controls { display: flex; height: 100%; z-index: 1000;}
        .win-btn { width: 46px; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .win-btn:hover { background: rgba(0,0,0,0.1); }
        .win-btn.close:hover { background: #e81123; color: white; }

        #explorer { width: 900px; height: 600px; top: 10%; left: 15%; }
        .exp-toolbar {
            height: 44px; display: flex; align-items: center; padding: 0 10px; gap: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.05); background: rgba(249,249,249,0.5); flex-shrink: 0;
        }
        .tool-btn {
            display: flex; align-items: center; gap: 8px; padding: 5px 10px;
            border-radius: 4px; cursor: pointer; font-size: 13px; border: 1px solid transparent;
        }
        .tool-btn:hover { background: rgba(0,0,0,0.05); }
        .tool-btn.primary { background: var(--primary-color); color: white; }
        .tool-btn.primary:hover { background: #005a9e; }
        
        .exp-body { flex: 1; display: flex; overflow: hidden; }
        .exp-sidebar { width: 200px; padding: 10px; display: flex; flex-direction: column; gap: 4px; background: rgba(255,255,255,0.4); border-right: 1px solid rgba(0,0,0,0.05); }
        .nav-item { padding: 8px 12px; border-radius: 4px; cursor: pointer; display: flex; gap: 10px; font-size: 14px; color: #444; align-items: center; }
        .nav-item:hover { background: rgba(0,0,0,0.05); }
        .nav-item.active { background: rgba(0,0,0,0.08); color: var(--primary-color); font-weight: 500; }
        .nav-item i { font-size: 18px; }

        .exp-content { flex: 1; padding: 15px; overflow-y: auto; background: white; }
        .file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 5px; }
        .file-item {
            display: flex; flex-direction: column; align-items: center; padding: 10px;
            border-radius: 4px; cursor: pointer; text-align: center; border: 1px solid transparent; position: relative;
        }
        .file-item:hover { background: var(--hover-color); }
        .file-item.selected { background: var(--sel-color); border-color: #99d1ff; }
        .file-icon { font-size: 42px; margin-bottom: 8px; }
        .file-name { font-size: 12px; word-break: break-word; line-height: 1.3; max-height: 34px; overflow: hidden; }

        #yandex { width: 1000px; height: 700px; top: 5%; left: 8%; background: #f0f2f5; }
        .ya-layout { display: flex; width: 100%; height: 100%; }
        .ya-sidebar { width: 44px; background: #fff; border-right: 1px solid #dfe1e5; display: flex; flex-direction: column; align-items: center; padding-top: 15px; }
        .ya-sidebar-icon { width: 28px; height: 28px; margin-bottom: 15px; cursor: pointer; border-radius: 50%; display: flex; justify-content: center; align-items: center; transition: 0.2s; font-size: 14px; color: #333; }
        .ya-sidebar-icon:hover { background: #eee; }
        .ya-alice { margin-top: auto; margin-bottom: 15px; background: #5e2887; color: white; font-weight: bold; font-size: 10px; }
        
        .ya-main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .ya-header { height: 74px; background: #dee1e6; display: flex; flex-direction: column; flex-shrink: 0; }
        .ya-tabs { height: 32px; display: flex; align-items: flex-end; padding-left: 10px; padding-right: 140px; } 
        .ya-tab { background: #fff; padding: 4px 15px; border-radius: 10px 10px 0 0; font-size: 12px; display: flex; align-items: center; min-width: 150px; position: relative; box-shadow: 0 -1px 2px rgba(0,0,0,0.05); }
        .ya-tab-favicon { width: 14px; height: 14px; background: red; border-radius: 50%; margin-right: 8px; color:white; display:flex; justify-content:center; align-items:center; font-size:8px; }
        
        .ya-nav { background: #fff; flex: 1; display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid #dfe1e5; }
        .ya-controls { display: flex; gap: 12px; margin-right: 15px; }
        .ya-btn { cursor: pointer; opacity: 0.6; border: none; background: none; font-size: 18px; }
        .ya-btn:hover { opacity: 1; }
        
        .ya-omnibox-wrap { flex: 1; display: flex; justify-content: center; }
        .ya-omnibox { width: 100%; max-width: 800px; height: 34px; background: #f2f2f2; border-radius: 18px; display: flex; align-items: center; padding: 0 15px; border: 2px solid transparent; transition: 0.2s; }
        .ya-omnibox:focus-within { background: #fff; border-color: #fc0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .ya-omnibox input { flex: 1; border: none; background: transparent; font-size: 14px; margin-left: 10px; }
        
        .ya-content { flex: 1; position: relative; background: #fff; }
        #ya-frame { width: 100%; height: 100%; border: none; }
        .ya-placeholder { position: absolute; inset: 0; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; }
        .ya-placeholder.hidden { display: none; }

        .browser-controls-overlay { position: absolute; top: 0; right: 0; display: flex; z-index: 2000; height: 32px; }

        #ctxMenu {
            position: absolute; width: 180px; background: #fcfcfc; 
            border: 1px solid #ccc; border-radius: 6px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none; flex-direction: column; padding: 4px; z-index: 99999;
        }
        .ctx-item { padding: 6px 10px; display: flex; align-items: center; gap: 10px; font-size: 13px; cursor: pointer; border-radius: 4px; color: #333; }
        .ctx-item:hover { background: var(--primary-color); color: white; }
        .ctx-sep { height: 1px; background: #ddd; margin: 3px 0; }

        #notepad { width: 600px; height: 450px; top: 15%; left: 30%; background: #fff; }
        .np-area { flex: 1; border: none; resize: none; padding: 10px; font-family: monospace; font-size: 14px; }
        .np-menu { padding: 5px 10px; border-bottom: 1px solid #eee; font-size: 12px; }

        .c-yellow { color: #ffe68e; }
        .c-blue { color: #4db2ff; }
        
        #photoviewer { width: 800px; height: 600px; top: 10%; left: 20%; background: #202020; border-color: #444; }
.pv-content { flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative; }
#pv-img { max-width: 100%; max-height: 100%; object-fit: contain; }
#photoviewer .win-title { color: #fff; }
#photoviewer .win-btn { color: #fff; }
#photoviewer .win-btn:hover { background: rgba(255,255,255,0.1); }
#photoviewer .win-btn.close:hover { background: #e81123; }
    </style>
</head>
<body>

 <div id="ctxMenu"></div>

    <div class="desktop" id="desktop" onclick="deselectAll()">
        <div class="desktop-icon" onclick="openApp('explorer')">
            <i class='bx bxs-folder'></i>
            <span>Этот компьютер</span>
        </div>
        <div class="desktop-icon" onclick="openApp('yandex')">
            <div style="width: 32px; height: 32px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 5px;">
                <span style="color: red; font-weight: bold; font-size: 18px;">Я</span>
            </div>
            <span>Yandex</span>
        </div>
    </div>

    <!-- Explorer -->
    <div class="window" id="explorer" onmousedown="focusWin('explorer')">
        <div class="win-header-strip" id="explorer-header">
            <div class="win-title"><i class='bx bxs-folder-open c-yellow'></i> Проводник</div>
            <div class="win-controls">
                <div class="win-btn" onclick="minWindow('explorer')"><i class='bx bx-minus'></i></div>
                <div class="win-btn" onclick="maxWindow('explorer')"><i class='bx bx-square'></i></div>
                <div class="win-btn close" onclick="closeWindow('explorer')"><i class='bx bx-x'></i></div>
            </div>
        </div>
        <div class="exp-toolbar">
            <div class="tool-btn" onclick="goUp()" title="Вверх"><i class='bx bx-up-arrow-alt' style="font-size:18px"></i></div>
            <div style="width:1px;height:20px;background:#ccc;margin:0 5px"></div>
            <div class="tool-btn primary" onclick="document.getElementById('file-upl').click()">
                <i class='bx bx-plus'></i> <span>Создать / Загрузить</span>
            </div>
            <input type="file" id="file-upl" style="display:none" multiple onchange="uploadFiles(event)">
            <div class="tool-btn" onclick="fsCreateFolder()" title="Новая папка"><i class='bx bx-folder-plus'></i></div>
            <div style="width:1px;height:20px;background:#ccc;margin:0 5px"></div>
            <div class="tool-btn" onclick="fsCut()" title="Вырезать"><i class='bx bx-cut'></i></div>
            <div class="tool-btn" onclick="fsCopy()" title="Копировать"><i class='bx bx-copy'></i></div>
            <div class="tool-btn" onclick="fsPaste()" title="Вставить"><i class='bx bx-paste'></i></div>
            <div style="width:1px;height:20px;background:#ccc;margin:0 5px"></div>
            <div class="tool-btn" onclick="fsDelete()" title="Удалить"><i class='bx bx-trash'></i></div>
        </div>
        <div class="exp-body">
            <div class="exp-sidebar">
    <div class="nav-item active" id="nav-desktop" onclick="navigate('desktop')">
        <i class='bx bx-desktop'></i> Рабочий стол
    </div>
    <div class="nav-item" id="nav-downloads" onclick="navigate('downloads')">
        <i class='bx bx-download'></i> Загрузки
    </div>
    <div class="nav-item" id="nav-documents" onclick="navigate('documents')">
        <i class='bx bx-file'></i> Документы
    </div>
    <div class="nav-item" id="nav-images" onclick="navigate('images')">
        <i class='bx bx-image'></i> Изображения
    </div>
    
    <!-- УБРАЛИ <div style="flex:1"></div> ЧТОБЫ КОРЗИНА БЫЛА ТУТ ЖЕ -->
    
    <div class="nav-item" id="nav-trash" onclick="navigate('trash')">
        <i class='bx bxs-trash'></i> Корзина
    </div>
</div>
            <div class="exp-content" id="file-view" onclick="event.stopPropagation(); deselectAll()"></div>
        </div>
    </div> 
   

    <!-- Yandex -->
    <div class="window" id="yandex" onmousedown="focusWin('yandex')">
        <div class="ya-layout">
            <div class="ya-sidebar">
                <div class="ya-sidebar-icon" title="Яндекс">Я</div>
                <div class="ya-sidebar-icon" title="Избранное">★</div>
                <div class="ya-sidebar-icon" title="История">H</div>
                <div class="ya-sidebar-icon ya-alice" title="Алиса">A</div>
            </div>
            <div class="ya-main">
                <div class="browser-controls-overlay">
                    <div class="win-btn" onclick="minWindow('yandex')"><i class='bx bx-minus'></i></div>
                    <div class="win-btn" onclick="maxWindow('yandex')"><i class='bx bx-square'></i></div>
                    <div class="win-btn close" onclick="closeWindow('yandex')"><i class='bx bx-x'></i></div>
                </div>

                <div class="ya-header" id="yandex-header">
                    <div class="ya-tabs">
                        <div class="ya-tab">
                            <div class="ya-tab-favicon">Я</div>
                            <span id="ya-tab-title">Новая вкладка</span>
                        </div>
                        <div style="padding: 0 10px; cursor: pointer; color:#666">+</div>
                    </div>
                    <div class="ya-nav">
                        <div class="ya-controls">
                            <button class="ya-btn" onclick="document.getElementById('ya-frame').contentWindow.history.back()">←</button>
                            <button class="ya-btn" onclick="document.getElementById('ya-frame').contentWindow.history.forward()">→</button>
                            <button class="ya-btn" onclick="yaNavigate()">↻</button>
                        </div>
                        <div class="ya-omnibox-wrap">
                            <div class="ya-omnibox">
                                <i class='bx bxs-lock-alt' style="color:#00b341; margin-right:5px"></i>
                                <input type="text" id="ya-url" placeholder="Введите адрес или запрос" onkeydown="if(event.key==='Enter') yaNavigate()">
                                <button class="ya-btn" style="font-size:14px; margin-left:5px" onclick="yaNavigate()">➜</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ya-content">
                    <div class="ya-placeholder" id="ya-placeholder">
                        <div style="font-size: 60px; font-weight: bold; color: #000;"><span style="color:red">Я</span>ндекс</div>
                        <p style="margin-top:20px; color:#666">Поиск</p>
                    </div>
                    <iframe id="ya-frame" sandbox="allow-forms allow-scripts allow-same-origin allow-popups" src=""></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Notepad -->
    <div class="window" id="notepad" onmousedown="focusWin('notepad')">
        <div class="win-header-strip" id="notepad-header">
            <div class="win-title"><i class='bx bxs-notepad c-blue'></i> Блокнот</div>
            <div class="win-controls">
                <div class="win-btn" onclick="minWindow('notepad')"><i class='bx bx-minus'></i></div>
                <div class="win-btn" onclick="maxWindow('notepad')"><i class='bx bx-square'></i></div>
                <div class="win-btn close" onclick="closeWindow('notepad')"><i class='bx bx-x'></i></div>
            </div>
        </div>
        <div class="np-menu">
            <span style="margin-right:15px; cursor:pointer;" onclick="saveNotepad()"><b>Файл</b> (Сохранить)</span>
            <span>Правка</span>
        </div>
        <textarea class="np-area" id="np-text"></textarea>
    </div>

<div class="window" id="photoviewer" onmousedown="focusWin('photoviewer')">
    <div class="win-header-strip" id="photoviewer-header">
        <div class="win-title"><i class='bx bxs-image c-blue'></i> Фотографии</div>
        <div class="win-controls">
            <div class="win-btn" onclick="minWindow('photoviewer')"><i class='bx bx-minus'></i></div>
            <div class="win-btn" onclick="maxWindow('photoviewer')"><i class='bx bx-square'></i></div>
            <div class="win-btn close" onclick="closeWindow('photoviewer')"><i class='bx bx-x'></i></div>
        </div>
    </div>
    <div class="pv-content">
        <img id="pv-img" src="" alt="Image">
    </div>
</div>
    <!-- Taskbar -->
    <div class="taskbar">
        <div class="taskbar-icons">
            <div class="tb-icon" title="Пуск"><i class='bx bxl-windows c-blue'></i></div>
            <div class="tb-icon" id="tb-photoviewer" onclick="openApp('photoviewer')" title="Фотографии" style="display:none"><i class='bx bxs-image c-blue'></i></div>
            <div class="tb-icon" id="tb-explorer" onclick="openApp('explorer')" title="Проводник"><i class='bx bxs-folder c-yellow'></i></div>
            <div class="tb-icon" id="tb-yandex" onclick="openApp('yandex')" title="Yandex"><span style="color:red; background:white; width:18px; height:18px; border-radius:50%; text-align:center; font-weight:bold; font-size:12px; line-height:18px;">Я</span></div>
            <div class="tb-icon" id="tb-notepad" onclick="openApp('notepad')" title="Блокнот" style="display:none"><i class='bx bxs-notepad c-blue'></i></div>
        </div>
        <div class="clock" id="clock">12:00<br>29.11.2025</div>
    </div>


    <script>
        let fs = [
            { id: 'f1', parent: 'desktop', name: 'Проект', type: 'folder' },
            { id: 'f2', parent: 'documents', name: 'Резюме.txt', type: 'txt', content: 'Иван Иванов' },
            { id: 'f3', parent: 'f1', name: 'ТЗ.txt', type: 'txt', content: 'Техническое задание' },
            { id: 'f4', parent: 'downloads', name: 'Installer.exe', type: 'exe', content: null },
         { id: 'f5', parent: 'images', name: 'Природа.jpg', type: 'img', src: 'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=2070&auto=format&fit=crop' }
        ];

        let currentPath = 'desktop';
        let navHistory = []; 
        let selectedFileIds = [];
        let clipboard = null;
        let openFileId = null;

        const fileView = document.getElementById('file-view');

        function navigate(path) {
            currentPath = path;
            navHistory = [];
            selectedFileIds = [];
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const nav = document.getElementById('nav-' + path);
            if(nav) nav.classList.add('active');
            renderFiles();
        }

        function enterFolder(id) {
            navHistory.push(currentPath);
            currentPath = id;
            selectedFileIds = [];
            renderFiles();
        }

        function goUp() {
            if(navHistory.length > 0) {
                currentPath = navHistory.pop();
                selectedFileIds = [];
                renderFiles();
            }
        }

        function renderFiles() {
            fileView.innerHTML = '';
            const files = fs.filter(f => f.parent === currentPath);
            if (files.length === 0) {
                fileView.innerHTML = `<div style="text-align:center; color:#888; margin-top:50px;">${currentPath==='trash'?'Корзина пуста':'Папка пуста'}</div>`;
                return;
            }
            const grid = document.createElement('div');
            grid.className = 'file-grid';
            files.forEach(f => {
                const item = document.createElement('div');
                item.className = `file-item ${selectedFileIds.includes(f.id) ? 'selected' : ''}`;
                item.innerHTML = `${getIcon(f.type)}<span class="file-name">${f.name}</span>`;
                item.onclick = (e) => selectFile(e, f.id);
                item.ondblclick = () => openFile(f);
                item.oncontextmenu = (e) => showContext(e, f);
                grid.appendChild(item);
            });
            fileView.appendChild(grid);
        }

        function getIcon(type) {
            if(type === 'folder') return `<i class='bx bxs-folder file-icon c-yellow'></i>`;
            if(type === 'img') return `<i class='bx bxs-image file-icon c-blue'></i>`;
            if(type === 'txt') return `<i class='bx bxs-file-txt file-icon' style="color:#888"></i>`;
            if(type === 'exe') return `<i class='bx bxs-cube file-icon' style="color:#0078d7"></i>`;
            return `<i class='bx bx-file file-icon' style="color:#aaa"></i>`;
        }

        function selectFile(e, id) {
            e.stopPropagation();
            if(e.ctrlKey) {
                if(selectedFileIds.includes(id)) selectedFileIds = selectedFileIds.filter(i => i !== id);
                else selectedFileIds.push(id);
            } else {
                selectedFileIds = [id];
            }
            renderFiles();
        }

        function deselectAll() { selectedFileIds = []; renderFiles(); }

     function openFile(file) {
    if(file.type === 'folder') enterFolder(file.id);
    else if (file.type === 'txt') openApp('notepad', file);
    else if (file.type === 'img') openApp('photoviewer', file);
    else if (file.type === 'exe') alert("Приложение запущено");
    else alert("Файл не поддерживается");
}

        function fsCreateFolder() {
            const name = prompt("Имя папки:", "Новая папка");
            if(name) {
                fs.push({ id: 'd_'+Date.now(), parent: currentPath, name: name, type: 'folder' });
                renderFiles();
            }
        }

        function fsDelete() {
            if(selectedFileIds.length === 0) return;
            const toDel = [...selectedFileIds];
            fs.forEach(file => {
                if(toDel.includes(file.id)) {
                    if(currentPath === 'trash') file._del = true;
                    else file.parent = 'trash';
                }
            });
            fs = fs.filter(f => !f._del);
            selectedFileIds = [];
            renderFiles();
        }

        function uploadFiles(e) {
            Array.from(e.target.files).forEach(f => {
                const type = f.name.endsWith('.txt') ? 'txt' : (f.type.startsWith('image') ? 'img' : 'file');
                const reader = new FileReader();
                reader.onload = (res) => {
                    fs.push({ id: 'u_'+Date.now()+Math.random(), parent: currentPath, name: f.name, type: type, content: res.target.result });
                    renderFiles();
                };
                if(type==='txt') reader.readAsText(f); else reader.readAsDataURL(f);
            });
        }

        function downloadFile(id) {
            const f = fs.find(x => x.id === id);
            if(!f) return;
            const blob = new Blob([f.content || ""], {type: "text/plain"});
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = f.name;
            a.click();
        }

        const ctxMenu = document.getElementById('ctxMenu');
        function showContext(e, file) {
            e.preventDefault(); e.stopPropagation();
            if(!selectedFileIds.includes(file.id)) { selectedFileIds = [file.id]; renderFiles(); }
            ctxMenu.style.display = 'flex';
            ctxMenu.style.left = e.pageX + 'px';
            ctxMenu.style.top = e.pageY + 'px';
            let h = `<div class="ctx-item" onclick="downloadFile('${file.id}')"><i class='bx bx-download'></i> Загрузить</div>`;
            if(file.type === 'txt') h += `<div class="ctx-item" onclick="openFile(fs.find(x=>x.id=='${file.id}'))"><i class='bx bx-edit'></i> Блокнот</div>`;
            h += `<div class="ctx-sep"></div><div class="ctx-item" onclick="fsDelete()"><i class='bx bx-trash'></i> Удалить</div>`;
            ctxMenu.innerHTML = h;
        }
        document.addEventListener('click', () => ctxMenu.style.display = 'none');

        let zIndex = 100;
     
function openApp(id, data = null) {
    const win = document.getElementById(id);
    const tb = document.getElementById('tb-' + id);
    win.style.display = 'flex';
    setTimeout(() => { win.classList.remove('minimized'); win.classList.add('show'); }, 10);
    focusWin(id);
    if(tb) { tb.style.display = 'flex'; tb.classList.add('active', 'open'); }
    if(id === 'explorer') renderFiles();
    if(id === 'notepad') {
        const area = document.getElementById('np-text');
        if(data) { area.value = data.content || ""; openFileId = data.id; }
        else { area.value = ""; openFileId = null; }
    }
    if(id === 'photoviewer' && data) {
        document.getElementById('pv-img').src = data.content || data.src || '';
    }
}

        function closeWindow(id) {
            const win = document.getElementById(id);
            win.classList.remove('show');
            setTimeout(() => { win.style.display = 'none'; win.classList.remove('maximized'); }, 200);
            const tb = document.getElementById('tb-' + id);
            if(tb) { tb.classList.remove('active', 'open'); if(id === 'notepad') setTimeout(()=>tb.style.display='none', 200); }
        }

        function minWindow(id) { document.getElementById(id).classList.add('minimized'); document.getElementById('tb-' + id).classList.remove('active'); }
        function maxWindow(id) { document.getElementById(id).classList.toggle('maximized'); }
        function focusWin(id) {
            document.getElementById(id).style.zIndex = ++zIndex;
            document.querySelectorAll('.tb-icon').forEach(t => t.classList.remove('active'));
            const tb = document.getElementById('tb-' + id);
            if(tb) tb.classList.add('active');
        }

        function makeDraggable(winId, handleId) {
            const win = document.getElementById(winId);
            const handle = document.getElementById(handleId);
            let isDragging = false, startX, startY, initLeft, initTop;
            handle.addEventListener('mousedown', e => {
                if(e.target.closest('.win-btn') || e.target.tagName === 'INPUT' || win.classList.contains('maximized')) return;
                isDragging = true; startX = e.clientX; startY = e.clientY;
                const rect = win.getBoundingClientRect(); initLeft = rect.left; initTop = rect.top;
                focusWin(winId);
            });
            window.addEventListener('mousemove', e => {
                if(!isDragging) return;
                win.style.left = (initLeft + e.clientX - startX) + 'px';
                win.style.top = (initTop + e.clientY - startY) + 'px';
            });
            window.addEventListener('mouseup', () => isDragging = false);
        }

        makeDraggable('explorer', 'explorer-header');
        makeDraggable('notepad', 'notepad-header');
        makeDraggable('yandex', 'yandex-header');

        function saveNotepad() {
            const val = document.getElementById('np-text').value;
            if(openFileId) { const f = fs.find(x => x.id === openFileId); if(f) f.content = val; }
            else { fs.push({ id: 'n_'+Date.now(), parent: 'desktop', name: 'New.txt', type: 'txt', content: val }); renderFiles(); }
            alert("Сохранено!");
        }

        function yaNavigate() {
            const inp = document.getElementById('ya-url');
            const frame = document.getElementById('ya-frame');
            const ph = document.getElementById('ya-placeholder');
            const tabTitle = document.getElementById('ya-tab-title');
            let url = inp.value.trim();
            if(!url) return;
            if(!url.startsWith('http')) {
                if(url.includes('.')) url = 'https://' + url;
                else url = 'https://www.bing.com/search?q=' + encodeURIComponent(url);
            }
            ph.classList.add('hidden');
            frame.src = url;
            tabTitle.innerText = url.replace('https://','').substring(0, 15) + '...';
        }


            function fsCopy() {
        if(selectedFileIds.length > 0) {
            // Запоминаем ID файлов и режим "copy"
            clipboard = { mode: 'copy', ids: [...selectedFileIds] };
        }
    }

    function fsCut() {
        if(selectedFileIds.length > 0) {
            // Запоминаем ID файлов и режим "cut"
            clipboard = { mode: 'cut', ids: [...selectedFileIds] };
        }
    }

    function fsPaste() {
        if(!clipboard) return;
        
        clipboard.ids.forEach(id => {
            const file = fs.find(f => f.id === id);
            if(file) {
                if(clipboard.mode === 'cut') {
                    // Перемещение: просто меняем родительскую папку
                    file.parent = currentPath;
                } else {
                    // Копирование: создаем новый объект файла
                    const newFile = {
                        ...file,
                        id: 'copy_' + Date.now() + Math.random().toString(36).substr(2, 5), // Уникальный ID
                        parent: currentPath,
                        // Можно добавить префикс, если копируем в ту же папку, но Windows разрешает дубли имен с индексами
                        // Для простоты оставляем имя как есть
                    };
                    fs.push(newFile);
                }
            }
        });

        // Если вырезали, очищаем буфер после вставки (однократная вставка)
        if(clipboard.mode === 'cut') clipboard = null;
        
        renderFiles();
    }
    
    
         setInterval(() => {
            const d = new Date();
            document.getElementById('clock').innerHTML = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) + '<br>' + d.toLocaleDateString();
        }, 1000);

        navigate('desktop');
        makeDraggable('photoviewer', 'photoviewer-header');
    </script>
</body>
</html>