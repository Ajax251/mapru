<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –≥–ª–∞–∑</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.8);
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.5);
            --success: #10b981;
            --warning: #f59e0b;
            --text: #f3f4f6;
            --text-muted: #9ca3af;
            --border: rgba(255, 255, 255, 0.1);
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            overflow: hidden;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header h2 {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text);
        }

        .sidebar-header p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .exercise-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .exercise-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 5px;
        }

        .exercise-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .exercise-item.active {
            background: var(--accent);
        }

        .exercise-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .exercise-item.active .exercise-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .exercise-info h3 {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .exercise-info span {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .exercise-item.active .exercise-info span {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Exercise Area */
        .exercise-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(ellipse at center, #1a2332 0%, var(--bg-primary) 70%);
        }

        .exercise-canvas {
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 800px;
            position: relative;
        }

        /* Controls */
        .controls {
            padding: 20px 30px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .control-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 25px;
            border: none;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: scale(1.02);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 300;
            color: var(--accent);
            min-width: 100px;
            text-align: center;
            font-variant-numeric: tabular-nums;
        }

        .progress-info {
            text-align: right;
        }

        .progress-info .cycle {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .progress-info .label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Instructions Overlay */
        .instruction-overlay {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            padding: 15px 30px;
            border-radius: 15px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            text-align: center;
            max-width: 500px;
        }

        .instruction-overlay h4 {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .instruction-overlay p {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Exercise Specific Styles */
        
        /* Focus Dot */
        .focus-dot {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 30px var(--accent-glow), 0 0 60px var(--accent-glow);
            transition: all 0.1s linear;
        }

        .focus-dot.large {
            width: 50px;
            height: 50px;
        }

        .focus-dot-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        /* Circle Path */
        .circle-path {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Figure 8 Path */
        .figure8-path {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 200px;
        }

        /* Near-Far Objects */
        .near-far-object {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 1s ease-in-out;
            box-shadow: 0 0 40px var(--accent-glow);
        }

        /* Blink Indicator */
        .blink-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 4px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            transition: all 0.3s ease;
        }

        .blink-indicator.blink {
            background: var(--accent);
            transform: translate(-50%, -50%) scale(0.8);
        }

        /* Palming Screen */
        .palming-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        .palming-screen .hands {
            font-size: 5rem;
            opacity: 0.3;
        }

        .palming-screen .breathing-guide {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* 20-20-20 */
        .rule-display {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .rule-item {
            text-align: center;
        }

        .rule-item .number {
            font-size: 4rem;
            font-weight: 600;
            color: var(--accent);
            line-height: 1;
        }

        .rule-item .unit {
            font-size: 1rem;
            color: var(--text-muted);
        }

        /* Corner Focus */
        .corner-dots {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .corner-dot {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .corner-dot.active {
            background: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
            transform: scale(1.2);
        }

        .corner-dot.top-left { top: 50px; left: 50px; }
        .corner-dot.top-right { top: 50px; right: 50px; }
        .corner-dot.bottom-left { bottom: 50px; left: 50px; }
        .corner-dot.bottom-right { bottom: 50px; right: 50px; }
        .corner-dot.center { top: 50%; left: 50%; transform: translate(-50%, -50%); }

        /* Zoom Exercise */
        .zoom-target {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            transition: all 2s ease-in-out;
        }

        /* Color Therapy */
        .color-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: background-color 3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-name {
            font-size: 2rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.7);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Schulte Table */
        .schulte-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            width: 400px;
            height: 400px;
        }

        .schulte-cell {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .schulte-cell:hover {
            border-color: var(--accent);
        }

        .schulte-cell.correct {
            background: var(--success);
            border-color: var(--success);
        }

        .schulte-cell.wrong {
            background: #ef4444;
            border-color: #ef4444;
            animation: shake 0.3s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .schulte-target {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .schulte-target span {
            color: var(--accent);
            font-weight: 600;
            font-size: 1.5rem;
        }

        /* Peripheral Vision */
        .peripheral-display {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .peripheral-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
        }

        .peripheral-target {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .peripheral-target.visible {
            opacity: 1;
        }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .exercise-list {
                display: flex;
                overflow-x: auto;
                padding: 10px;
                gap: 10px;
            }

            .exercise-item {
                flex-shrink: 0;
                flex-direction: column;
                text-align: center;
                padding: 10px;
                min-width: 100px;
            }

            .exercise-info span {
                display: none;
            }

            .controls {
                flex-wrap: wrap;
                padding: 15px;
            }

            .instruction-overlay {
                bottom: 10px;
                padding: 10px 20px;
                max-width: 90%;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üëÅÔ∏è –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –≥–ª–∞–∑</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</p>
            </div>
            <div class="exercise-list" id="exerciseList"></div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="exercise-area">
                <div class="exercise-canvas" id="exerciseCanvas"></div>
                <div class="instruction-overlay" id="instructionOverlay">
                    <h4 id="instructionTitle">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h4>
                    <p id="instructionText">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-left">
                    <button class="btn btn-primary" id="startBtn">
                        <span>‚ñ∂</span> –ù–∞—á–∞—Ç—å
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <span>‚Ü∫</span> –°–±—Ä–æ—Å
                    </button>
                </div>
                <div class="timer-display" id="timerDisplay">0:00</div>
                <div class="progress-info">
                    <div class="cycle" id="cycleCount">0</div>
                    <div class="label">—Ü–∏–∫–ª–æ–≤</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Exercise Data
        const exercises = [
            {
                id: 'circular',
                name: '–ö—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è',
                icon: 'üîÑ',
                duration: '2 –º–∏–Ω',
                description: '–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–æ—á–∫–æ–π, –¥–≤–∏–∂—É—â–µ–π—Å—è –ø–æ –∫—Ä—É–≥—É',
                instruction: '–î–µ—Ä–∂–∏—Ç–µ –≥–æ–ª–æ–≤—É –Ω–µ–ø–æ–¥–≤–∏–∂–Ω–æ. –°–ª–µ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –≥–ª–∞–∑–∞–º–∏ –∑–∞ –¥–≤–∏–∂—É—â–µ–π—Å—è —Ç–æ—á–∫–æ–π.',
                cycleDuration: 8000
            },
            {
                id: 'figure8',
                name: '–í–æ—Å—å–º—ë—Ä–∫–∞',
                icon: '‚àû',
                duration: '2 –º–∏–Ω',
                description: '–î–≤–∏–∂–µ–Ω–∏–µ –≥–ª–∞–∑ –ø–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –≤–æ—Å—å–º—ë—Ä–∫–∏',
                instruction: '–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–æ—á–∫–æ–π, —Ä–∏—Å—É—é—â–µ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –≤–æ—Å—å–º—ë—Ä–∫—É. –≠—Ç–æ —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—Ç –≥–ª–∞–∑–Ω—ã–µ –º—ã—à—Ü—ã.',
                cycleDuration: 6000
            },
            {
                id: 'nearfar',
                name: '–ë–ª–∏–∑–∫–æ-–¥–∞–ª–µ–∫–æ',
                icon: 'üîç',
                duration: '3 –º–∏–Ω',
                description: '–§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è—Ö',
                instruction: '–§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –æ–±—ä–µ–∫—Ç–µ, –∫–æ–≥–¥–∞ –æ–Ω –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∏ —É–¥–∞–ª—è–µ—Ç—Å—è. –≠—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç –∞–∫–∫–æ–º–æ–¥–∞—Ü–∏—é.',
                cycleDuration: 6000
            },
            {
                id: 'blink',
                name: '–û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ',
                icon: 'üòå',
                duration: '1 –º–∏–Ω',
                description: '–†–∏—Ç–º–∏—á–Ω–æ–µ –º–æ—Ä–≥–∞–Ω–∏–µ –¥–ª—è —É–≤–ª–∞–∂–Ω–µ–Ω–∏—è',
                instruction: '–ú–æ—Ä–≥–∞–π—Ç–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∫—Ä—É–≥ —Å–∂–∏–º–∞–µ—Ç—Å—è. –≠—Ç–æ —É–≤–ª–∞–∂–Ω—è–µ—Ç –≥–ª–∞–∑–∞ –∏ —Å–Ω–∏–º–∞–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
                cycleDuration: 3000
            },
            {
                id: 'palming',
                name: '–ü–∞–ª—å–º–∏–Ω–≥',
                icon: 'üôå',
                duration: '2 –º–∏–Ω',
                description: '–ü–æ–ª–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –≥–ª–∞–∑ –≤ —Ç–µ–º–Ω–æ—Ç–µ',
                instruction: '–ó–∞–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞ –ª–∞–¥–æ–Ω—è–º–∏, –Ω–µ –¥–∞–≤—è –Ω–∞ –Ω–∏—Ö. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –≥–ª—É–±–æ–∫—É—é —á–µ—Ä–Ω–æ—Ç—É –∏ –¥—ã—à–∏—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ.',
                cycleDuration: 120000
            },
            {
                id: 'rule2020',
                name: '–ü—Ä–∞–≤–∏–ª–æ 20-20-20',
                icon: '‚è±Ô∏è',
                duration: '20 —Å–µ–∫',
                description: '–í–∑–≥–ª—è–¥ –≤–¥–∞–ª—å –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç',
                instruction: '–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ–±—ä–µ–∫—Ç –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ 6 –º–µ—Ç—Ä–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ 20 —Å–µ–∫—É–Ω–¥. –î–µ–ª–∞–π—Ç–µ —ç—Ç–æ –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã.',
                cycleDuration: 20000
            },
            {
                id: 'corners',
                name: '–î–∏–∞–≥–æ–Ω–∞–ª–∏',
                icon: '‚ÜóÔ∏è',
                duration: '2 –º–∏–Ω',
                description: '–î–≤–∏–∂–µ–Ω–∏–µ –≥–ª–∞–∑ –ø–æ —É–≥–ª–∞–º',
                instruction: '–ü–µ—Ä–µ–≤–æ–¥–∏—Ç–µ –≤–∑–≥–ª—è–¥ –º–µ–∂–¥—É —É–≥–ª–∞–º–∏ —ç–∫—Ä–∞–Ω–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –≤ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ –Ω–∞ —Å–µ–∫—É–Ω–¥—É.',
                cycleDuration: 8000
            },
            {
                id: 'zoom',
                name: '–ó—É–º-—Ñ–æ–∫—É—Å',
                icon: 'üéØ',
                duration: '2 –º–∏–Ω',
                description: '–ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ñ–æ–∫—É—Å–∞',
                instruction: '–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø–∞–ª–µ—Ü –ø–µ—Ä–µ–¥ –Ω–æ—Å–æ–º, –∑–∞—Ç–µ–º –Ω–∞ –¥–∞–ª—å–Ω–∏–π –æ–±—ä–µ–∫—Ç. –ü–ª–∞–≤–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ —Ñ–æ–∫—É—Å.',
                cycleDuration: 4000
            },
            {
                id: 'color',
                name: '–¶–≤–µ—Ç–æ—Ç–µ—Ä–∞–ø–∏—è',
                icon: 'üé®',
                duration: '3 –º–∏–Ω',
                description: '–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–µ —Ü–≤–µ—Ç–∞',
                instruction: '–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω, –ø–æ–∑–≤–æ–ª—è—è –≥–ª–∞–∑–∞–º —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è. –ó–µ–ª—ë–Ω—ã–π –∏ —Å–∏–Ω–∏–π —Ü–≤–µ—Ç–∞ —Å–Ω–∏–º–∞—é—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
                cycleDuration: 5000
            },
            {
                id: 'schulte',
                name: '–¢–∞–±–ª–∏—Ü–∞ –®—É–ª—å—Ç–µ',
                icon: 'üî¢',
                duration: '‚àû',
                description: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–∏—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑—Ä–µ–Ω–∏—è',
                instruction: '–°–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ü–µ–Ω—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ —á–∏—Å–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–∏—Ñ–µ—Ä–∏—á–µ—Å–∫–æ–µ –∑—Ä–µ–Ω–∏–µ.',
                cycleDuration: null
            },
            {
                id: 'peripheral',
                name: '–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è',
                icon: 'üëÄ',
                duration: '2 –º–∏–Ω',
                description: '–ó–∞–º–µ—á–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã –±–æ–∫–æ–≤—ã–º –∑—Ä–µ–Ω–∏–µ–º',
                instruction: '–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É. –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–ª–∞–≤–∏—à—É, –∫–æ–≥–¥–∞ –∑–∞–º–µ—á–∞–µ—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Å–±–æ–∫—É.',
                cycleDuration: 3000
            },
            {
                id: 'squeeze',
                name: '–ó–∞–∂–º—É—Ä–∏–≤–∞–Ω–∏–µ',
                icon: 'üò£',
                duration: '1 –º–∏–Ω',
                description: '–°–Ω—è—Ç–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∂–∞—Ç–∏–µ',
                instruction: '–°–∏–ª—å–Ω–æ –∑–∞–∂–º—É—Ä—å—Ç–µ—Å—å –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã, –∑–∞—Ç–µ–º —à–∏—Ä–æ–∫–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞. –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ —Ä–∏—Ç–º–∏—á–Ω–æ.',
                cycleDuration: 6000
            }
        ];

        // State
        let currentExercise = null;
        let isRunning = false;
        let animationId = null;
        let startTime = null;
        let cycles = 0;
        let timerInterval = null;

        // DOM Elements
        const exerciseList = document.getElementById('exerciseList');
        const exerciseCanvas = document.getElementById('exerciseCanvas');
        const instructionTitle = document.getElementById('instructionTitle');
        const instructionText = document.getElementById('instructionText');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const cycleCount = document.getElementById('cycleCount');

        // Initialize
        function init() {
            renderExerciseList();
            
            startBtn.addEventListener('click', toggleExercise);
            resetBtn.addEventListener('click', resetExercise);
            
            // Keyboard controls for peripheral exercise
            document.addEventListener('keydown', handleKeyPress);
        }

        function renderExerciseList() {
            exerciseList.innerHTML = exercises.map((ex, index) => `
                <div class="exercise-item ${index === 0 ? '' : ''}" data-id="${ex.id}">
                    <div class="exercise-icon">${ex.icon}</div>
                    <div class="exercise-info">
                        <h3>${ex.name}</h3>
                        <span>${ex.duration}</span>
                    </div>
                </div>
            `).join('');

            exerciseList.querySelectorAll('.exercise-item').forEach(item => {
                item.addEventListener('click', () => selectExercise(item.dataset.id));
            });
        }

        function selectExercise(id) {
            stopExercise();
            
            currentExercise = exercises.find(ex => ex.id === id);
            
            // Update UI
            exerciseList.querySelectorAll('.exercise-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === id);
            });

            instructionTitle.textContent = currentExercise.name;
            instructionText.textContent = currentExercise.instruction;

            // Setup exercise canvas
            setupExercise(id);
        }

        function setupExercise(id) {
            exerciseCanvas.innerHTML = '';
            cycles = 0;
            cycleCount.textContent = '0';
            timerDisplay.textContent = '0:00';

            switch(id) {
                case 'circular':
                    setupCircularExercise();
                    break;
                case 'figure8':
                    setupFigure8Exercise();
                    break;
                case 'nearfar':
                    setupNearFarExercise();
                    break;
                case 'blink':
                    setupBlinkExercise();
                    break;
                case 'palming':
                    setupPalmingExercise();
                    break;
                case 'rule2020':
                    setupRule2020Exercise();
                    break;
                case 'corners':
                    setupCornersExercise();
                    break;
                case 'zoom':
                    setupZoomExercise();
                    break;
                case 'color':
                    setupColorExercise();
                    break;
                case 'schulte':
                    setupSchulteExercise();
                    break;
                case 'peripheral':
                    setupPeripheralExercise();
                    break;
                case 'squeeze':
                    setupSqueezeExercise();
                    break;
            }
        }

        function toggleExercise() {
            if (!currentExercise) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
                return;
            }

            if (isRunning) {
                stopExercise();
            } else {
                startExercise();
            }
        }

        function startExercise() {
            isRunning = true;
            startTime = Date.now();
            startBtn.innerHTML = '<span>‚è∏</span> –ü–∞—É–∑–∞';
            
            startTimer();
            runExercise(currentExercise.id);
        }

        function stopExercise() {
            isRunning = false;
            startBtn.innerHTML = '<span>‚ñ∂</span> –ù–∞—á–∞—Ç—å';
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetExercise() {
            stopExercise();
            cycles = 0;
            cycleCount.textContent = '0';
            timerDisplay.textContent = '0:00';
            if (currentExercise) {
                setupExercise(currentExercise.id);
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!isRunning) return;
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const mins = Math.floor(elapsed / 60);
                const secs = elapsed % 60;
                timerDisplay.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function incrementCycle() {
            cycles++;
            cycleCount.textContent = cycles;
        }

        // ==================== EXERCISE IMPLEMENTATIONS ====================

        // 1. Circular Movement
        function setupCircularExercise() {
            const size = Math.min(exerciseCanvas.offsetWidth, exerciseCanvas.offsetHeight) * 0.7;
            exerciseCanvas.innerHTML = `
                <div class="circle-path" style="width: ${size}px; height: ${size}px;"></div>
                <div class="focus-dot" id="focusDot"><div class="focus-dot-inner"></div></div>
            `;
        }

        function runCircularExercise() {
            const dot = document.getElementById('focusDot');
            if (!dot) return;
            
            const canvas = exerciseCanvas;
            const radius = Math.min(canvas.offsetWidth, canvas.offsetHeight) * 0.35;
            const centerX = canvas.offsetWidth / 2;
            const centerY = canvas.offsetHeight / 2;
            let lastCycleTime = Date.now();

            function animate() {
                if (!isRunning || currentExercise?.id !== 'circular') return;
                
                const elapsed = Date.now() - startTime;
                const angle = (elapsed / 4000) * Math.PI * 2;
                
                const x = centerX + Math.cos(angle) * radius - 15;
                const y = centerY + Math.sin(angle) * radius - 15;
                
                dot.style.left = x + 'px';
                dot.style.top = y + 'px';

                // Count cycles
                if (Date.now() - lastCycleTime > currentExercise.cycleDuration) {
                    incrementCycle();
                    lastCycleTime = Date.now();
                }

                animationId = requestAnimationFrame(animate);
            }
            animate();
        }

        // 2. Figure 8
        function setupFigure8Exercise() {
            exerciseCanvas.innerHTML = `
                <svg class="figure8-path" viewBox="-200 -100 400 200" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; height: 60%;">
                    <path d="M -100 0 C -100 -80, 0 -80, 0 0 C 0 80, 100 80, 100 0 C 100 -80, 0 -80, 0 0 C 0 80, -100 80, -100 0" 
                          fill="none" stroke="rgba(59, 130, 246, 0.3)" stroke-width="2" stroke-dasharray="10,5"/>
                </svg>
                <div class="focus-dot" id="focusDot"><div class="focus-dot-inner"></div></div>
            `;
        }

        function runFigure8Exercise() {
            const dot = document.getElementById('focusDot');
            if (!dot) return;
            
            const canvas = exerciseCanvas;
            const centerX = canvas.offsetWidth / 2;
            const centerY = canvas.offsetHeight / 2;
            const scaleX = canvas.offsetWidth * 0.3;
            const scaleY = canvas.offsetHeight * 0.25;
            let lastCycleTime = Date.now();

            function animate() {
                if (!isRunning || currentExercise?.id !== 'figure8') return;
                
                const elapsed = Date.now() - startTime;
                const t = (elapsed / 3000) * Math.PI * 2;
                
                // Lemniscate of Bernoulli (figure 8)
                const x = centerX + (scaleX * Math.cos(t)) / (1 + Math.sin(t) * Math.sin(t)) - 15;
                const y = centerY + (scaleY * Math.sin(t) * Math.cos(t)) / (1 + Math.sin(t) * Math.sin(t)) - 15;
                
                dot.style.left = x + 'px';
                dot.style.top = y + 'px';

                if (Date.now() - lastCycleTime > currentExercise.cycleDuration) {
                    incrementCycle();
                    lastCycleTime = Date.now();
                }

                animationId = requestAnimationFrame(animate);
            }
            animate();
        }

        // 3. Near-Far Focus
        function setupNearFarExercise() {
            exerciseCanvas.innerHTML = `
                <div class="near-far-object" id="nearFarObject">‚óè</div>
            `;
        }

        function runNearFarExercise() {
            const obj = document.getElementById('nearFarObject');
            if (!obj) return;
            
            let isNear = true;
            let lastCycleTime = Date.now();

            function toggle() {
                if (!isRunning || currentExercise?.id !== 'nearfar') return;
                
                isNear = !isNear;
                if (isNear) {
                    obj.style.transform = 'translate(-50%, -50%) scale(2)';
                    obj.textContent = '‚óâ';
                } else {
                    obj.style.transform = 'translate(-50%, -50%) scale(0.5)';
                    obj.textContent = '‚óã';
                    incrementCycle();
                }
                
                setTimeout(toggle, 3000);
            }
            
            toggle();
        }

        // 4. Blink Exercise
        function setupBlinkExercise() {
            exerciseCanvas.innerHTML = `
                <div class="blink-indicator" id="blinkIndicator">üëÅÔ∏è</div>
            `;
        }

        function runBlinkExercise() {
            const indicator = document.getElementById('blinkIndicator');
            if (!indicator) return;
            
            let lastCycleTime = Date.now();

            function blink() {
                if (!isRunning || currentExercise?.id !== 'blink') return;
                
                indicator.classList.add('blink');
                indicator.textContent = 'üòå';
                
                setTimeout(() => {
                    indicator.classList.remove('blink');
                    indicator.textContent = 'üëÅÔ∏è';
                    incrementCycle();
                }, 500);
                
                setTimeout(blink, currentExercise.cycleDuration);
            }
            
            setTimeout(blink, 1500);
        }

        // 5. Palming
        function setupPalmingExercise() {
            exerciseCanvas.innerHTML = `
                <div class="palming-screen" id="palmingScreen">
                    <div class="hands">üôå</div>
                    <div class="breathing-guide" id="breathingGuide">–í–¥–æ—Ö...</div>
                </div>
            `;
        }

        function runPalmingExercise() {
            const guide = document.getElementById('breathingGuide');
            if (!guide) return;
            
            const phases = ['–í–¥–æ—Ö...', '–ó–∞–¥–µ—Ä–∂–∫–∞...', '–í—ã–¥–æ—Ö...', '–ü–æ–∫–æ–π...'];
            const durations = [4000, 2000, 6000, 2000];
            let phaseIndex = 0;

            function nextPhase() {
                if (!isRunning || currentExercise?.id !== 'palming') return;
                
                guide.textContent = phases[phaseIndex];
                const duration = durations[phaseIndex];
                
                phaseIndex = (phaseIndex + 1) % phases.length;
                if (phaseIndex === 0) incrementCycle();
                
                setTimeout(nextPhase, duration);
            }
            
            nextPhase();
        }

        // 6. 20-20-20 Rule
        function setupRule2020Exercise() {
            exerciseCanvas.innerHTML = `
                <div class="rule-display">
                    <div class="rule-item">
                        <div class="number">20</div>
                        <div class="unit">–º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã</div>
                    </div>
                    <div class="rule-item">
                        <div class="number" id="countdown">20</div>
                        <div class="unit">—Å–µ–∫—É–Ω–¥ —Å–º–æ—Ç—Ä–µ—Ç—å</div>
                    </div>
                    <div class="rule-item">
                        <div class="number">6</div>
                        <div class="unit">–º–µ—Ç—Ä–æ–≤ –≤–¥–∞–ª—å</div>
                    </div>
                </div>
            `;
        }

        function runRule2020Exercise() {
            const countdown = document.getElementById('countdown');
            if (!countdown) return;
            
            let seconds = 20;

            function tick() {
                if (!isRunning || currentExercise?.id !== 'rule2020') return;
                
                countdown.textContent = seconds;
                
                if (seconds === 0) {
                    seconds = 20;
                    incrementCycle();
                } else {
                    seconds--;
                }
                
                setTimeout(tick, 1000);
            }
            
            tick();
        }

        // 7. Corners/Diagonals
        function setupCornersExercise() {
            exerciseCanvas.innerHTML = `
                <div class="corner-dots">
                    <div class="corner-dot top-left" data-pos="0">‚Üñ</div>
                    <div class="corner-dot top-right" data-pos="1">‚Üó</div>
                    <div class="corner-dot center" data-pos="2">‚óè</div>
                    <div class="corner-dot bottom-right" data-pos="3">‚Üò</div>
                    <div class="corner-dot bottom-left" data-pos="4">‚Üô</div>
                </div>
            `;
        }

        function runCornersExercise() {
            const dots = document.querySelectorAll('.corner-dot');
            if (dots.length === 0) return;
            
            let currentPos = 0;
            const sequence = [0, 2, 1, 2, 3, 2, 4, 2]; // TL, C, TR, C, BR, C, BL, C

            function highlight() {
                if (!isRunning || currentExercise?.id !== 'corners') return;
                
                dots.forEach(d => d.classList.remove('active'));
                const targetPos = sequence[currentPos];
                dots[targetPos].classList.add('active');
                
                currentPos = (currentPos + 1) % sequence.length;
                if (currentPos === 0) incrementCycle();
                
                setTimeout(highlight, 1000);
            }
            
            highlight();
        }

        // 8. Zoom Focus
        function setupZoomExercise() {
            exerciseCanvas.innerHTML = `
                <div class="zoom-target" id="zoomTarget">üéØ</div>
            `;
        }

        function runZoomExercise() {
            const target = document.getElementById('zoomTarget');
            if (!target) return;
            
            let isNear = true;

            function zoom() {
                if (!isRunning || currentExercise?.id !== 'zoom') return;
                
                isNear = !isNear;
                if (isNear) {
                    target.style.transform = 'translate(-50%, -50%) scale(3)';
                    target.style.opacity = '1';
                } else {
                    target.style.transform = 'translate(-50%, -50%) scale(0.3)';
                    target.style.opacity = '0.5';
                    incrementCycle();
                }
                
                setTimeout(zoom, 2000);
            }
            
            zoom();
        }

        // 9. Color Therapy
        function setupColorExercise() {
            exerciseCanvas.innerHTML = `
                <div class="color-screen" id="colorScreen">
                    <div class="color-name" id="colorName">–ó–µ–ª—ë–Ω—ã–π</div>
                </div>
            `;
        }

        function runColorExercise() {
            const screen = document.getElementById('colorScreen');
            const name = document.getElementById('colorName');
            if (!screen) return;
            
            const colors = [
                { bg: '#064e3b', name: '–¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π' },
                { bg: '#0369a1', name: '–ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π' },
                { bg: '#1e3a5f', name: '–ù–æ—á–Ω–æ–µ –Ω–µ–±–æ' },
                { bg: '#14532d', name: '–õ–µ—Å–Ω–æ–π' },
                { bg: '#164e63', name: '–ú–æ—Ä—Å–∫–∞—è –≤–æ–ª–Ω–∞' },
                { bg: '#312e81', name: '–ò–Ω–¥–∏–≥–æ' }
            ];
            let colorIndex = 0;

            function changeColor() {
                if (!isRunning || currentExercise?.id !== 'color') return;
                
                const color = colors[colorIndex];
                screen.style.backgroundColor = color.bg;
                name.textContent = color.name;
                
                colorIndex = (colorIndex + 1) % colors.length;
                if (colorIndex === 0) incrementCycle();
                
                setTimeout(changeColor, currentExercise.cycleDuration);
            }
            
            changeColor();
        }

        // 10. Schulte Table
        let schulteTarget = 1;
        
        function setupSchulteExercise() {
            schulteTarget = 1;
            const numbers = shuffleArray([...Array(25).keys()].map(n => n + 1));
            
            exerciseCanvas.innerHTML = `
                <div class="schulte-target">–ù–∞–π–¥–∏—Ç–µ: <span id="schulteTargetNum">1</span></div>
                <div class="schulte-grid" id="schulteGrid">
                    ${numbers.map(n => `<div class="schulte-cell" data-num="${n}">${n}</div>`).join('')}
                </div>
            `;

            document.querySelectorAll('.schulte-cell').forEach(cell => {
                cell.addEventListener('click', () => handleSchulteClick(cell));
            });
        }

        function handleSchulteClick(cell) {
            const num = parseInt(cell.dataset.num);
            
            if (num === schulteTarget) {
                cell.classList.add('correct');
                schulteTarget++;
                document.getElementById('schulteTargetNum').textContent = schulteTarget;
                
                if (schulteTarget > 25) {
                    incrementCycle();
                    setTimeout(() => {
                        setupSchulteExercise();
                    }, 1000);
                }
            } else {
                cell.classList.add('wrong');
                setTimeout(() => cell.classList.remove('wrong'), 300);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // 11. Peripheral Vision
        let peripheralTarget = null;
        
        function setupPeripheralExercise() {
            exerciseCanvas.innerHTML = `
                <div class="peripheral-display" id="peripheralDisplay">
                    <div class="peripheral-center"></div>
                    <div class="peripheral-target" id="peripheralTarget">‚¨§</div>
                </div>
            `;
        }

        function runPeripheralExercise() {
            const target = document.getElementById('peripheralTarget');
            const display = document.getElementById('peripheralDisplay');
            if (!target || !display) return;

            function showTarget() {
                if (!isRunning || currentExercise?.id !== 'peripheral') return;
                
                // Random position on edge
                const side = Math.floor(Math.random() * 4);
                const offset = Math.random() * 80 + 10; // 10-90%
                
                switch(side) {
                    case 0: // top
                        target.style.top = '20px';
                        target.style.left = offset + '%';
                        break;
                    case 1: // right
                        target.style.right = '20px';
                        target.style.left = 'auto';
                        target.style.top = offset + '%';
                        break;
                    case 2: // bottom
                        target.style.bottom = '20px';
                        target.style.top = 'auto';
                        target.style.left = offset + '%';
                        break;
                    case 3: // left
                        target.style.left = '20px';
                        target.style.top = offset + '%';
                        break;
                }
                
                target.classList.add('visible');
                peripheralTarget = Date.now();
                
                setTimeout(() => {
                    target.classList.remove('visible');
                    peripheralTarget = null;
                    setTimeout(showTarget, 1000 + Math.random() * 2000);
                }, 2000);
            }
            
            showTarget();
        }

        function handleKeyPress(e) {
            if (e.code === 'Space' && currentExercise?.id === 'peripheral' && peripheralTarget) {
                const reactionTime = Date.now() - peripheralTarget;
                if (reactionTime < 2000) {
                    incrementCycle();
                    document.getElementById('peripheralTarget').classList.remove('visible');
                }
            }
        }

        // 12. Squeeze Exercise
        function setupSqueezeExercise() {
            exerciseCanvas.innerHTML = `
                <div class="blink-indicator" id="squeezeIndicator" style="border-width: 6px;">üòå</div>
            `;
        }

        function runSqueezeExercise() {
            const indicator = document.getElementById('squeezeIndicator');
            if (!indicator) return;

            function squeeze() {
                if (!isRunning || currentExercise?.id !== 'squeeze') return;
                
                // Squeeze phase
                indicator.textContent = 'üò£';
                indicator.style.transform = 'translate(-50%, -50%) scale(0.7)';
                indicator.style.borderColor = '#f59e0b';
                
                setTimeout(() => {
                    // Open phase
                    indicator.textContent = 'üò≥';
                    indicator.style.transform = 'translate(-50%, -50%) scale(1.3)';
                    indicator.style.borderColor = '#10b981';
                    
                    setTimeout(() => {
                        // Rest phase
                        indicator.textContent = 'üòå';
                        indicator.style.transform = 'translate(-50%, -50%) scale(1)';
                        indicator.style.borderColor = 'var(--accent)';
                        incrementCycle();
                        
                        setTimeout(squeeze, 2000);
                    }, 2000);
                }, 3000);
            }
            
            squeeze();
        }

        // Run Exercise Router
        function runExercise(id) {
            switch(id) {
                case 'circular': runCircularExercise(); break;
                case 'figure8': runFigure8Exercise(); break;
                case 'nearfar': runNearFarExercise(); break;
                case 'blink': runBlinkExercise(); break;
                case 'palming': runPalmingExercise(); break;
                case 'rule2020': runRule2020Exercise(); break;
                case 'corners': runCornersExercise(); break;
                case 'zoom': runZoomExercise(); break;
                case 'color': runColorExercise(); break;
                case 'schulte': /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ */ break;
                case 'peripheral': runPeripheralExercise(); break;
                case 'squeeze': runSqueezeExercise(); break;
            }
        }

        // Start
        init();
    </script>
</body>
</html>
