<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏—Ç–∏–∫</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link id="favicon" rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí°</text></svg>">
<style>
    :root {
        --bg-color: #f4f7f9;
        --card-bg-color: #ffffff;
        --text-color: #333;
        --primary-color: #007bff;
        --primary-color-dark: #0056b3;
        --secondary-text-color: #555;
        --border-color: #e0e6ec;
        --danger-color: #dc3545;
        --danger-bg-color: #f8d7da;
        --print-color: #28a745;
        --print-dark-color: #218838;
        --new-chat-color: #FFA500;
        --new-chat-dark-color: #E86100;
    }
    html, body {
        height: 100%; margin: 0;
        font-family: 'Roboto', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
    }
    .app-container {
        display: flex; flex-direction: column;
        height: 100dvh;
        background-color: var(--card-bg-color);
    }
    .app-header {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        padding: 10px 25px;
        border-bottom: 1px solid var(--border-color);
        flex-shrink: 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        z-index: 10;
    }
    .app-header h1 {
        grid-column: 2 / 3;
        margin: 0; font-size: 24px; font-weight: 500;
        color: var(--primary-color);
        text-align: center;
    }
    .header-right-controls {
        grid-column: 3 / 4;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        position: relative;
    }
    .app-header h1 i { margin-right: 10px; }

    #settings-btn, #history-btn {
        background: transparent;
        border: 1px solid transparent;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--primary-color);
        padding: 8px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
    }
    #history-btn { margin-right: 5px; }
    #settings-btn:hover, #history-btn:hover {
        background-color: rgba(0, 123, 255, 0.08);
        border-color: rgba(0, 123, 255, 0.2);
    }

    .history-popup {
        display: none;
        position: absolute;
        top: 55px;
        right: 0;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1010;
        min-width: 250px;
        max-width: 400px;
        max-height: 300px;
        overflow-y: auto;
    }
    .history-item {
        padding: 10px 15px; font-size: 14px;
        cursor: pointer; white-space: nowrap;
        overflow: hidden; text-overflow: ellipsis;
        border-bottom: 1px solid var(--border-color);
    }
    .history-item:last-child { border-bottom: none; }
    .history-item:hover { background-color: var(--bg-color); }
    .history-popup-empty { padding: 20px; text-align: center; color: var(--secondary-text-color); }

    .header-right-controls-movable {
        display: none;
        padding: 10px 25px;
        border-bottom: 1px solid var(--border-color);
        background-color: #f8f9fa;
    }
    .api-mode-selector-container {
        position: relative;
        width: 100%;
    }
    #api-mode-selector-button {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background-color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 16px;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 10px;
        text-align: left;
    }
    #api-mode-selector-button:hover {
        border-color: var(--primary-color);
    }
    #api-mode-selector-button .icon {
        width: 20px;
        height: 20px;
        fill: var(--primary-color);
        flex-shrink: 0;
    }
    #api-mode-selector-button .text {
        flex-grow: 1;
    }
    #api-mode-selector-button::after {
        content: '';
        width: 8px;
        height: 8px;
        border-right: 2px solid var(--secondary-text-color);
        border-bottom: 2px solid var(--secondary-text-color);
        transform: rotate(45deg);
        margin-left: auto;
    }
    #api-mode-options {
        position: absolute;
        list-style: none;
        padding: 0;
        margin: 5px 0 0 0;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        width: 100%;
        z-index: 1011;
        display: none;
    }
    .api-mode-option {
        padding: 12px 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
    }
    .api-mode-option:hover {
        background-color: var(--bg-color);
    }
    .api-mode-option .icon {
        width: 20px;
        height: 20px;
        fill: var(--primary-color);
        flex-shrink: 0;
    }
    .api-mode-option.selected {
        font-weight: 500;
        background-color: #eaf4ff;
    }

    .response-area { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
    .response-actions {
        padding: 10px 25px; background-color: #f8f9fa; border-bottom: 1px solid var(--border-color);
        display: none; gap: 10px; flex-shrink: 0; align-items: center;
    }
    .action-btn {
        padding: 8px 15px; border-radius: 5px; cursor: pointer;
        font-size: 14px; font-weight: 500; color: white; transition: all 0.2s ease; border: none;
    }
    .action-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .action-btn i { margin-right: 8px; }
    #copy-btn { background-color: var(--primary-color); }
    #copy-btn:hover { background-color: var(--primary-color-dark); }
    #print-btn { background-color: var(--print-color); }
    #print-btn:hover { background-color: var(--print-dark-color); }
    #new-chat-btn { background-color: var(--new-chat-color); margin-left: auto; }
    #new-chat-btn:hover { background-color: var(--new-chat-dark-color); }

    .response-wrapper { flex-grow: 1; overflow-y: auto; padding: 25px; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .welcome-message { text-align: center; color: var(--secondary-text-color); padding-top: 15vh; animation: fadeInUp 0.5s ease forwards; }
    .welcome-message i { font-size: 48px; margin-bottom: 20px; color: var(--primary-color); opacity: 0.8; }
    .welcome-message h2 { font-weight: 500; font-size: 22px; color: var(--text-color); margin-bottom: 10px; }
    .welcome-message p { font-size: 16px; line-height: 1.6; }
    .welcome-message p em { color: #999; font-size: 14px; display: block; margin-top: 15px; }

    #ai-response { line-height: 1.7; font-size: 16px; }
    #ai-response h1, #ai-response h2, #ai-response h3, #ai-response h4 {
        font-weight: 500; color: var(--text-color); margin-top: 30px; margin-bottom: 15px;
        padding-bottom: 8px; border-bottom: 1px solid var(--border-color);
    }
    #ai-response h2 { font-size: 22px; }
    #ai-response h3 { font-size: 18px; }
    #ai-response h4 { font-size: 16px; border-bottom: none;}

    #ai-response table {
        width: 100%; border-collapse: collapse; margin: 25px 0;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05); border: 1px solid var(--border-color);
        border-radius: 8px; overflow: hidden;
    }
    #ai-response th, #ai-response td { border: 1px solid var(--border-color); padding: 12px 15px; text-align: left; }
    #ai-response th { background-color: #f8f9fa; font-weight: 500; }
    #ai-response td ul { padding-left: 20px; margin: 0; }

    .loader { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
    .loader p { margin-top: 20px; color: var(--secondary-text-color); font-size: 16px; }
    #cancel-btn { margin-top: 15px; background-color: var(--new-chat-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
    #cancel-btn:hover { background-color: var(--new-chat-dark-color); }
    .loader .loader-icon { font-size: 64px; color: var(--primary-color); opacity: 0.8; margin-bottom: 10px; }
    .loader-icon-universal { animation: float-atom 4s ease-in-out infinite; } @keyframes float-atom { 0% { transform: translateY(0) rotate(0deg); } 25% { transform: translateY(-8px); } 50% { transform: translateY(0) rotate(180deg); } 75% { transform: translateY(8px); } 100% { transform: translateY(0) rotate(360deg); } }

    .input-panel { display: flex; padding: 15px 25px; gap: 15px; border-top: 1px solid var(--border-color); background-color: #f8f9fa; flex-shrink: 0; align-items: center; }
    #user-query {
        flex-grow: 1; padding: 12px 15px; font-size: 16px; font-family: 'Roboto', sans-serif; border-radius: 22px;
        border: 1px solid var(--border-color); resize: none; height: 24px; line-height: 24px; transition: all 0.2s ease; max-height: 150px;
    }
    #user-query:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2); }
    #send-btn {
        flex-shrink: 0; width: 48px; height: 48px; border-radius: 50%; border: none; background-color: var(--primary-color);
        color: white; font-size: 20px; cursor: pointer; transition: all 0.2s ease;
        display: flex; align-items: center; justify-content: center;
    }
    #send-btn:hover { background-color: var(--primary-color-dark); }
    #user-query:disabled, #send-btn:disabled { background-color: #e9ecef; cursor: not-allowed; opacity: 0.7; }

    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.6); display: none; justify-content: center;
        align-items: center; z-index: 1000;
    }
    .modal-content {
        background-color: white; padding: 30px; border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 500px;
        display: flex; flex-direction: column;
    }
    .modal-content h2 { margin-top: 0; color: var(--primary-color); text-align: center;}
    .modal-content p { color: var(--secondary-text-color); line-height: 1.6; text-align: center;}
    .modal-content a { color: var(--primary-color-dark); text-decoration: none; }
    .modal-content a:hover { text-decoration: underline; }

    .settings-controls-wrapper { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
    .settings-control-group label { display: block; margin-bottom: 8px; color: var(--secondary-text-color); font-size: 14px; }
    .settings-control-group select, .settings-control-group input[type="password"] {
        width: 100%; padding: 12px; border: 1px solid var(--border-color);
        border-radius: 8px; font-size: 16px; box-sizing: border-box;
    }
    #api-key-input-group { display: none; }
    #save-settings-btn {
        margin-top: 25px; width: 100%; padding: 12px; background-color: var(--primary-color); color: white;
        border: none; border-radius: 8px; font-size: 16px; font-weight: 500;
        cursor: pointer; transition: background-color 0.2s;
    }
    #save-settings-btn:hover { background-color: var(--primary-color-dark); }

    @media print {
        .app-header, .input-panel, .response-actions, #settings-btn, #history-btn, .header-right-controls-movable {
            display: none !important;
        }
        body, .app-container {
            background-color: #ffffff !important; box-shadow: none !important;
            height: auto !important; overflow: visible !important; color: #000000 !important;
        }
        .response-area, .response-wrapper {
            height: auto !important; overflow: visible !important; display: block !important;
            padding: 0 !important; flex-grow: 0 !important;
        }
        #ai-response { line-height: 1.4; font-size: 12pt; }
        #ai-response table { box-shadow: none !important; page-break-inside: auto; }
        #ai-response tr { page-break-inside: avoid; }
    }

    @media (max-width: 768px) {
        .app-header { padding: 10px 15px; }
        .app-header h1 { font-size: 20px; }
        .response-wrapper, .input-panel, .response-actions, .header-right-controls-movable { padding: 15px; }
        .welcome-message { padding-top: 10vh; }
        #ai-response { font-size: 15px; }
    }

</style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left"></div>
            <h1><i class="fa-solid fa-magnifying-glass-chart"></i>–ê–Ω–∞–ª–∏—Ç–∏–∫</h1>
            <div class="header-right-controls">
                <button id="history-btn" title="–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤"><i class="fas fa-history"></i></button>
                <button id="settings-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"><i class="fas fa-cog"></i></button>
                <div id="history-popup" class="history-popup"></div>
            </div>
        </header>

        <div class="header-right-controls-movable" style="display: none; padding: 10px 25px; border-bottom: 1px solid var(--border-color); background-color: #f8f9fa;">
             <div class="api-mode-selector-container">
                <button id="api-mode-selector-button">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
                </button>
                <ul id="api-mode-options"></ul>
            </div>
        </div>

        <main class="response-area">
            <div class="response-actions" id="response-actions">
                <button class="action-btn" id="copy-btn"><i class="fa-solid fa-copy"></i>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="action-btn" id="print-btn"><i class="fa-solid fa-print"></i>–ü–µ—á–∞—Ç—å</button>
                <button class="action-btn" id="new-chat-btn"><i class="fa-solid fa-plus-circle"></i>–ù–æ–≤—ã–π —á–∞—Ç</button>
            </div>
            <div class="response-wrapper" id="response-wrapper">
                <div id="ai-response"></div>
            </div>
        </main>

        <div class="input-panel">
            <textarea id="user-query" placeholder="–ó–∞–¥–∞–π—Ç–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å, –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞..." rows="1"></textarea>
            <button id="send-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="settings-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –∏ —Ä–µ–∂–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –î–ª—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ "Gemini" —Ç—Ä–µ–±—É–µ—Ç—Å—è API-–∫–ª—é—á.</p>
            <div class="settings-controls-wrapper">
                <div class="settings-control-group">
                    <label for="model-selector">1. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</label>
                    <select id="model-selector">
                        <option value="gemini-1.5-flash-latest" data-api-type="gemini" selected>Gemini 1.5 Flash (–±—ã—Å—Ç—Ä–∞—è)</option>
                        <option value="gemini-1.5-pro-latest" data-api-type="gemini">Gemini 1.5 Pro (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è)</option>
                    </select>
                </div>
                <div class="settings-control-group">
                    <label>2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</label>
                    <div id="modal-api-controls-placeholder"></div>
                </div>
                <div class="settings-control-group" id="api-key-input-group">
                    <label for="api-key-input">3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á Gemini</label>
                    <input type="password" id="api-key-input" placeholder="–í–∞—à –∫–ª—é—á...">
                     <small style="display: block; margin-top: 5px; color: #777;">–ö–ª—é—á –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a></small>
                </div>
            </div>
            <button id="save-settings-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
    const VERCEL_PROXY_BASE_URL = "https://ver-olive-delta.vercel.app";
    const MAPRUAPP_PROXY_BASE_URL = "https://mapruapp.ru";

    const DEFAULT_MODEL_ID = "gemini-1.5-flash-latest";

    const API_MODES = {
        'mapruapp': {
            uiName: '–ü—Ä–æ–∫—Å–∏ (MapRuApp)',
            geminiUrl: () => `${MAPRUAPP_PROXY_BASE_URL}/ai/api/v1/chat/completions`,
            icon: '<i class="fa-solid fa-server icon"></i>'
        },
        'vercel': {
            uiName: '–ü—Ä–æ–∫—Å–∏ (Vercel)',
            geminiUrl: (modelId) => `${VERCEL_PROXY_BASE_URL}/proxy/gemini/v1beta/models/${modelId}:generateContent`,
            icon: '<i class="fa-solid fa-cloud icon"></i>'
        },
        'direct': {
            uiName: '–ü—Ä—è–º–æ–π (Gemini)',
            geminiUrl: (modelId, key) => `https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${key}`,
            icon: '<i class="fa-solid fa-key icon"></i>'
        }
    };
    
    // --- –°–ò–°–¢–ï–ú–ù–´–ï –ü–†–û–ú–ü–¢–´ –î–õ–Ø –†–ê–ó–ù–´–• –†–ï–ñ–ò–ú–û–í ---

    const AI_SYSTEM_PROMPT_INSTRUCTOR = `–¢—ã ‚Äî "–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä", –º–µ—Ç–æ–¥–∏—á–Ω—ã–π –∏ —Å–≤–µ—Ä—Ö—Ç–æ—á–Ω—ã–π –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ç–µ–º—É "–∫–∞–∫ —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å" –≤ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â—É—é, –ø–æ—à–∞–≥–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é. –¢—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ–¥–∞–Ω—Ç–∏—á–Ω—ã–º, —è—Å–Ω—ã–º –∏ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ.

### **–°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê (–°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–¢–¨):**

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞]

### üìä 1. –û–±–∑–æ—Ä –∑–∞–¥–∞—á–∏
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –∫—Ä–∞—Ç–∫–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –∑–∞–¥–∞—á–µ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞.
*   **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** [–ù–æ–≤–∏—á–æ–∫ / –û–ø—ã—Ç–Ω—ã–π / –≠–∫—Å–ø–µ—Ä—Ç]
*   **–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è:** [–ù–∞–ø—Ä–∏–º–µ—Ä: 30-45 –º–∏–Ω—É—Ç]
*   **–ö–ª—é—á–µ–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** [–ö—Ä–∞—Ç–∫–æ, —á—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è –≤ –∏—Ç–æ–≥–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–†–∞–±–æ—á–∏–π —Å–º–µ—Å–∏—Ç–µ–ª—å –±–µ–∑ –ø—Ä–æ—Ç–µ—á–µ–∫"]

---

### üõ†Ô∏è 2. –ß—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è?
–†–∞–∑–¥–µ–ª–∏ –Ω–∞ –¥–≤–∞ —Å–ø–∏—Å–∫–∞ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ.
*   **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** [–°–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä: '–†–∞–∑–≤–æ–¥–Ω–æ–π –∫–ª—é—á', '–ü–ª–æ—Å–∫–∞—è –æ—Ç–≤–µ—Ä—Ç–∫–∞']
*   **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã/–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏:** [–°–ø–∏—Å–æ–∫ –≤—Å–µ–≥–æ, —á—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä: '–ù–æ–≤—ã–π –∫–∞—Ä—Ç—Ä–∏–¥–∂ (d35)', '–£–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞', '–ß–∏—Å—Ç–∞—è –≤–µ—Ç–æ—à—å']

---

### ü™ú 3. –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å —á–µ—Ç–∫–∏–º–∏, –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏.
1.  **–®–∞–≥ 1:** [–û–ø–∏—Å–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π **–∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç** –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤].
2.  **–®–∞–≥ 2:** [–°–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ...].
3.  **‚úîÔ∏è –¢–æ—á–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è:** [–ü–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —ç—Ç–∞–ø–æ–≤ –¥–æ–±–∞–≤–ª—è–π –ø—Ä–æ–≤–µ—Ä–∫—É. –ù–∞–ø—Ä–∏–º–µ—Ä: "–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —Å—Ç–∞—Ä—ã–π –∫–∞—Ä—Ç—Ä–∏–¥–∂ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–≤–ª–µ—á–µ–Ω, –∞ –ø–æ—Å–∞–¥–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ ‚Äî —á–∏—Å—Ç—ã–º –∏ —Å—É—Ö–∏–º."].
4.  ...

---

### ‚ö†Ô∏è 4. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
–°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º.

| –ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è | –†–µ—à–µ–Ω–∏–µ |
|---|---|
| [–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏] | [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç, –∫–∞–∫ –µ–µ –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å] |
| [–ü—Ä–∏–º–µ—Ä: "–ì–∞–π–∫–∞ –Ω–µ –æ—Ç–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è"] | [–ü—Ä–∏–º–µ—Ä: "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WD-40 –∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10 –º–∏–Ω—É—Ç. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø—Ä–æ–≥—Ä–µ—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º —Ñ–µ–Ω–æ–º."] |

---

**–î–ò–°–ö–õ–ï–ô–ú–ï–†:** –í—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ–º, –≥–∞–∑–æ–º, –≤–æ–¥–æ–π –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏, –µ—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–≤–æ–∏—Ö —Å–∏–ª–∞—Ö, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º. –î–∞–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã–π —É—â–µ—Ä–±.`;

    const AI_SYSTEM_PROMPT_DOSSIER = `–¢—ã ‚Äî "–≠–∫—Å–ø–µ—Ä—Ç-–ê—Ä—Ö–∏–≤–∞—Ä–∏—É—Å", —Å–≤–µ—Ä—Ö—Ç–æ—á–Ω—ã–π –ò–ò –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏—Ö –¥–æ—Å—å–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–µ, –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ª—é–±–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é.

### **–ü–†–ò–ù–¶–ò–ü –ê–ë–°–û–õ–Æ–¢–ù–û–ô –¢–û–ß–ù–û–°–¢–ò**
1. **–ó–ê–ü–†–ï–¢ –ù–ê –í–´–ú–´–°–ï–õ**: –ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç ‚Äî —É–∫–∞–∑—ã–≤–∞–π "–î–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç" –∏–ª–∏ "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ".
2. **–ü–†–û–í–ï–†–Ø–ï–ú–û–°–¢–¨**: –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–∑ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∞–π—Ç—ã, —Ç–µ—Ö–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –Ω–∞—É—á–Ω—ã–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã).
3. **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ü–û–õ–ù–û–¢–ê**: –°—Ç—Ä–µ–º–∏—Å—å –∫ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–º—É –æ—Ö–≤–∞—Ç—É –≤—Å–µ—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞.

### **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê:**

## üìú –î–æ—Å—å–µ: [–ü–æ–ª–Ω–æ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞]

### üìù –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
–í 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö: —á—Ç–æ —ç—Ç–æ, –æ—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –∫–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

### üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
*–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ —Ç–∏–ø—É –æ–±—ä–µ–∫—Ç–∞ (–¢–µ—Ö–Ω–∏–∫–∞, –ë–∏–æ–ª–æ–≥–∏—è, –∏ —Ç.–¥.)*

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---|---|---|
| **üè∑Ô∏è –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø** | | |
| –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ | [–¢–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ] | |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å/–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫/–ê–≤—Ç–æ—Ä | [–ù–∞–∑–≤–∞–Ω–∏–µ] | |
| –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞/–°–æ–∑–¥–∞–Ω–∏—è | [–ì–æ–¥ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥] | |
| **‚öôÔ∏è –ö–õ–Æ–ß–ï–í–´–ï –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò** | | |
| [–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä 1] | [–ó–Ω–∞—á–µ–Ω–∏–µ] | [–ö–æ–Ω—Ç–µ–∫—Å—Ç] |
| [–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä 2] | [–ó–Ω–∞—á–µ–Ω–∏–µ] | [–ö–æ–Ω—Ç–µ–∫—Å—Ç] |
| [–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä 3] | [–ó–Ω–∞—á–µ–Ω–∏–µ] | [–ö–æ–Ω—Ç–µ–∫—Å—Ç] |
| **üìà –ò–°–¢–û–†–ò–Ø –ò –†–ê–ó–í–ò–¢–ò–ï** | | |
| [–ö–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø 1] | [–û–ø–∏—Å–∞–Ω–∏–µ] | [–î–∞—Ç–∞] |
| [–ö–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø 2] | [–û–ø–∏—Å–∞–Ω–∏–µ] | [–î–∞—Ç–∞] |

---

### üéØ –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –í–ª–∏—è–Ω–∏–µ
**–ù–∏—à–∞/–û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** [2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ —Ç–æ–º, –≥–¥–µ –∏ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–ª–∏ –∫–∞–∫–æ–µ –º–µ—Å—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç]
**–í–ª–∏—è–Ω–∏–µ –∏ –Ω–∞—Å–ª–µ–¥–∏–µ:** [–ö–∞–∫ —Ä–∞–±–æ—Ç—ã –∏ –∏–¥–µ–∏ —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞/–æ–±—ä–µ–∫—Ç–∞ –ø–æ–≤–ª–∏—è–ª–∏ –Ω–∞ –º–∏—Ä?]

---
**–î–ò–°–ö–õ–ï–ô–ú–ï–†:** –î–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ –ø—Ä–æ—á–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è. –ü–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö.`;

    const AI_SYSTEM_PROMPT_SCIENTIST = `–¢—ã ‚Äî "–ù–∞—É—á–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫", –±–ª–µ—Å—Ç—è—â–∏–π –ò–ò-—É—á–µ–Ω—ã–π —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —ç—Ä—É–¥–∏—Ü–∏–µ–π. –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞—É—á–Ω–æ-–ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞ –û–î–ù–£ –∑–∞–¥–∞–Ω–Ω—É—é —Ç–µ–º—É.

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**

## –ù–∞—É—á–Ω—ã–π –æ–±–∑–æ—Ä: [–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã]

### ‚ú® 1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç–µ–º—É: –°—É—Ç—å –≤–æ–ø—Ä–æ—Å–∞ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
–ù–∞—á–Ω–∏ —Å –∫—Ä–∞—Ç–∫–æ–≥–æ –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–∏—è. –û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É —ç—Ç–∞ —Ç–µ–º–∞ –≤–∞–∂–Ω–∞ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–Ω—è—Ç–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏–∏.

---

### ‚è≥ 2. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞
–ü—Ä–µ–¥—Å—Ç–∞–≤—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≤–∏—Ç–∏—è –∏–¥–µ–π –ø–æ –¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ.
*   **[–†–∞–Ω–Ω–∏–π –ø–µ—Ä–∏–æ–¥]:** –£–ø–æ–º—è–Ω–∏ –ø–µ—Ä–≤—ã–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –∏–ª–∏ –Ω–∞—É—á–Ω—ã–µ –¥–æ–≥–∞–¥–∫–∏.
*   **[–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ—Ä—ã–≤—ã]:** –†–∞—Å—Å–∫–∞–∂–∏ –æ —Ä–∞–±–æ—Ç–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ª–æ–∂–∏–ª–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç.
*   **[–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç—Ç–∞–ø]:** –û–ø–∏—à–∏ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ–æ—Ä–∏–∏ –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è XX-XXI –≤–µ–∫–æ–≤.

---

### üèÜ 3. –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã –∏ –∏—Ö —Ç—Ä—É–¥—ã
–°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã 2-4 –≥–ª–∞–≤–Ω—ã—Ö —É—á–µ–Ω—ã—Ö, –≤–Ω–µ—Å—à–∏—Ö —Ä–µ—à–∞—é—â–∏–π –≤–∫–ª–∞–¥ –≤ —ç—Ç—É –æ–±–ª–∞—Å—Ç—å.

| –£—á–µ–Ω—ã–π | –û—Å–Ω–æ–≤–Ω–æ–π –≤–∫–ª–∞–¥ | –ö–ª—é—á–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ (–∫–Ω–∏–≥–∞/—Å—Ç–∞—Ç—å—è) |
|---|---|---|
| [–ò–º—è –§–∞–º–∏–ª–∏—è] | [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∞] | *[–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∏–ª–∏ —Å—Ç–∞—Ç—å–∏]* |
| [–ò–º—è –§–∞–º–∏–ª–∏—è] | [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∞] | *[–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ –∏–ª–∏ —Å—Ç–∞—Ç—å–∏]* |

---

### ‚öõÔ∏è 4. –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ —Ç–µ–∫—É—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ
–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞. –ó–¥–µ—Å—å —Ç—ã –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ä–æ–±–Ω–æ, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ –∏–∑–ª–æ–∂–∏—Ç—å —Å—É—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞—É—á–Ω–æ–≥–æ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ –ø–æ —Ç–µ–º–µ.
*   –†–∞–∑–±–µ–π —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –Ω–∞ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ —á–∞—Å—Ç–∏.
*   –ò—Å–ø–æ–ª—å–∑—É–π –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–≤ –∏–ª–∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤.

---

### üöÄ 5. –ù–∞ –ø–µ—Ä–µ–¥–Ω–µ–º –∫—Ä–∞–µ –Ω–∞—É–∫–∏: –ù–æ–≤–µ–π—à–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –Ω–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
*   –ö–∞–∫–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è —Å–µ–π—á–∞—Å?
*   –ö–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –æ—Ç–≤–µ—Ç–∞?
*   –ö–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –º–æ–≥—É—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–∏–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º?

---

**–î–ò–°–ö–õ–ï–ô–ú–ï–†:** –î–∞–Ω–Ω—ã–π –æ–±–∑–æ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–∞—É—á–Ω–æ-–ø–æ–ø—É–ª—è—Ä–Ω–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å —É–∑–∫–∏–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º. –ù–∞—É–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è, –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —É—Ç–æ—á–Ω—è—Ç—å—Å—è.`;
    
    const AI_SYSTEM_PROMPT_COMPARISON = `–¢—ã ‚Äî "–ö–æ–º–ø–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ê–Ω–∞–ª–∏—Ç–∏–∫", –±–µ—Å–ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç–Ω—ã–π –∏ –¥–æ—Ç–æ—à–Ω—ã–π –ò–ò-—ç–∫—Å–ø–µ—Ä—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –≤–∑—è—Ç—å –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∏—Ö –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–µ, –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã, –≤—ã—è–≤–ª—è—è –∫–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –∏ —Å—Ö–æ–¥—Å—Ç–≤–∞.

### **–°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê (–°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–¢–¨):**

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑: [–û–±—ä–µ–∫—Ç 1] vs. [–û–±—ä–µ–∫—Ç 2]

### üéØ 1. –ö—Ä–∞—Ç–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ
–í 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤—å —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –æ–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –∏—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏–ª–∏ –≤–∞–∂–Ω–æ. –£–∫–∞–∂–∏ –æ–±—â—É—é –æ–±–ª–∞—Å—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç.

---

### ‚öñÔ∏è 2. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∏ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å —Ç–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞. –°–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é —Ç–∞–±–ª–∏—Ü—É. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º—ã–º –æ–±—ä–µ–∫—Ç–∞–º.

| –ö—Ä–∏—Ç–µ—Ä–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è | **[–û–±—ä–µ–∫—Ç 1]** | **[–û–±—ä–µ–∫—Ç 2]** |
|---|---|---|
| **üåç –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∏ —Å—Ä–µ–¥–∞** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |
| **üìè –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |
| **üß† –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |
| **üèÜ –ö–ª—é—á–µ–≤—ã–µ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |
| **üëé –ö–ª—é—á–µ–≤—ã–µ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |
| **üí° –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å** | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1] | [–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 2] |

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è –ò–ò: –ê–¥–∞–ø—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å "–ê—Ä–µ–∞–ª –æ–±–∏—Ç–∞–Ω–∏—è", "–û—Ö–æ—Ç–Ω–∏—á—å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è". –î–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ ‚Äî "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞". –î–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π ‚Äî "–ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏", "–ù–∞—Å–ª–µ–¥–∏–µ".*

---

### üìä 3. –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
–ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã —Å–¥–µ–ª–∞–π 3-4 –∫–ª—é—á–µ–≤—ã—Ö –≤—ã–≤–æ–¥–∞.
*   **–ì–ª–∞–≤–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ:** [–í —á–µ–º –æ–Ω–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏?]
*   **–ì–ª–∞–≤–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ:** [–í —á–µ–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –∏—Ö —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ?]
*   **–í–µ—Ä–¥–∏–∫—Ç:** [–í –∫–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏–ª–∏ –¥–ª—è –∫–∞–∫–æ–π —Ü–µ–ª–∏ –∫–∞–∂–¥—ã–π –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ? –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º, –±–µ–∑ —è–≤–Ω–æ–≥–æ —Ñ–∞–≤–æ—Ä–∏—Ç–∏–∑–º–∞, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—á–µ–≤–∏–¥–Ω–æ –∏–∑ —Ñ–∞–∫—Ç–æ–≤.]

---

**–î–ò–°–ö–õ–ï–ô–ú–ï–†:** –î–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π. –û—Ü–µ–Ω–∫–∏ –Ω–æ—Å—è—Ç —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.`;

    const AI_SYSTEM_PROMPT_SUMMARIZER = `–¢—ã ‚Äî "–ê–Ω–∞–ª–∏—Ç–∏–∫-–†–µ–∑—é–º–∞—Ç–æ—Ä", –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ò–ò-–∞–≥–µ–Ω—Ç, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –≥–ª—É–±–æ–∫–æ–º –∞–Ω–∞–ª–∏–∑–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Å—Å—ã–ª–∫–µ. –¢–≤–æ—è —Ü–µ–ª—å ‚Äî –∏–∑–≤–ª–µ—á—å –∫–ª—é—á–µ–≤—É—é —Å—É—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–µ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –≤ –≤–∏–¥–µ –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–µ–π —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.

### **–ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´:**
1.  **–ì–õ–£–ë–ò–ù–ê –ê–ù–ê–õ–ò–ó–ê:** –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞–µ—à—å, –∞ –≤—ã—è–≤–ª—è–µ—à—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, —Å–∫—Ä—ã—Ç—ã–µ —Ç–µ–º—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –∞–≤—Ç–æ—Ä—Å–∫–∏–π –∑–∞–º—ã—Å–µ–ª.
2.  **–ù–ï–ô–¢–†–ê–õ–¨–ù–û–°–¢–¨:** –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ–∫—Ä–∞—à–µ–Ω.
3.  **–°–¢–†–£–ö–¢–£–†–ê:** –¢—ã –æ–±—è–∑–∞–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –Ω–∏–∂–µ —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

**–í–ê–ñ–ù–û:** –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞ (URL), —Ç—ã –¥–æ–ª–∂–µ–Ω –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã –ø–µ—Ä–µ—à–µ–ª –ø–æ –Ω–µ–π, –ø—Ä–æ—á–∏—Ç–∞–ª –≤–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ (–∏–≥–Ω–æ—Ä–∏—Ä—É—è –Ω–∞–≤–∏–≥–∞—Ü–∏—é, —Ä–µ–∫–ª–∞–º—É –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏) –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç.

### **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê:**

## üìë –°–≤–æ–¥–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### üìù –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä
–í 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö: –æ —á–µ–º —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç, –∫–∞–∫–æ–≤–∞ –µ–≥–æ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å (–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å, —É–±–µ–¥–∏—Ç—å, —Ä–∞–∑–≤–ª–µ—á—å) –∏ –¥–ª—è –∫–æ–≥–æ –æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω.

---

### üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–≤–æ–¥–∫–∞

| –ê—Å–ø–µ–∫—Ç –∞–Ω–∞–ª–∏–∑–∞ | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ –≤—ã–≤–æ–¥—ã |
|---|---|
| **üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è** | [–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≥–ª–∞–≤–Ω—É—é –º—ã—Å–ª—å –∏–ª–∏ —Ç–µ–∑–∏—Å —Ç–µ–∫—Å—Ç–∞ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏.] |
| **üîë –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã** | [–ü—Ä–µ–¥—Å—Ç–∞–≤—å –≤ –≤–∏–¥–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ 3-5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –ø–æ–¥—Ç–µ–º –∏–ª–∏ –ø–æ–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä.] |
| **üßê –ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞** | [–ö–∞–∫ –∞–≤—Ç–æ—Ä –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ—é —Ç–æ—á–∫—É –∑—Ä–µ–Ω–∏—è? (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –º–Ω–µ–Ω–∏—è, –ø—Ä–∏–º–µ—Ä—ã, –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã)] |
| **üí° –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã** | [–ö –∫–∞–∫–∏–º –∏—Ç–æ–≥–æ–≤—ã–º –∑–∞–∫–ª—é—á–µ–Ω–∏—è–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ—Ä? –ß—Ç–æ —á–∏—Ç–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–Ω–µ—Å—Ç–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞?] |
| **üó£Ô∏è –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∏–ª—å** | [–û–ø–∏—à–∏ —Å—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞ (–Ω–∞—É—á–Ω—ã–π, –ø—É–±–ª–∏—Ü–∏—Å—Ç–∏—á–µ—Å–∫–∏–π, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π, –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã–π) –∏ –æ–±—â—É—é —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞.] |
| **#Ô∏è‚É£ –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –ø–æ–Ω—è—Ç–∏—è** | [–ü–µ—Ä–µ—á–∏—Å–ª–∏ 5-7 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.] |
| **üîé –°–∫—Ä—ã—Ç—ã–µ –∏–ª–∏ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã** | [–ï—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ–¥—Ç–µ–∫—Å—Ç, –∏—Ä–æ–Ω–∏—è, –∏–ª–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä—è–º–æ?] |

---

**–î–ò–°–ö–õ–ï–ô–ú–ï–†:** –î–∞–Ω–Ω–∞—è —Å–≤–æ–¥–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫—É.`;

    const MASTER_PROMPT = `–¢—ã ‚Äî "–ê–Ω–∞–ª–∏—Ç–∏–∫", –º–∞—Å—Ç–µ—Ä-–ò–ò, –∫–æ—Ç–æ—Ä—ã–π –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–Ω—É –∏–∑ –ü–Ø–¢–ò —Ä–æ–ª–µ–π –¥–ª—è –æ—Ç–≤–µ—Ç–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç, –°–¢–†–û–ì–û —Å–ª–µ–¥—É—è —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –ø—Ä–∞–≤–∏–ª–∞–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–æ–ª–∏.

### **–®–ê–ì 1: –ê–ù–ê–õ–ò–ó –ó–ê–ü–†–û–°–ê –ò –í–´–ë–û–† –†–û–õ–ò (–°–¢–†–û–ì–ò–ô –ü–û–†–Ø–î–û–ö –ü–†–û–í–ï–†–ö–ò)**

1.  **–ü–†–û–í–ï–†–ö–ê –ù–ê –°–°–´–õ–ö–£ –ò–õ–ò –î–õ–ò–ù–ù–´–ô –¢–ï–ö–°–¢:**
    *   –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç "http://" –∏–ª–∏ "https://" –ò–õ–ò –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª–µ–µ 100 —Å–ª–æ–≤ -> **–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è "–ê–ù–ê–õ–ò–¢–ò–ö–û–ú-–†–ï–ó–Æ–ú–ê–¢–û–†–û–ú".**

2.  **–ü–†–û–í–ï–†–ö–ê –ù–ê –ò–ù–°–¢–†–£–ö–¶–ò–Æ:**
    *   –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∏ –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", "–ø–æ—à–∞–≥–æ–≤–æ", "–ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π" -> **–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è "–ò–ù–°–¢–†–£–ö–¢–û–†–û–ú".**

3.  **–ü–†–û–í–ï–†–ö–ê –ù–ê –°–†–ê–í–ù–ï–ù–ò–ï:**
    *   –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –∏ –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ "—Å—Ä–∞–≤–Ω–∏", "–ø—Ä–æ—Ç–∏–≤", "vs", "–∏–ª–∏" (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã–±–æ—Ä–∞), "—á—Ç–æ –ª—É—á—à–µ" -> **–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è "–ö–û–ú–ü–ê–†–ê–¢–ò–í–ù–´–ú –ê–ù–ê–õ–ò–¢–ò–ö–û–ú".**

4.  **–ü–†–û–í–ï–†–ö–ê –ù–ê –î–û–°–¨–ï (–û–î–ò–ù –û–ë–™–ï–ö–¢):**
    *   –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –∏ –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –û–î–ù–û–ú –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ/—á–µ–ª–æ–≤–µ–∫–µ ("—Ä–∞—Å—Å–∫–∞–∂–∏ –æ...", "—á—Ç–æ —Ç–∞–∫–æ–µ...", "–¥–æ—Å—å–µ –Ω–∞...") -> **–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è "–≠–ö–°–ü–ï–†–¢–û–ú-–ê–†–•–ò–í–ê–†–ò–£–°–û–ú" (—Ä–µ–∂–∏–º "–î–æ—Å—å–µ").**

5.  **–†–û–õ–¨ –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ (–ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó):**
    *   –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –∏–∑ –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∑–Ω–∞—á–∏—Ç, —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±—â–∏–π –≥–ª—É–±–æ–∫–∏–π —Ä–∞–∑–±–æ—Ä —Å–ª–æ–∂–Ω–æ–π —Ç–µ–º—ã. -> **–¢—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è "–ù–ê–£–ß–ù–´–ú –ê–ù–ê–õ–ò–¢–ò–ö–û–ú" (—Ä–µ–∂–∏–º "–ê–Ω–∞–ª–∏–∑").**

### **–®–ê–ì 2: –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–í–ï–¢–ê –°–û–ì–õ–ê–°–ù–û –†–û–õ–ò**

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏, —Ç—ã –¥–æ–ª–∂–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç. –ù–µ —Å–º–µ—à–∏–≤–∞–π —Ñ–æ—Ä–º–∞—Ç—ã.

---
### **–°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢: "–ê–ù–ê–õ–ò–¢–ò–ö-–†–ï–ó–Æ–ú–ê–¢–û–†"**
${AI_SYSTEM_PROMPT_SUMMARIZER}
---
### **–°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢: "–ò–ù–°–¢–†–£–ö–¢–û–†"**
${AI_SYSTEM_PROMPT_INSTRUCTOR}
---
### **–°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢: "–ö–û–ú–ü–ê–†–ê–¢–ò–í–ù–´–ô –ê–ù–ê–õ–ò–¢–ò–ö"**
${AI_SYSTEM_PROMPT_COMPARISON}
---
### **–°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢: "–≠–ö–°–ü–ï–†–¢-–ê–†–•–ò–í–ê–†–ò–£–° (–î–æ—Å—å–µ)"**
${AI_SYSTEM_PROMPT_DOSSIER}
---
### **–°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢: "–ù–ê–£–ß–ù–´–ô –ê–ù–ê–õ–ò–¢–ò–ö (–ê–Ω–∞–ª–∏–∑)"**
${AI_SYSTEM_PROMPT_SCIENTIST}
---

–¢–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¢–û–õ–¨–ö–û –æ—Ç–≤–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ä–æ–ª–∏. –ù–µ –ø–∏—à–∏, –∫–∞–∫—É—é —Ä–æ–ª—å —Ç—ã –≤—ã–±—Ä–∞–ª. –ü—Ä–æ—Å—Ç–æ —Å—Ç–∞–Ω—å –µ—é –∏ –æ—Ç–≤–µ—á–∞–π.`;


    // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
    const queryInput = document.getElementById('user-query');
    const sendButton = document.getElementById('send-btn');
    const responseContainer = document.getElementById('ai-response');
    const responseWrapper = document.getElementById('response-wrapper');
    const responseActions = document.getElementById('response-actions');
    const copyButton = document.getElementById('copy-btn');
    const printButton = document.getElementById('print-btn');
    const newChatBtn = document.getElementById('new-chat-btn');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModalOverlay = document.getElementById('settings-modal-overlay');
    const saveSettingsBtn = document.getElementById('save-settings-btn');
    const apiKeyInput = document.getElementById('api-key-input');
    const apiKeyInputGroup = document.getElementById('api-key-input-group');
    const modelSelector = document.getElementById('model-selector');
    const historyBtn = document.getElementById('history-btn');
    const historyPopup = document.getElementById('history-popup');

    // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ API
    const originalApiControlsParent = document.querySelector('.header-right-controls-movable');
    const modalApiControlsPlaceholder = document.getElementById('modal-api-controls-placeholder');
    const apiModeSelectorButton = document.getElementById('api-mode-selector-button');
    const apiModeOptions = document.getElementById('api-mode-options');

    // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    let apiKey = null;
    let currentApiMode = 'mapruapp';
    let currentModelId = DEFAULT_MODEL_ID;
    let currentApiType = 'gemini';
    let conversationHistory = [];
    let requestHistory = [];
    let abortController = null;
    let isLoading = false;


    const WELCOME_HTML = `<div class="welcome-message">
        <i class="fa-solid fa-brain"></i>
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–Ω–∞–ª–∏—Ç–∏–∫!</h2>
        <p>–Ø –º–æ–≥—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, —Å–æ–±—Ä–∞—Ç—å –¥–æ—Å—å–µ, —Å—Ä–∞–≤–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –∏–ª–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ —Å—Å—ã–ª–∫–µ. –ü—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å.</p>
    </div>`;

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    const initializeApp = () => {
        marked.setOptions({ renderer: new marked.Renderer(), gfm: true, breaks: true });

        populateApiModeOptions();
        loadSettings();
        setWelcomeMessage();

        // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ---
        sendButton.addEventListener('click', handleRequest);
        queryInput.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleRequest(); } });
        queryInput.addEventListener('input', () => {
            const textarea = queryInput;
            textarea.style.height = 'auto'; // Reset height
            textarea.style.height = (textarea.scrollHeight) + 'px';
        });

        copyButton.addEventListener('click', copyResponse);
        printButton.addEventListener('click', printResponse);
        newChatBtn.addEventListener('click', startNewChat);

        settingsBtn.addEventListener('click', openSettingsModal);
        saveSettingsBtn.addEventListener('click', saveSettings);
        settingsModalOverlay.addEventListener('click', (e) => { if (e.target === settingsModalOverlay) closeSettingsModal(); });

        historyBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            populateHistoryPopup();
            historyPopup.style.display = historyPopup.style.display === 'block' ? 'none' : 'block';
        });

        document.addEventListener('click', (event) => {
            if (!historyBtn.contains(event.target) && !historyPopup.contains(event.target)) {
                historyPopup.style.display = 'none';
            }
             if (apiModeOptions && !apiModeSelectorButton.contains(event.target) && !apiModeOptions.contains(event.target)) {
                apiModeOptions.style.display = 'none';
            }
        });

    };

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï UI ---
    const setWelcomeMessage = () => {
        responseContainer.innerHTML = WELCOME_HTML;
        responseActions.style.display = 'none';
        toggleInputs(false);
    };

    const getLoaderHTML = () => {
        return `<div class="loader">
            <i class="fa-solid fa-atom loader-icon loader-icon-universal"></i>
            <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–¥–±–∏—Ä–∞—é —ç–∫—Å–ø–µ—Ä—Ç–∞...</p>
            <button id="cancel-btn">–û—Ç–º–µ–Ω–∏—Ç—å</button>
        </div>`;
    };

    const getErrorHTML = (errorMsg) => {
        return `<div class="welcome-message" style="color: var(--danger-color);"><i class="fa-solid fa-triangle-exclamation fa-2x"></i><h3 style="color: var(--danger-color); border: none; margin-top:15px;">–û—à–∏–±–∫–∞</h3><p>${errorMsg}</p><button class="action-btn" onclick="document.getElementById('send-btn').click()" style="background-color: var(--primary-color); margin-top: 20px;"><i class="fa-solid fa-rotate-right"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button></div>`;
    };


    const toggleInputs = (disable) => {
        isLoading = disable;
        queryInput.disabled = disable;
        sendButton.disabled = disable;
    };

    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const openSettingsModal = () => {
        const apiModeSelector = originalApiControlsParent.querySelector('.api-mode-selector-container');
        if (apiModeSelector) {
            modalApiControlsPlaceholder.appendChild(apiModeSelector);
        }
        settingsModalOverlay.style.display = 'flex';
    };

    const closeSettingsModal = () => {
        const apiModeSelector = modalApiControlsPlaceholder.querySelector('.api-mode-selector-container');
        if (apiModeSelector) {
            originalApiControlsParent.appendChild(apiModeSelector);
        }
        settingsModalOverlay.style.display = 'none';
    };

    const updateApiKeyInputVisibility = () => {
        apiKeyInputGroup.style.display = (currentApiMode === 'direct' && currentApiType === 'gemini') ? 'block' : 'none';
    };

    const updateSettingsUI = () => {
        const selectedOption = modelSelector.options[modelSelector.selectedIndex];
        currentModelId = selectedOption.value;
        currentApiType = selectedOption.dataset.apiType;

        const mode = API_MODES[currentApiMode];
        if (mode && apiModeSelectorButton) {
            apiModeSelectorButton.innerHTML = `${mode.icon}<span class="text">${mode.uiName}</span>`;
        }
        
        updateApiKeyInputVisibility();
    };

    const saveSettings = () => {
        const key = apiKeyInput.value.trim();
        updateSettingsUI();

        if (currentApiMode === 'direct' && currentApiType === 'gemini' && !key) {
            alert('–î–ª—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ "Gemini" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ API –∫–ª—é—á.');
            return;
        }

        apiKey = key;
        localStorage.setItem('advisorApiKey', key);
        localStorage.setItem('advisorModelId', currentModelId);
        localStorage.setItem('advisorApiMode', currentApiMode);
        closeSettingsModal();
    };

    const loadSettings = () => {
        apiKey = localStorage.getItem('advisorApiKey') || '';
        apiKeyInput.value = apiKey;

        const savedModel = localStorage.getItem('advisorModelId');
        if (modelSelector.querySelector(`option[value="${savedModel}"]`)) {
            modelSelector.value = savedModel;
        } else {
            modelSelector.value = DEFAULT_MODEL_ID;
        }

        const savedApiMode = localStorage.getItem('advisorApiMode');
        currentApiMode = API_MODES[savedApiMode] ? savedApiMode : 'mapruapp';

        updateSettingsUI();
    };

    const populateApiModeOptions = () => {
        apiModeOptions.innerHTML = '';
        Object.keys(API_MODES).forEach(modeId => {
            const mode = API_MODES[modeId];
            const option = document.createElement('li');
            option.className = 'api-mode-option';
            option.dataset.apiMode = modeId;
            option.innerHTML = `${mode.icon} <span>${mode.uiName}</span>`;
            option.addEventListener('click', () => {
                currentApiMode = modeId;
                document.querySelectorAll('.api-mode-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                apiModeOptions.style.display = 'none';
                updateSettingsUI();
            });
            apiModeOptions.appendChild(option);
        });
    };

    // --- –ò–°–¢–û–†–ò–Ø –ó–ê–ü–†–û–°–û–í ---
    const populateHistoryPopup = () => {
        historyPopup.innerHTML = '';
        if (requestHistory.length === 0) {
            historyPopup.innerHTML = '<div class="history-popup-empty">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞.</div>';
            return;
        }
        [...requestHistory].reverse().forEach(query => {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.textContent = query;
            item.title = query;
            item.addEventListener('click', () => {
                queryInput.value = query;
                historyPopup.style.display = 'none';
                queryInput.focus();
                queryInput.dispatchEvent(new Event('input', { bubbles: true }));
            });
            historyPopup.appendChild(item);
        });
    };

    // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ó–ê–ü–†–û–°–ê ---
    const handleRequest = async () => {
        const userQuery = queryInput.value.trim();
        if (!userQuery || isLoading) return;

        if (currentApiMode === 'direct' && currentApiType === 'gemini' && !apiKey) {
            openSettingsModal();
            return;
        }

        toggleInputs(true);
        abortController = new AbortController();

        if (requestHistory.length === 0 || requestHistory[requestHistory.length - 1] !== userQuery) {
            requestHistory.push(userQuery);
        }

        responseContainer.innerHTML = getLoaderHTML();
        const cancelButton = document.getElementById('cancel-btn');
        if(cancelButton) cancelButton.addEventListener('click', cancelRequest);

        // –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—Ç–≤–µ—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –±—ã–ª —Å–≤–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–æ–º —Ä–æ–ª–∏
        conversationHistory = [{ role: 'user', content: userQuery }];

        try {
            let apiUrl;
            let requestBody;
            const headers = { 'Content-Type': 'application/json' };
            const systemPrompt = MASTER_PROMPT;
            const apiModeConfig = API_MODES[currentApiMode];
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è API
            const messages = [
                { role: 'system', content: systemPrompt },
                { role: 'user', content: userQuery }
            ];

            if (currentApiMode === 'mapruapp') {
                apiUrl = apiModeConfig.geminiUrl();
                requestBody = { model: currentModelId, messages: messages, max_tokens: 8192 };
            } else if (currentApiMode === 'vercel' || currentApiMode === 'direct') {
                apiUrl = apiModeConfig.geminiUrl(currentModelId, apiKey);
                const geminiContents = [{ role: 'user', parts: [{ text: userQuery }] }];
                requestBody = { 
                    contents: geminiContents, 
                    systemInstruction: { parts: [{text: systemPrompt}] },
                    generationConfig: {
                        maxOutputTokens: 8192
                    }
                };
            }

            if (!apiUrl) {
                throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å URL –¥–ª—è API —Ä–µ–∂–∏–º–∞ '${currentApiMode}'.`);
            }

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(requestBody),
                signal: abortController.signal
            });

            if (!response.ok) {
                const errorData = await response.json().catch(()=>({}));
                const errorMessage = errorData.error?.message || `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${response.status}`;
                throw new Error(errorMessage);
            }
            const data = await response.json();

            let aiResponseText;
            if (currentApiMode === 'mapruapp') {
                 aiResponseText = data.choices?.[0]?.message?.content;
            } else { // direct or vercel gemini
                aiResponseText = data.candidates?.[0]?.content?.parts[0]?.text;
            }


            if (!aiResponseText) { throw new Error('–ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API.'); }

            responseContainer.innerHTML = marked.parse(aiResponseText);
            responseActions.style.display = 'flex';

        } catch (error) {
            if (error.name === 'AbortError') {
                startNewChat();
                return;
            }
            console.error('API Error:', error);
            responseContainer.innerHTML = getErrorHTML(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. ${error.message}`);
        } finally {
            toggleInputs(false);
            // queryInput.value = ''; // –ù–µ –æ—á–∏—â–∞–µ–º, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –≤–∏–¥–µ—Ç—å —Å–≤–æ–π –¥–ª–∏–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
            // queryInput.style.height = 'auto'; // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
            abortController = null;
        }
    };

    // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
    const startNewChat = () => {
        if (isLoading) cancelRequest();
        conversationHistory = [];
        queryInput.value = '';
        queryInput.style.height = 'auto';
        setWelcomeMessage();
    };

    const cancelRequest = () => {
        if (abortController) {
            abortController.abort();
        }
    };

    const copyResponse = () => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = responseContainer.innerHTML;
        navigator.clipboard.writeText(tempDiv.innerText)
            .then(() => alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.'))
            .catch(err => console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err));
    };


    const printResponse = () => window.print();

    // --- –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
    initializeApp();
});
    </script>
</body>
</html>