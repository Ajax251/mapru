<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª—ë—Ç —Å–∫–≤–æ–∑—å –ö–æ—Å–º–æ—Å</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #000;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        #bgCanvas {
            z-index: 1;
        }

        #mainCanvas {
            z-index: 2;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 5, 20, 0.9);
            padding: 20px;
            border-radius: 15px;
            color: #fff;
            width: 320px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(100, 150, 255, 0.2);
            box-shadow: 0 0 40px rgba(100, 150, 255, 0.15);
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .controls.hidden {
            transform: translateX(350px);
        }

        .toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 10, 30, 0.9);
            color: #fff;
            border: 1px solid rgba(100, 150, 255, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            z-index: 999;
        }

        .toggle-btn:hover {
            background: rgba(50, 100, 200, 0.5);
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #b8d4ff;
            font-weight: 300;
            letter-spacing: 3px;
            font-size: 16px;
        }

        .section-title {
            color: #7eb8ff;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            margin-top: 5px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 12px;
            color: #8ab4e8;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            border-radius: 3px;
            background: linear-gradient(90deg, #0a1a3a, #2a5a9a);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #a0d0ff, #4080c0);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(100, 180, 255, 0.6);
        }

        input[type="color"] {
            width: 100%;
            height: 35px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }

        .value-display {
            float: right;
            color: #a0d0ff;
            font-weight: 500;
            font-size: 11px;
        }

        select {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid rgba(100, 150, 255, 0.2);
            background: rgba(0, 15, 40, 0.9);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #1a4a8a, #2a6aba);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: linear-gradient(135deg, #2a5a9a, #3a7aca);
            box-shadow: 0 0 20px rgba(50, 150, 255, 0.3);
        }

        .separator {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(100, 150, 255, 0.2), transparent);
            margin: 18px 0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4a90d0;
        }

        .checkbox-group label {
            margin: 0;
            font-size: 12px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .preset-buttons button {
            padding: 8px 5px;
            font-size: 11px;
        }

        .info-text {
            font-size: 10px;
            color: #5a7a9a;
            text-align: center;
            margin-top: 15px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 20, 50, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 150, 255, 0.3);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <canvas id="bgCanvas"></canvas>
    <canvas id="mainCanvas"></canvas>
    
    <button class="toggle-btn" id="toggleBtn">‚ú¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    
    <div class="controls" id="controls">
        <h2>üåå –ö–û–°–ú–û–° üåå</h2>
        
        <div class="section-title">–î–≤–∏–∂–µ–Ω–∏–µ</div>
        
        <div class="control-group">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–ª—ë—Ç–∞ <span class="value-display" id="speedVal">1.0</span></label>
            <input type="range" id="speed" min="0.1" max="5" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label>–î–ª–∏–Ω–∞ —Å–ª–µ–¥–∞ <span class="value-display" id="trailVal">0.15</span></label>
            <input type="range" id="trailLength" min="0.01" max="0.5" step="0.01" value="0.15">
        </div>
        
        <div class="control-group">
            <label>–ì–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ <span class="value-display" id="depthVal">2000</span></label>
            <input type="range" id="depth" min="500" max="4000" step="100" value="2000">
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–ó–≤—ë–∑–¥—ã</div>
        
        <div class="control-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥ <span class="value-display" id="starCountVal">600</span></label>
            <input type="range" id="starCount" min="100" max="2000" step="50" value="600">
        </div>
        
        <div class="control-group">
            <label>–†–∞–∑–º–µ—Ä –∑–≤—ë–∑–¥ <span class="value-display" id="starSizeVal">1.5</span></label>
            <input type="range" id="starSize" min="0.5" max="4" step="0.1" value="1.5">
        </div>
        
        <div class="control-group">
            <label>–ú–µ—Ä—Ü–∞–Ω–∏–µ <span class="value-display" id="twinkleVal">0.5</span></label>
            <input type="range" id="twinkle" min="0" max="1" step="0.1" value="0.5">
        </div>
        
        <div class="control-group">
            <label>–°–≤–µ—á–µ–Ω–∏–µ –∑–≤—ë–∑–¥ <span class="value-display" id="starGlowVal">15</span></label>
            <input type="range" id="starGlow" min="0" max="40" step="1" value="15">
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–ì–∞–ª–∞–∫—Ç–∏–∫–∏</div>
        
        <div class="control-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–ª–∞–∫—Ç–∏–∫ <span class="value-display" id="galaxyCountVal">8</span></label>
            <input type="range" id="galaxyCount" min="0" max="20" step="1" value="8">
        </div>
        
        <div class="control-group">
            <label>–†–∞–∑–º–µ—Ä –≥–∞–ª–∞–∫—Ç–∏–∫ <span class="value-display" id="galaxySizeVal">1.0</span></label>
            <input type="range" id="galaxySize" min="0.3" max="2" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label>–ó–≤—ë–∑–¥ –≤ –≥–∞–ª–∞–∫—Ç–∏–∫–µ <span class="value-display" id="galaxyStarsVal">200</span></label>
            <input type="range" id="galaxyStars" min="50" max="500" step="10" value="200">
        </div>
        
        <div class="control-group">
            <label>–ó–∞–∫—Ä—É—á–µ–Ω–Ω–æ—Å—Ç—å <span class="value-display" id="spiralVal">3.0</span></label>
            <input type="range" id="spiral" min="1" max="6" step="0.5" value="3">
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–¢—É–º–∞–Ω–Ω–æ—Å—Ç–∏</div>
        
        <div class="control-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π <span class="value-display" id="nebulaCountVal">5</span></label>
            <input type="range" id="nebulaCount" min="0" max="15" step="1" value="5">
        </div>
        
        <div class="control-group">
            <label>–†–∞–∑–º–µ—Ä —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π <span class="value-display" id="nebulaSizeVal">1.0</span></label>
            <input type="range" id="nebulaSize" min="0.3" max="2" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label>–Ø—Ä–∫–æ—Å—Ç—å —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π <span class="value-display" id="nebulaAlphaVal">0.3</span></label>
            <input type="range" id="nebulaAlpha" min="0.1" max="0.8" step="0.05" value="0.3">
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–¶–≤–µ—Ç–∞</div>
        
        <div class="control-group">
            <label>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞</label>
            <select id="colorScheme">
                <option value="realistic">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–æ—Å–º–æ—Å</option>
                <option value="blue">–ì–æ–ª—É–±–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è</option>
                <option value="warm">–¢—ë–ø–ª—ã–π –∫–æ—Å–º–æ—Å</option>
                <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –≥–∞–ª–∞–∫—Ç–∏–∫–∞</option>
                <option value="neon">–ù–µ–æ–Ω–æ–≤—ã–π</option>
                <option value="mono">–ú–æ–Ω–æ—Ö—Ä–æ–º</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
            <input type="color" id="bgColor" value="#000308">
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–≠—Ñ—Ñ–µ–∫—Ç—ã</div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="mouseControl" checked>
            <label>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="showNebula" checked>
            <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–∏</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="showGalaxies" checked>
            <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥–∞–ª–∞–∫—Ç–∏–∫–∏</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="starTrails">
            <label>–°–ª–µ–¥—ã –æ—Ç –∑–≤—ë–∑–¥</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="cosmicDust" checked>
            <label>–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø—ã–ª—å</label>
        </div>
        
        <div class="separator"></div>
        <div class="section-title">–ü—Ä–µ—Å–µ—Ç—ã</div>
        
        <div class="preset-buttons">
            <button onclick="applyPreset('deepSpace')">–ì–ª—É–±–æ–∫–∏–π –∫–æ—Å–º–æ—Å</button>
            <button onclick="applyPreset('hyperspace')">–ì–∏–ø–µ—Ä–ø—Ä—ã–∂–æ–∫</button>
            <button onclick="applyPreset('nebula')">–¢—É–º–∞–Ω–Ω–æ—Å—Ç—å</button>
            <button onclick="applyPreset('galaxyCluster')">–°–∫–æ–ø–ª–µ–Ω–∏–µ</button>
            <button onclick="applyPreset('calm')">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</button>
            <button onclick="applyPreset('scifi')">Sci-Fi</button>
        </div>
        
        <button onclick="resetSettings()" style="margin-top: 12px;">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
        
        <div class="info-text">–î–≤–∏–≥–∞–π—Ç–µ –º—ã—à—å—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º</div>
    </div>

    <script>
        const bgCanvas = document.getElementById('bgCanvas');
        const mainCanvas = document.getElementById('mainCanvas');
        const bgCtx = bgCanvas.getContext('2d');
        const ctx = mainCanvas.getContext('2d');
        
        let width, height, centerX, centerY;
        let stars = [];
        let galaxies = [];
        let nebulae = [];
        let dust = [];
        let mouseX = 0, mouseY = 0;
        let targetOffsetX = 0, targetOffsetY = 0;
        let currentOffsetX = 0, currentOffsetY = 0;
        let time = 0;
        
        const settings = {
            speed: 1,
            trailLength: 0.15,
            depth: 2000,
            starCount: 600,
            starSize: 1.5,
            twinkle: 0.5,
            starGlow: 15,
            galaxyCount: 8,
            galaxySize: 1,
            galaxyStars: 200,
            spiral: 3,
            nebulaCount: 5,
            nebulaSize: 1,
            nebulaAlpha: 0.3,
            colorScheme: 'realistic',
            bgColor: '#000308',
            mouseControl: true,
            showNebula: true,
            showGalaxies: true,
            starTrails: false,
            cosmicDust: true
        };
        
        const colorSchemes = {
            realistic: {
                stars: ['#ffffff', '#ffe4c4', '#ffd700', '#87ceeb', '#ff6b6b', '#b0c4de'],
                galaxyCore: '#fff8e7',
                galaxyArms: ['#a0c4ff', '#c4a0ff', '#ffa0c4'],
                nebula: ['#ff006630', '#0066ff30', '#ff00ff20', '#00ffff20']
            },
            blue: {
                stars: ['#ffffff', '#a0d4ff', '#60b0ff', '#c0e0ff', '#80c0ff'],
                galaxyCore: '#e0f0ff',
                galaxyArms: ['#4080ff', '#60a0ff', '#80c0ff'],
                nebula: ['#0044ff30', '#0088ff25', '#00aaff20', '#0066ff30']
            },
            warm: {
                stars: ['#ffffff', '#ffd700', '#ffa500', '#ff8c00', '#ffb347'],
                galaxyCore: '#fff5e0',
                galaxyArms: ['#ffa040', '#ff8060', '#ffc080'],
                nebula: ['#ff440030', '#ff880025', '#ffaa0020', '#ff660028']
            },
            purple: {
                stars: ['#ffffff', '#e0b0ff', '#c080ff', '#a060ff', '#d0a0ff'],
                galaxyCore: '#f0e0ff',
                galaxyArms: ['#a040ff', '#c060ff', '#8020ff'],
                nebula: ['#8800ff30', '#aa00ff25', '#cc00ff20', '#6600ff28']
            },
            neon: {
                stars: ['#ffffff', '#00ffff', '#ff00ff', '#00ff00', '#ffff00'],
                galaxyCore: '#ffffff',
                galaxyArms: ['#00ffff', '#ff00ff', '#00ff00'],
                nebula: ['#00ffff30', '#ff00ff30', '#00ff0025', '#ffff0020']
            },
            mono: {
                stars: ['#ffffff', '#e0e0e0', '#c0c0c0', '#a0a0a0', '#d0d0d0'],
                galaxyCore: '#ffffff',
                galaxyArms: ['#a0a0a0', '#c0c0c0', '#808080'],
                nebula: ['#ffffff15', '#ffffff10', '#ffffff12', '#ffffff08']
            }
        };
        
        function resize() {
            width = bgCanvas.width = mainCanvas.width = window.innerWidth;
            height = bgCanvas.height = mainCanvas.height = window.innerHeight;
            centerX = width / 2;
            centerY = height / 2;
        }
        
        function createStar() {
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.random() * Math.max(width, height) * 1.5;
            const colors = colorSchemes[settings.colorScheme].stars;
            return {
                x: Math.cos(angle) * radius,
                y: Math.sin(angle) * radius,
                z: Math.random() * settings.depth,
                prevZ: settings.depth,
                prevX: 0,
                prevY: 0,
                size: 0.3 + Math.random() * 1.7,
                color: colors[Math.floor(Math.random() * colors.length)],
                twinkleOffset: Math.random() * Math.PI * 2,
                twinkleSpeed: 1 + Math.random() * 3
            };
        }
        
        function createGalaxy() {
            return {
                x: (Math.random() - 0.5) * width * 3,
                y: (Math.random() - 0.5) * height * 3,
                z: 200 + Math.random() * (settings.depth - 400),
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.001,
                tilt: 0.3 + Math.random() * 0.5,
                arms: 2 + Math.floor(Math.random() * 3),
                size: 80 + Math.random() * 120
            };
        }
        
        function createNebula() {
            const colors = colorSchemes[settings.colorScheme].nebula;
            return {
                x: (Math.random() - 0.5) * width * 3,
                y: (Math.random() - 0.5) * height * 3,
                z: 300 + Math.random() * (settings.depth - 500),
                size: 150 + Math.random() * 250,
                color: colors[Math.floor(Math.random() * colors.length)],
                noiseOffset: Math.random() * 1000
            };
        }
        
        function createDust() {
            return {
                x: (Math.random() - 0.5) * width * 2,
                y: (Math.random() - 0.5) * height * 2,
                z: Math.random() * settings.depth,
                size: 0.5 + Math.random() * 1.5,
                alpha: 0.1 + Math.random() * 0.3
            };
        }
        
        function initObjects() {
            stars = [];
            galaxies = [];
            nebulae = [];
            dust = [];
            
            for (let i = 0; i < settings.starCount; i++) {
                stars.push(createStar());
            }
            
            for (let i = 0; i < settings.galaxyCount; i++) {
                galaxies.push(createGalaxy());
            }
            
            for (let i = 0; i < settings.nebulaCount; i++) {
                nebulae.push(createNebula());
            }
            
            for (let i = 0; i < 200; i++) {
                dust.push(createDust());
            }
        }
        
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        function update() {
            const speed = settings.speed * 8;
            
            // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞ –º—ã—à—å—é
            if (settings.mouseControl) {
                targetOffsetX = (mouseX - centerX) * 0.15;
                targetOffsetY = (mouseY - centerY) * 0.15;
            } else {
                targetOffsetX = 0;
                targetOffsetY = 0;
            }
            currentOffsetX += (targetOffsetX - currentOffsetX) * 0.02;
            currentOffsetY += (targetOffsetY - currentOffsetY) * 0.02;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤—ë–∑–¥
            for (let star of stars) {
                star.prevZ = star.z;
                star.prevX = star.x;
                star.prevY = star.y;
                star.z -= speed * (0.5 + star.size * 0.3);
                
                if (star.z <= 0) {
                    Object.assign(star, createStar());
                    star.z = settings.depth;
                    star.prevZ = settings.depth;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–∞–ª–∞–∫—Ç–∏–∫
            for (let galaxy of galaxies) {
                galaxy.z -= speed * 0.3;
                galaxy.rotation += galaxy.rotationSpeed;
                
                if (galaxy.z <= 50) {
                    Object.assign(galaxy, createGalaxy());
                    galaxy.z = settings.depth;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—É–º–∞–Ω–Ω–æ—Å—Ç–µ–π
            for (let nebula of nebulae) {
                nebula.z -= speed * 0.2;
                
                if (nebula.z <= 50) {
                    Object.assign(nebula, createNebula());
                    nebula.z = settings.depth;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—ã–ª–∏
            for (let d of dust) {
                d.z -= speed * 0.5;
                
                if (d.z <= 0) {
                    Object.assign(d, createDust());
                    d.z = settings.depth;
                }
            }
            
            time += 0.016;
        }
        
        function drawNebula(nebula) {
            const scale = 600 / (300 + nebula.z);
            const x = centerX + (nebula.x + currentOffsetX) * scale;
            const y = centerY + (nebula.y + currentOffsetY) * scale;
            const size = nebula.size * scale * settings.nebulaSize;
            
            if (x < -size || x > width + size || y < -size || y > height + size) return;
            if (size < 5) return;
            
            const alpha = Math.min(settings.nebulaAlpha, (1 - nebula.z / settings.depth) * settings.nebulaAlpha);
            
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
            const baseColor = nebula.color.slice(0, 7);
            gradient.addColorStop(0, hexToRgba(baseColor, alpha * 0.8));
            gradient.addColorStop(0.3, hexToRgba(baseColor, alpha * 0.4));
            gradient.addColorStop(0.6, hexToRgba(baseColor, alpha * 0.15));
            gradient.addColorStop(1, 'transparent');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawGalaxy(galaxy) {
            const scale = 600 / (300 + galaxy.z);
            const x = centerX + (galaxy.x + currentOffsetX) * scale;
            const y = centerY + (galaxy.y + currentOffsetY) * scale;
            const size = galaxy.size * scale * settings.galaxySize;
            
            if (x < -size * 2 || x > width + size * 2 || y < -size * 2 || y > height + size * 2) return;
            if (size < 3) return;
            
            const alpha = Math.min(1, (1 - galaxy.z / settings.depth) * 1.5);
            const scheme = colorSchemes[settings.colorScheme];
            
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(1, galaxy.tilt);
            ctx.rotate(galaxy.rotation);
            
            // –Ø–¥—Ä–æ –≥–∞–ª–∞–∫—Ç–∏–∫–∏
            const coreGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 0.3);
            coreGradient.addColorStop(0, hexToRgba(scheme.galaxyCore, alpha * 0.9));
            coreGradient.addColorStop(0.5, hexToRgba(scheme.galaxyCore, alpha * 0.3));
            coreGradient.addColorStop(1, 'transparent');
            
            ctx.fillStyle = coreGradient;
            ctx.beginPath();
            ctx.arc(0, 0, size * 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            // –°–ø–∏—Ä–∞–ª—å–Ω—ã–µ —Ä—É–∫–∞–≤–∞
            const starCount = Math.floor(settings.galaxyStars * scale);
            for (let i = 0; i < starCount; i++) {
                const arm = i % galaxy.arms;
                const armAngle = (arm / galaxy.arms) * Math.PI * 2;
                const progress = (i / starCount) * settings.spiral;
                const angle = armAngle + progress * Math.PI;
                const dist = (progress / settings.spiral) * size;
                
                const spread = 0.3 + (dist / size) * 0.5;
                const offsetAngle = (Math.random() - 0.5) * spread;
                const offsetDist = (Math.random() - 0.5) * size * 0.15;
                
                const sx = Math.cos(angle + offsetAngle) * (dist + offsetDist);
                const sy = Math.sin(angle + offsetAngle) * (dist + offsetDist);
                
                const starAlpha = alpha * (0.3 + Math.random() * 0.7) * (1 - dist / size * 0.5);
                const starSize = (0.5 + Math.random()) * Math.max(0.5, scale * 0.5);
                
                const armColor = scheme.galaxyArms[arm % scheme.galaxyArms.length];
                
                ctx.fillStyle = hexToRgba(armColor, starAlpha);
                ctx.beginPath();
                ctx.arc(sx, sy, starSize, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.restore();
        }
        
        function drawStar(star) {
            const scale = settings.depth / (settings.depth + star.z);
            const x = centerX + (star.x + currentOffsetX) * scale;
            const y = centerY + (star.y + currentOffsetY) * scale;
            
            if (x < -20 || x > width + 20 || y < -20 || y > height + 20) return;
            
            // –ú–µ—Ä—Ü–∞–Ω–∏–µ
            const twinkle = settings.twinkle > 0 ? 
                0.5 + 0.5 * Math.sin(time * star.twinkleSpeed + star.twinkleOffset) * settings.twinkle : 1;
            
            const alpha = Math.min(1, (1 - star.z / settings.depth) * 2) * twinkle;
            const size = star.size * scale * settings.starSize;
            
            // –°–ª–µ–¥ –æ—Ç –∑–≤–µ–∑–¥—ã
            if (settings.starTrails && star.prevZ !== settings.depth) {
                const prevScale = settings.depth / (settings.depth + star.prevZ);
                const prevX = centerX + (star.prevX + currentOffsetX) * prevScale;
                const prevY = centerY + (star.prevY + currentOffsetY) * prevScale;
                
                ctx.strokeStyle = hexToRgba(star.color, alpha * 0.5);
                ctx.lineWidth = size * 0.5;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(prevX, prevY);
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            
            // –°–≤–µ—á–µ–Ω–∏–µ
            if (settings.starGlow > 0 && size > 1) {
                ctx.shadowBlur = settings.starGlow * scale;
                ctx.shadowColor = star.color;
            }
            
            ctx.fillStyle = hexToRgba(star.color, alpha);
            ctx.beginPath();
            ctx.arc(x, y, Math.max(0.5, size), 0, Math.PI * 2);
            ctx.fill();
            
            // –õ—É—á–∏ –¥–ª—è —è—Ä–∫–∏—Ö –∑–≤—ë–∑–¥
            if (size > 2 && alpha > 0.7) {
                ctx.strokeStyle = hexToRgba(star.color, alpha * 0.3);
                ctx.lineWidth = 0.5;
                const rayLength = size * 3;
                
                ctx.beginPath();
                ctx.moveTo(x - rayLength, y);
                ctx.lineTo(x + rayLength, y);
                ctx.moveTo(x, y - rayLength);
                ctx.lineTo(x, y + rayLength);
                ctx.stroke();
            }
            
            ctx.shadowBlur = 0;
        }
        
        function drawDust(d) {
            if (!settings.cosmicDust) return;
            
            const scale = settings.depth / (settings.depth + d.z);
            const x = centerX + (d.x + currentOffsetX) * scale;
            const y = centerY + (d.y + currentOffsetY) * scale;
            
            if (x < 0 || x > width || y < 0 || y > height) return;
            
            const alpha = d.alpha * (1 - d.z / settings.depth);
            
            ctx.fillStyle = `rgba(180, 200, 255, ${alpha})`;
            ctx.beginPath();
            ctx.arc(x, y, d.size * scale, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function draw() {
            // –û—á–∏—Å—Ç–∫–∞ —Å –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º
            ctx.fillStyle = settings.bgColor;
            ctx.globalAlpha = settings.trailLength;
            ctx.fillRect(0, 0, width, height);
            ctx.globalAlpha = 1;
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–ª—É–±–∏–Ω–µ
            const allObjects = [];
            
            if (settings.showNebula) {
                nebulae.forEach(n => allObjects.push({ type: 'nebula', obj: n, z: n.z }));
            }
            
            if (settings.showGalaxies) {
                galaxies.forEach(g => allObjects.push({ type: 'galaxy', obj: g, z: g.z }));
            }
            
            dust.forEach(d => allObjects.push({ type: 'dust', obj: d, z: d.z }));
            stars.forEach(s => allObjects.push({ type: 'star', obj: s, z: s.z }));
            
            allObjects.sort((a, b) => b.z - a.z);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            for (let item of allObjects) {
                switch (item.type) {
                    case 'nebula': drawNebula(item.obj); break;
                    case 'galaxy': drawGalaxy(item.obj); break;
                    case 'dust': drawDust(item.obj); break;
                    case 'star': drawStar(item.obj); break;
                }
            }
        }
        
        function animate() {
            update();
            draw();
            requestAnimationFrame(animate);
        }
        
        // –°–æ–±—ã—Ç–∏—è
        window.addEventListener('resize', resize);
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        // –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
        function bindControl(id, prop, callback) {
            const el = document.getElementById(id);
            const valDisplay = document.getElementById(id + 'Val');
            
            if (!el) return;
            
            el.addEventListener('input', () => {
                if (el.type === 'checkbox') {
                    settings[prop] = el.checked;
                } else {
                    settings[prop] = parseFloat(el.value);
                    if (valDisplay) valDisplay.textContent = el.value;
                }
                if (callback) callback();
            });
        }
        
        bindControl('speed', 'speed');
        bindControl('trailLength', 'trailLength');
        bindControl('depth', 'depth', initObjects);
        bindControl('starCount', 'starCount', initObjects);
        bindControl('starSize', 'starSize');
        bindControl('twinkle', 'twinkle');
        bindControl('starGlow', 'starGlow');
        bindControl('galaxyCount', 'galaxyCount', initObjects);
        bindControl('galaxySize', 'galaxySize');
        bindControl('galaxyStars', 'galaxyStars');
        bindControl('spiral', 'spiral');
        bindControl('nebulaCount', 'nebulaCount', initObjects);
        bindControl('nebulaSize', 'nebulaSize');
        bindControl('nebulaAlpha', 'nebulaAlpha');
        bindControl('mouseControl', 'mouseControl');
        bindControl('showNebula', 'showNebula');
        bindControl('showGalaxies', 'showGalaxies');
        bindControl('starTrails', 'starTrails');
        bindControl('cosmicDust', 'cosmicDust');
        
        document.getElementById('colorScheme').addEventListener('change', (e) => {
            settings.colorScheme = e.target.value;
            initObjects();
        });
        
        document.getElementById('bgColor').addEventListener('input', (e) => {
            settings.bgColor = e.target.value;
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
        document.getElementById('toggleBtn').addEventListener('click', () => {
            document.getElementById('controls').classList.toggle('hidden');
        });
        
        // –ü—Ä–µ—Å–µ—Ç—ã
        function applyPreset(name) {
            const presets = {
                deepSpace: {
                    speed: 0.8, trailLength: 0.12, depth: 2500, starCount: 800,
                    starSize: 1.2, twinkle: 0.6, starGlow: 12, galaxyCount: 12,
                    galaxySize: 1.2, galaxyStars: 250, nebulaCount: 8, nebulaSize: 1.2,
                    nebulaAlpha: 0.25, colorScheme: 'realistic', bgColor: '#000205'
                },
                hyperspace: {
                    speed: 4, trailLength: 0.4, depth: 1500, starCount: 1200,
                    starSize: 2, twinkle: 0, starGlow: 25, galaxyCount: 3,
                    galaxySize: 0.5, galaxyStars: 100, nebulaCount: 2, nebulaSize: 0.8,
                    nebulaAlpha: 0.15, colorScheme: 'blue', bgColor: '#000510',
                    starTrails: true
                },
                nebula: {
                    speed: 0.5, trailLength: 0.08, depth: 2000, starCount: 400,
                    starSize: 1, twinkle: 0.7, starGlow: 10, galaxyCount: 5,
                    galaxySize: 0.8, galaxyStars: 150, nebulaCount: 12, nebulaSize: 1.5,
                    nebulaAlpha: 0.4, colorScheme: 'purple', bgColor: '#050008'
                },
                galaxyCluster: {
                    speed: 0.6, trailLength: 0.1, depth: 3000, starCount: 500,
                    starSize: 1, twinkle: 0.5, starGlow: 8, galaxyCount: 20,
                    galaxySize: 1.3, galaxyStars: 300, nebulaCount: 3, nebulaSize: 1,
                    nebulaAlpha: 0.2, colorScheme: 'realistic', bgColor: '#000308'
                },
                calm: {
                    speed: 0.3, trailLength: 0.05, depth: 2000, starCount: 300,
                    starSize: 1.5, twinkle: 0.8, starGlow: 20, galaxyCount: 5,
                    galaxySize: 1, galaxyStars: 200, nebulaCount: 6, nebulaSize: 1.2,
                    nebulaAlpha: 0.35, colorScheme: 'blue', bgColor: '#000510'
                },
                scifi: {
                    speed: 2, trailLength: 0.2, depth: 1800, starCount: 600,
                    starSize: 1.8, twinkle: 0.3, starGlow: 30, galaxyCount: 6,
                    galaxySize: 1, galaxyStars: 200, nebulaCount: 4, nebulaSize: 1,
                    nebulaAlpha: 0.3, colorScheme: 'neon', bgColor: '#020008',
                    starTrails: true
                }
            };
            
            const preset = presets[name];
            if (preset) {
                Object.assign(settings, preset);
                updateControls();
                initObjects();
            }
        }
        
        function updateControls() {
            const controls = [
                'speed', 'trailLength', 'depth', 'starCount', 'starSize', 'twinkle',
                'starGlow', 'galaxyCount', 'galaxySize', 'galaxyStars', 'spiral',
                'nebulaCount', 'nebulaSize', 'nebulaAlpha'
            ];
            
            controls.forEach(id => {
                const el = document.getElementById(id);
                const val = document.getElementById(id + 'Val');
                if (el && settings[id] !== undefined) {
                    el.value = settings[id];
                    if (val) val.textContent = settings[id];
                }
            });
            
            document.getElementById('colorScheme').value = settings.colorScheme;
            document.getElementById('bgColor').value = settings.bgColor;
            document.getElementById('mouseControl').checked = settings.mouseControl;
            document.getElementById('showNebula').checked = settings.showNebula;
            document.getElementById('showGalaxies').checked = settings.showGalaxies;
            document.getElementById('starTrails').checked = settings.starTrails || false;
            document.getElementById('cosmicDust').checked = settings.cosmicDust;
        }
        
        function resetSettings() {
            Object.assign(settings, {
                speed: 1, trailLength: 0.15, depth: 2000, starCount: 600,
                starSize: 1.5, twinkle: 0.5, starGlow: 15, galaxyCount: 8,
                galaxySize: 1, galaxyStars: 200, spiral: 3, nebulaCount: 5,
                nebulaSize: 1, nebulaAlpha: 0.3, colorScheme: 'realistic',
                bgColor: '#000308', mouseControl: true, showNebula: true,
                showGalaxies: true, starTrails: false, cosmicDust: true
            });
            updateControls();
            initObjects();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        resize();
        initObjects();
        animate();
    </script>
</body>
</html>