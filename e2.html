<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç PDF (Vercel / Native API)</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f0f2f5; }
        .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 400px; margin-top: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-family: monospace; }
        button { background-color: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:disabled { background-color: #ccc; }
        #status { margin-top: 15px; font-weight: bold; color: #333; }
        .error { color: red; }
    </style>
</head>
<body>

    <div class="container">
        <h1>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ PDF (Vercel Proxy)</h1>
        <p>–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π API Google, –∫–æ—Ç–æ—Ä—ã–π <b>–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PDF</b>.</p>
        
        <input type="file" id="pdfInput" accept="application/pdf">
        <br>
        <button id="processBtn" onclick="processPdf()">–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
        
        <div id="status"></div>
        <textarea id="output" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..."></textarea>
    </div>

    <script>
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Vercel –ø—Ä–æ–∫—Å–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç Google
        const PROXY_BASE_URL = "https://ver-olive-delta.vercel.app";
        const MODEL_ID = "gemini-2.5-flash-lite"; 

        async function processPdf() {
            const fileInput = document.getElementById('pdfInput');
            const outputObj = document.getElementById('output');
            const statusObj = document.getElementById('status');
            const btn = document.getElementById('processBtn');

            if (fileInput.files.length === 0) { alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!"); return; }
            if (fileInput.files[0].type !== 'application/pdf') { alert("–ù—É–∂–µ–Ω PDF —Ñ–∞–π–ª!"); return; }

            btn.disabled = true;
            outputObj.value = "";
            statusObj.textContent = "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞...";
            statusObj.className = "";

            try {
                // 1. –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –≤ Base64
                const base64Data = await fileToBase64(fileInput.files[0]);
                
                statusObj.textContent = "üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Gemini...";

                // 2. –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ Google (Native)
                // –ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –º—ã –º–æ–∂–µ–º —É–∫–∞–∑–∞—Ç—å mimeType: "application/pdf"
                const requestUrl = `${PROXY_BASE_URL}/v1beta/models/${MODEL_ID}:generateContent`;
                
                const requestBody = {
                    contents: [{
                        role: "user",
                        parts: [
                            { text: "Extract all text from this PDF document exactly as it appears. Preserve the structure." },
                            { 
                                inlineData: { 
                                    mimeType: "application/pdf", 
                                    data: base64Data 
                                } 
                            }
                        ]
                    }]
                };

                // 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
                const response = await fetch(requestUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (!response.ok) throw new Error(data.error?.message || response.statusText);

                // 4. –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    outputObj.value = text;
                    statusObj.textContent = "‚úÖ –ì–æ—Ç–æ–≤–æ!";
                } else {
                    throw new Error("–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò");
                }

            } catch (error) {
                console.error(error);
                statusObj.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                statusObj.className = "error";
            } finally {
                btn.disabled = false;
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>