<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Установка программ через PowerShell</title>
    <link rel="icon" href="img/powershell.png" type="image/png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');

        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --text-dark: #2d3748;
            --text-light: #4a5568;
            --bg-light: #f8fafc;
            --border-color: #e2e8f0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-size: 400% 400%;
            animation: aurora-gradient 45s ease infinite;
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes aurora-gradient {
            0% {
                background-position: 0% 50%;
            }
            25% {
                background-position: 100% 50%;
            }
            50% {
                background-position: 50% 100%;
            }
            75% {
                background-position: 50% 0%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        /* --- Заголовок --- */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .subtitle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }
        .icon-button {
            background: none; border: none; cursor: pointer; padding: 0;
            color: rgba(255, 255, 255, 0.8); transition: all 0.2s;
        }
        .icon-button:hover { color: white; transform: scale(1.1); }
        .icon-button svg { width: 24px; height: 24px; }

        /* --- Карточки --- */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-dark);
        }
        .card h2 {
            margin-top: 0; color: var(--text-dark); border-bottom: 2px solid var(--border-color);
            padding-bottom: 12px; margin-bottom: 20px; font-size: 1.5rem;
            font-weight: 600; display: flex; align-items: center; gap: 12px;
        }
        .card .icon { width: 28px; height: 28px; opacity: 0.9; }

        /* --- Элементы для копирования и код --- */
        .copyable { cursor: pointer; user-select: none; }
        pre.code-block {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #f7fafc; padding: 20px; border-radius: 12px;
            overflow-x: auto; font-family: 'Fira Code', monospace;
            font-size: 0.9em; line-height: 1.5; border: 1px solid #4a5568;
            margin-top: 15px;
        }
        code {
            background-color: #edf2f7; color: var(--text-dark); padding: 3px 6px;
            border-radius: 6px; font-family: 'Fira Code', monospace; font-size: 0.9em;
        }
        pre code { background: none; padding: 0; border-radius: 0; color: inherit; }

        /* --- Стили для установщика программ --- */
        .form-group { margin-bottom: 20px; }
        .form-group label { margin-bottom: 10px; font-weight: 600; color: var(--text-dark); display: block; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 20px; align-items: center; }
        .radio-group label { margin-bottom: 0; display: flex; align-items: center; cursor: pointer; font-weight: 500; }
        .radio-group input[type="radio"] { margin-right: 8px; accent-color: var(--primary-color); transform: scale(1.2); }
        
        .program-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; margin-top: 20px; max-height: 350px; overflow-y: auto;
            padding: 15px; background-color: var(--bg-light);
            border: 1px solid var(--border-color); border-radius: 12px;
        }
        .program-item {
            background: white; border: 1px solid var(--border-color);
            border-radius: 10px; transition: all 0.2s ease-in-out; position: relative;
        }
        .program-item:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
        .program-checkbox { display: none; }
        .program-label {
            display: flex; align-items: center; padding: 12px;
            cursor: pointer; width: 100%; height: 100%;
        }
        .program-icon { width: 24px; height: 24px; margin-right: 12px; flex-shrink: 0; }
        .program-name { font-weight: 500; color: var(--text-dark); }
        .program-checkbox:checked + .program-label { background-color: #e0f7fa; border-color: var(--secondary-color); }
        .program-checkbox:checked + .program-label::before {
            content: '✔'; position: absolute; top: 8px; right: 10px;
            color: var(--primary-color); font-weight: bold; font-size: 1.1rem;
        }
        .program-item.disabled { opacity: 0.6; background: #f1f1f1; cursor: not-allowed; }
        .program-item.disabled:hover { transform: none; box-shadow: none; }
        .program-item.disabled .program-label { cursor: not-allowed; }
        
        .result-block { margin-top: 25px; display: none; }
        .result-block.show { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Модальное окно --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 1000;
        }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-window {
            width: 90vw; max-width: 700px; background-color: white;
            border-radius: 16px; padding: 30px; position: relative;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-window { transform: scale(1); }
        .modal-window h2 { color: var(--text-dark); margin-top: 0; }
        .modal-window h3 { color: var(--primary-color); margin-top: 1.5em; }
        .modal-window p { color: var(--text-light); line-height: 1.6; }
        .modal-window ol { padding-left: 20px; line-height: 1.8; color: var(--text-light); }
        .modal-window li::marker { color: var(--primary-color); font-weight: bold; }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; }

        /* --- Уведомление --- */
        #copy-notification {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(135deg, #2ecc71, #27ae60); color: white;
            padding: 14px 22px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001; transition: bottom 0.4s ease-in-out; font-weight: 500;
        }
        #copy-notification.show { bottom: 30px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Установка программ через PowerShell</h1>
            <div class="subtitle-container">
                <p class="subtitle">Создайте скрипт для быстрой настройки вашего ПК</p>
                <button id="winget-info-btn" class="icon-button" title="Как установить Winget?">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 14H4V10H2V14C2 15.11 2.9 16 4 16H20C21.11 16 22 15.11 22 14V10H20V14M12 2C10.68 2 9.42 2.85 8.87 4H7V2H5V4H4C2.9 4 2 4.9 2 6V8H4V6H20V8H22V6C22 4.9 21.11 4 20 4H17V2H15V4H13.13C12.58 2.85 11.32 2 10 2H12Z"/></svg>
                </button>
                <button id="help-btn" class="icon-button" title="Как запустить скрипт?">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                </button>
            </div>
        </div>
        
        <div class="card">
            <h2>
                <span class="icon">✅</span>
                Выбор программ
            </h2>
            <div class="form-group">
                <label>Метод установки:</label>
                <div class="radio-group">
                    <label><input type="radio" name="installMethod" value="winget" checked> Winget (рекомендуется)</label>
                    <label><input type="radio" name="installMethod" value="classic"> Классический (прямые ссылки)</label>
                </div>
            </div>

            <div class="program-grid" id="program-list-container">
                <!-- Программы будут добавлены сюда JS -->
            </div>

            <div id="script-result-block" class="result-block">
                <h3>Готовый скрипт для PowerShell (запустить от Администратора):</h3>
                <pre class="code-block copyable" id="script-result-container"><code id="script-result-output"></code></pre>
            </div>
        </div>
    </div>

    <div id="help-modal-overlay" class="modal-overlay"> <div id="help-modal-window" class="modal-window"> <button id="help-close-btn" class="icon-button modal-close-btn"> <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <h2>Как запустить PowerShell от имени Администратора</h2> <p>Для корректной работы скриптов требуется встроенная версия — <strong>Windows PowerShell</strong>. Не используйте отдельно установленный PowerShell (с черной иконкой).</p> <h3>Способ 1: Через меню «Пуск» (самый надежный)</h3> <ol> <li>Нажмите клавишу <code>Win</code> или откройте меню «Пуск».</li> <li>Начните печатать <b>Windows PowerShell</b>.</li> <li>В результатах поиска нажмите правой кнопкой мыши на "Windows PowerShell" (с синей иконкой) и выберите "Запуск от имени администратора".</li> </ol> <h3>Способ 2: Через меню опытного пользователя</h3> <ol> <li>Нажмите сочетание клавиш <b>Win + X</b>.</li> <li>В появившемся меню выберите "Windows PowerShell (Администратор)". Если этого пункта нет, а есть "Терминал Windows (Администратор)", используйте Способ 1.</li> </ol> <h3>Способ 3: Через окно "Выполнить"</h3> <ol> <li>Нажмите <code>Win + R</code>, чтобы открыть окно "Выполнить".</li> <li>Введите <code>powershell</code>.</li> <li>Теперь, не нажимая "OK", зажмите клавиши <b>Ctrl + Shift</b> и нажмите <b>Enter</b>.</li> </ol> </div> </div>
    <div id="winget-modal-overlay" class="modal-overlay"> <div id="winget-modal-window" class="modal-window"> <button id="winget-close-btn" class="icon-button modal-close-btn"> <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <h2>Установка Winget</h2> <p><strong>Winget</strong> — это официальный менеджер пакетов от Microsoft, рекомендуемый для установки. Если на вашем ПК его нет (команда <code>winget</code> в PowerShell выдает ошибку), скопируйте и выполните этот скрипт от имени Администратора.</p> <pre class="code-block copyable" id="winget-install-modal-script"><code># Скрипт для автоматической установки/обновления Winget
$repo = "microsoft/winget-cli";
try {
    $releasesUrl = "https://api.github.com/repos/$repo/releases/latest"
    $latest = Invoke-RestMethod -Uri $releasesUrl
    $asset = $latest.assets | Where-Object { $_.name -like '*.msixbundle' } | Select-Object -First 1
    if (!$asset) { throw "Не удалось найти .msixbundle файл." }
    $dest = Join-Path $env:TEMP $asset.name
    Invoke-WebRequest -Uri $asset.browser_download_url -OutFile $dest -UseBasicParsing
    Add-AppxPackage -Path $dest
    Write-Host "Winget успешно установлен! Проверка:" -ForegroundColor Green
    winget --version
} catch {
    Write-Error "Ошибка при установке Winget: $_"
}</code></pre> </div> </div>

    <div id="copy-notification">Скопировано в буфер обмена!</div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const directions = ['-45deg', '45deg', '135deg', '-135deg', '90deg', '-90deg', '0deg', '180deg'];
        const randomDirection = directions[Math.floor(Math.random() * directions.length)];
        const colors = '#2c3e50, #3498db, #9b59b6, #1abc9c, #e74c3c, #f39c12';
        
        document.body.style.background = `linear-gradient(${randomDirection}, ${colors})`;
        document.body.style.backgroundSize = '400% 400%';

        // --- ОБНОВЛЕННЫЙ СПИСОК ПРОГРАММ С КОРРЕКТНЫМИ СКРИПТАМИ ---
        const programs = [
            { 
                id: 'netframework35', 
                name: '.NET Framework 3.5', 
                icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Microsoft_.NET_Framework_logo.svg/48px-Microsoft_.NET_Framework_logo.svg.png',
                wingetId: null,
                script: `Write-Host "--- Установка .NET Framework 3.5..." -ForegroundColor Yellow
$sxsPath = Join-Path $env:TEMP "sxs_net35"
if (-not (Test-Path -Path $sxsPath)) { New-Item -ItemType Directory -Path $sxsPath | Out-Null }
$baseUrl = "https://mapruapp.ru/files/app/sxs/"
$files = @(
    "microsoft-windows-internetexplorer-optional-package~31bf3856ad364e35~amd64~~.cab",
    "Microsoft-Windows-InternetExplorer-Optional-Package~31bf3856ad364e35~amd64~ru-RU~.cab",
    "microsoft-windows-netfx3-ondemand-package~31bf3856ad364e35~amd64~~.cab"
)
foreach ($file in $files) {
    $url = "$baseUrl$file"
    $dest = Join-Path $sxsPath $file
    if (-not (Test-Path $dest)) {
        Write-Host "Скачивание $file..."
        try { Invoke-WebRequest -Uri $url -OutFile $dest -ErrorAction Stop }
        catch { Write-Warning "Не удалось скачать $file. Ошибка: $_"; break }
    }
}
Write-Host "Включение компонента .NET Framework 3.5... Это может занять некоторое время."
try {
    Enable-WindowsOptionalFeature -Online -FeatureName NetFx3 -All -Source $sxsPath -LimitAccess -ErrorAction Stop
} catch {
    Write-Error "Произошла ошибка при установке .NET Framework 3.5: $_"
} finally {
    Write-Host "Очистка временных файлов..."
    Remove-Item -Path $sxsPath -Recurse -Force
}` 
            },
            { 
                id: 'totalcommander', 
                name: 'Total Commander', 
                icon: 'https://www.ghisler.com/favicon.ico',
                wingetId: 'Ghisler.TotalCommander',
                script: `Write-Host "--- Установка Total Commander (64-bit)..." -ForegroundColor Yellow
$url="https://mapruapp.ru/files/app/tcmd1155x64.exe"; $file="$env:TEMP\\tcmd.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/AHMGDU" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: '7zip', 
                name: '7-Zip', 
                icon: 'https://www.7-zip.org/favicon.ico',
                wingetId: '7zip.7zip',
                script: `Write-Host "--- Установка 7-Zip (64-bit)..." -ForegroundColor Yellow
$url="https://www.7-zip.org/a/7z2407-x64.exe"; $file="$env:TEMP\\7zip.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/S" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'winrar', 
                name: 'WinRAR', 
                icon: 'https://www.win-rar.com/favicon.ico',
                wingetId: 'RARLab.WinRAR',
                script: `Write-Host "--- Установка WinRAR (64-bit, Русский)..." -ForegroundColor Yellow
$url="https://www.win-rar.com/fileadmin/winrar-versions/winrar/winrar-x64-701ru.exe"; $file="$env:TEMP\\winrar.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/S" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'irfanview', 
                name: 'IrfanView', 
                icon: 'https://www.irfanview.com/favicon.ico',
                wingetId: 'IrfanSkiljan.IrfanView',
                script: `Write-Host "--- Установка IrfanView (64-bit)..." -ForegroundColor Yellow
$url="https://mapruapp.ru/files/app/iview472_x64_setup.exe"; $file="$env:TEMP\\irfanview.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/silent /allusers=1" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'adobereader', 
                name: 'Adobe Reader DC', 
                icon: 'https://www.adobe.com/content/dam/cc/Adobe_favicon.ico',
                wingetId: 'Adobe.Acrobat.Reader.DC',
                script: `Write-Host "--- Установка Adobe Reader (MUI)..." -ForegroundColor Yellow
$url="https://ardownload2.adobe.com/pub/adobe/acrobat/win/AcrobatDC/2400220857/AcroRdrDCx642400220857_MUI.exe"; $file="$env:TEMP\\acrordr.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Write-Host "Установка Adobe Reader может занять несколько минут..."
Start-Process -FilePath $file -ArgumentList "/sAll" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'pdf24', 
                name: 'PDF24 Creator', 
                icon: 'https://www.pdf24.org/favicon.ico',
                wingetId: 'geeksoftwareGmbH.PDF24Creator',
                script: `Write-Host "--- Установка PDF24 Creator..." -ForegroundColor Yellow
$url="https://download.pdf24.org/pdf24-creator-latest-x64.exe"; $file="$env:TEMP\\pdf24.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/VERYSILENT" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'pdftkfree', 
                name: 'PDFtk Free', 
                icon: 'https://www.pdflabs.com/favicon.ico', 
                wingetId: null,
                script: `Write-Host "--- Установка PDFtk Free..." -ForegroundColor Yellow
$url = "https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/pdftk_free-2.02-win-setup.exe"
$file = "$env:TEMP\\pdftk_free_setup.exe"
$installPath = "C:\\Program Files (x86)\\PDFtk"
Write-Host "Скачивание установщика..."
Invoke-WebRequest -Uri $url -OutFile $file
Write-Host "Запуск тихой установки..."
Start-Process -FilePath $file -ArgumentList "/verysilent /suppressmsgboxes" -Wait
$binPath = Join-Path -Path $installPath -ChildPath "bin"
$currentPath = [System.Environment]::GetEnvironmentVariable('Path', 'Machine')
if ($currentPath -notlike "*$binPath*") {
    $newPath = "$currentPath;$binPath"
    [System.Environment]::SetEnvironmentVariable('Path', $newPath, 'Machine')
    Write-Host "Путь к pdftk добавлен в системную переменную PATH." -ForegroundColor Green
    Write-Host "Пожалуйста, перезапустите PowerShell, чтобы изменения вступили в силу." -ForegroundColor Cyan
} else {
    Write-Host "Путь к pdftk уже существует в PATH." -ForegroundColor Cyan
}
Write-Host "Очистка временного файла..."
Remove-Item $file -Force` 
            },
            { 
                id: 'notepadplusplus', 
                name: 'Notepad++', 
                icon: 'https://notepad-plus-plus.org/favicon.ico',
                wingetId: 'Notepad++.Notepad++',
                script: `Write-Host "--- Установка Notepad++ (64-bit)..." -ForegroundColor Yellow
$url="https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v8.6.8/npp.8.6.8.Installer.x64.exe"; $file="$env:TEMP\\npp.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/S" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'potplayer', 
                name: 'PotPlayer', 
                icon: 'https://potplayer.daum.net/favicon.ico',
                wingetId: 'Daum.PotPlayer',
                script: `Write-Host "--- Установка PotPlayer (64-bit)..." -ForegroundColor Yellow
$url="https://t1.daumcdn.net/potplayer/PotPlayer/Version/Latest/PotPlayerSetup64.exe"; $file="$env:TEMP\\potplayer.exe"
Invoke-WebRequest -Uri $url -OutFile $file
Start-Process -FilePath $file -ArgumentList "/S" -Wait
Remove-Item $file -Force` 
            },
            { 
                id: 'libreoffice', 
                name: 'LibreOffice', 
                icon: 'https://www.libreoffice.org/favicon.ico',
                wingetId: 'TheDocumentFoundation.LibreOffice',
                script: `Write-Host "--- Установка LibreOffice (64-bit)..." -ForegroundColor Yellow
$url = "https://download.documentfoundation.org/libreoffice/stable/24.2.5/win/x86_64/LibreOffice_24.2.5_Win_x86-64.msi"
$file = "$env:TEMP\\LibreOffice.msi"
Write-Host "Скачивание LibreOffice..."
Invoke-WebRequest -Uri $url -OutFile $file
Write-Host "Установка... (может занять несколько минут)"
Start-Process msiexec.exe -ArgumentList "/i \`"$file\`" /qn" -Wait
Write-Host "Очистка временного файла..."
Remove-Item $file -Force` 
            }
        ];

        const programListContainer = document.getElementById('program-list-container');
        const resultBlock = document.getElementById('script-result-block');
        const resultOutput = document.getElementById('script-result-output');
        const resultContainer = document.getElementById('script-result-container');

        function generateAndUpdateScript() {
            const selectedCheckboxes = document.querySelectorAll('.program-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                resultBlock.classList.remove('show');
                return;
            }

            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.programId);
            const selectedPrograms = programs.filter(p => selectedIds.includes(p.id));
            const installMethod = document.querySelector('input[name="installMethod"]:checked').value;
            
            let script = '';
            const header = `if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) { Write-Warning "Этот скрипт требует прав Администратора!"; break }\nWrite-Host "Начало установки..." -ForegroundColor Green\n\n`;
            const footer = `\n\nWrite-Host "Все операции завершены!" -ForegroundColor Green`;
            
            if (installMethod === 'winget') {
                const wingetScripts = selectedPrograms
                    .filter(p => p.wingetId)
                    .map(p => `Write-Host "--- Установка ${p.name}..." -ForegroundColor Yellow;\nwinget install -e --id "${p.wingetId}" --accept-package-agreements --accept-source-agreements`);
                
                const classicScripts = selectedPrograms
                    .filter(p => !p.wingetId)
                    .map(p => `Write-Host "--- ${p.name} недоступен через Winget, используется классический метод..." -ForegroundColor Cyan;\n${p.script}`);
                    
                script = [...wingetScripts, ...classicScripts].join(';\n\n');
            } else {
                script = selectedPrograms.map(p => p.script).join(';\n\n');
            }

            const fullScript = header + script + footer;
            resultOutput.textContent = fullScript;
            resultContainer.dataset.copy = fullScript;
            resultBlock.classList.add('show');
        }

        function populateProgramList() {
            programListContainer.innerHTML = '';
            const installMethod = document.querySelector('input[name="installMethod"]:checked').value;
            
            programs.forEach(program => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'program-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `prog-${program.id}`;
                checkbox.className = 'program-checkbox';
                checkbox.dataset.programId = program.id;

                const label = document.createElement('label');
                label.htmlFor = `prog-${program.id}`;
                label.className = 'program-label';

                const icon = document.createElement('img');
                icon.src = program.icon;
                icon.alt = `${program.name} icon`;
                icon.className = 'program-icon';
                icon.onerror = () => { icon.style.display = 'none'; };

                const nameSpan = document.createElement('span');
                nameSpan.className = 'program-name';
                nameSpan.textContent = program.name;

                label.appendChild(icon);
                label.appendChild(nameSpan);
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                
                if (installMethod === 'winget' && !program.wingetId) {
                    itemDiv.classList.add('disabled');
                    // Checkbox remains enabled to allow selection, but it will use the classic method
                    itemDiv.title = 'Эта программа будет установлена классическим методом (прямая ссылка), т.к. недоступна в Winget.';
                }
                programListContainer.appendChild(itemDiv);
            });
        }

        programListContainer.addEventListener('change', (e) => {
            if (e.target.classList.contains('program-checkbox')) {
                generateAndUpdateScript();
            }
        });

        document.querySelectorAll('input[name="installMethod"]').forEach(radio => {
            radio.addEventListener('change', () => {
                populateProgramList();
                generateAndUpdateScript(); 
            });
        });

        document.addEventListener('click', e => {
            const copyable = e.target.closest('.copyable');
            if (copyable) {
                const textToCopy = copyable.dataset.copy || copyable.textContent;
                navigator.clipboard.writeText(textToCopy.trim())
                    .then(() => showNotification('✅ Скопировано в буфер обмена!'))
                    .catch(() => showNotification('❌ Ошибка копирования', 'error'));
            }
        });
        
        document.getElementById('winget-install-modal-script').dataset.copy = document.getElementById('winget-install-modal-script').textContent;
        
        function setupModal(buttonId, overlayId, closeButtonId) {
            const openBtn = document.getElementById(buttonId);
            const overlay = document.getElementById(overlayId);
            const closeBtn = document.getElementById(closeButtonId);

            openBtn.addEventListener('click', () => overlay.classList.add('visible'));
            closeBtn.addEventListener('click', () => overlay.classList.remove('visible'));
            overlay.addEventListener('click', e => {
                if (e.target === overlay) {
                    overlay.classList.remove('visible');
                }
            });
        }

        setupModal('help-btn', 'help-modal-overlay', 'help-close-btn');
        setupModal('winget-info-btn', 'winget-modal-overlay', 'winget-close-btn');
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('copy-notification');
            notification.textContent = message;
            notification.style.background = type === 'error' 
                ? 'linear-gradient(135deg, #e74c3c, #c0392b)'
                : 'linear-gradient(135deg, #2ecc71, #27ae60)';
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2500);
        }

        populateProgramList();
    });
    </script>
</body>
</html>