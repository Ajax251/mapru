<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ассистент</title>
 <link id="favicon" rel="icon" href="https://vsemap.ru/favicon.svg" type="image/x-icon">
 <link rel="shortcut icon" href="https://vsemap.ru/favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="webfonts/all.min.css">
 

</script>




    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            transition: background 5s ease-in-out;
            overflow: hidden;
        }
        .container {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(3px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 400px;
            position: absolute;
            transition: all 0.3s ease;
            animation: containerAppear 0.5s ease-out forwards;
            opacity: 0;
        }
        .container:hover {
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
        }
        .container:active {}
        h1 {
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
            transition: color 0.3s, transform 0.3s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        h1.text-address {
            color: #007BFF;
        }
        h1.text-cadastral {
            color: #28a745;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 12px;
            margin-bottom: 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            text-align: center;
        }
        input[type="text"]:focus {
            box-shadow: inset 0 2px 4px rgba(0, 123, 255, 0.1), 0 6px 12px rgba(0, 123, 255, 0.2);
            outline: none;
            background: rgba(255, 255, 255, 1);
        }
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .buttons a {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 15px;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            margin-bottom: 5px;
            color: white;
        }
        .pkk {
            background-color: #007BFF;
        }
        .rosreestr {
            background-color: deepskyblue;
        }
        .egrp {
            background-color:  #28a745;
        }
  .roscadastres {
            background-color: #4166F5;
        }
        .yandex {
            background-color: #FF0000;
        }
        .google {
            background-color: #4285F4;
        }
        .earth {
            background-color: #34A853;
        }
        .bing {
            background-color: #008272;
        }
        .gis {
            background-color: #00BFFF;
        }
        .kadastrmap {
            background-color: #ff5c00;
        }
        .buttons a:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        .buttons a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.6s;
            z-index: -1;
        }
        .buttons a:hover::before {
            left: 100%;
        }
        .buttons a span {
            position: relative;
            z-index: 2;
            pointer-events: none;
        }
        .buttons a img {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            transition: transform 0.3s ease;
            pointer-events: none;
        }
        .buttons a:hover img {
            transform: scale(1.1) rotate(5deg);
        }
        #f9Corner {
            position: absolute;
            top: 0;
            left: 0;
            width: 26px;
            height: 26px;
            z-index: 1001;
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        .buttons a:hover img {
            animation: pulse 1s infinite;
        }
        .checkbox-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            display: none;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 5px 10px;
            border-radius: 20px;
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            opacity: 0.05;
        }
        .checkbox-container:hover {
            background-color: rgba(0, 0, 0, 0.7);
            opacity: 1;
        }
        .checkbox-container label {
            margin-left: 10px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.3s ease-in-out;
            opacity: 0.15;
        }
        .checkbox-container:hover label {
            opacity: 1;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }
        @media (max-width: 768px), (orientation: portrait) {
            .container {
                width: 90%;
                padding: 15px;
            }
            .buttons a {
                padding: 10px;
                font-size: 14px;
            }
            .buttons a img {
                width: 20px;
                height: 20px;
            }
            h1 {
                font-size: 20px;
            }
            input[type="text"] {
                font-size: 14px;
            }
        }
        .buttons a::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0) 80%);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: scale(0.7);
            pointer-events: none;
        }
        .buttons a:hover::after {
            opacity: 1;
            transform: scale(1);
        }
        .yandex-nav {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .yandex-nav span {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .yandex-nav img {
            margin-right: 8px;
            vertical-align: middle;
        }
        .yandex-nav input {
            display: none;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            color: #000;
        }
        .yandex-nav.active span {
            display: none;
        }
        .yandex-nav.active input {
            display: block;
        }
        .rosreestr-menu {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1000;
            width: 40px;
            height: 40px;
        }
  
        .rosreestr-menu:hover {
            opacity: 1;
        }
        .rosreestr-menu-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-color: rgba(65, 105, 225, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            opacity: 0;
        }
        .rosreestr-menu:hover .rosreestr-menu-icon {
            opacity: 1;
            background-color: rgba(65, 105, 225, 1);
        }
        .rosreestr-dropdown.show {
            display: block;
            animation: slideDown 0.1s ease forwards;
        }
        .rosreestr-dropdown a {
            display: flex;
            align-items: center;
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .rosreestr-dropdown a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .rosreestr-dropdown i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .rosreestr-dropdown .separator {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.2);
            margin: 5px 0;
        }
        
        .rosreestr-dropdown .dropdown {
    position: relative; 
}


.rosreestr-dropdown .dropbtn {
    background-color: transparent;
    color: white;              
    padding: 12px 16px;        
    font-size: 16px;           
    border: none;              
    cursor: pointer;           
    display: flex;             
    align-items: center;      
    width: 100%;               
    text-align: left;          
    transition: background-color 0.3s ease;
}

.rosreestr-dropdown .dropbtn i {
    margin-right: 10px;
    width: 20px;
    text-align: center;
}


.rosreestr-dropdown .dropdown:hover > .dropbtn {
    background-color: rgba(255, 255, 255, 0.1);
}

.rosreestr-dropdown .dropdown-content {
    display: none;
    position: absolute;
    right: 100%;
    top: 0;                            
    background-color: rgba(42, 91, 204, 0.95);
    min-width: 200px;
    box-shadow: -5px 5px 15px rgba(0,0,0,0.3);
    z-index: 2;
    border-radius: 8px 0 0 8px;
    max-height: calc(100vh - 40px);
    overflow-y: auto;
    overflow-x: hidden;
}

.rosreestr-dropdown .dropdown-content a {
    color: white;              
    padding: 12px 16px;        
    text-decoration: none;     
    display: flex;             
    align-items: center;      
    white-space: nowrap;       
    transition: background-color 0.3s ease;
}
.rosreestr-dropdown .dropdown-content a i {
    margin-right: 10px;
    width: 20px;
    text-align: center;
}


.rosreestr-dropdown .dropdown-content a:hover {
    background-color: rgba(99, 149, 238, 0.9);
}

.rosreestr-dropdown .dropdown:hover > .dropdown-content {
    display: block;
    animation: slideSubmenuLeft 0.2s ease forwards;
}


@keyframes slideSubmenuLeft {
    from {
        opacity: 0;
        transform: translateX(10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}


        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
.rosreestr-dropdown {
    display: none;                    
    position: fixed;                  
    right: 60px;                      
    top: 50%;                         
    transform: translateY(-50%);      
    background-color: rgba(65, 105, 225, 0.9);
    border-radius: 10px;              
    overflow: visible;                
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    width: 200px;                     
    z-index: 1001;                    
}

.rosreestr-dropdown.show {
    display: block;                   
     animation: slideDownCentered 0.1s ease forwards;
}


@keyframes slideDownCentered {
    from {
        opacity: 0;
        transform: translateY(calc(-50% - 10px));
    }
    to {
        opacity: 1;
        transform: translateY(-50%);
    }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
   
     
        .social-icons {
            position: fixed;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        .social-icons a {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            background-color: #4169E1;
        }
        .social-icons a:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .social-icons i {
            font-size: 24px;
            color: white;
        }
        .social-icons .whatsapp {
            background-color: #25D366;
            color: white;
        }
        .social-icons .telegram {
            background-color: #0088cc;
            color: white;
        }
        .social-icons .rosreestr {
            background-color: #4169E1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .social-icons img {
            width: 32px;
            height: 32px;
        }
        .left-menu {
            position: fixed;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        .left-menu img {
            width: 32px;
            height: 32px;
        }
        .left-menu a {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            background-color: #4169E1;
        }
        .left-menu a:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .left-menu i {
            font-size: 24px;
            color: white;
        }
        
   .left-dropdown, .right-dropdown {
            display: none;
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(65, 105, 225, 0.9);
            border-radius: 10px;
            /* overflow: hidden;  <-- БЫЛО (УДАЛИТЬ) */
            overflow: visible; /* <-- СТАЛО (ДОБАВИТЬ) */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 250px;
            z-index: 1001;
        }
        
        .left-dropdown {
            left: 60px;
        }
        .right-dropdown {
            right: 60px;
        }
        .left-dropdown.show {
            display: block;
            animation: slideRight 0.1s ease forwards;
        }
        .right-dropdown.show {
            display: block;
            animation: slideLeft 0.1s ease forwards;
        }

        .left-dropdown a, .right-dropdown a {
            display: flex;
            align-items: center;
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            transition: background-color: 0.3s ease;
        }
        .left-dropdown a:hover, .right-dropdown a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .left-dropdown i, .right-dropdown i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .left-dropdown .separator, .right-dropdown .separator {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.2);
            margin: 5px 0;
        }

        @keyframes slideRight {
            from {
                opacity: 0;
                transform: translate(-10px, -50%);
            }
            to {
                opacity: 1;
                transform: translate(0, -50%);
            }
        }
        @keyframes slideLeft {
            from {
                opacity: 0;
                transform: translate(10px, -50%);
            }
            to {
                opacity: 1;
                transform: translate(0, -50%);
            }
        }
        .social-icons,
        .left-menu {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }
        .social-icons:hover,
        .left-menu:hover,
        .social-icons.visible,
        .left-menu.visible {
            opacity: 1;
        }
        .social-icons,
        .left-menu {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        .social-icons.visible,
        .left-menu.visible {
            opacity: 1;
            pointer-events: auto;
        }
      
        @keyframes pageFlash {
            0% {
                background-color: rgba(255, 255, 255, 0);
            }
            50% {
                background-color: rgba(255, 255, 255, 1);
            }
            100% {
                background-color: rgba(255, 255, 255, 0);
            }
        }
        @keyframes containerAppear {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        body {
            animation: pageFlash 0.5s ease-out;
        }
        .container {
            display: none;
            opacity: 0;
        }
        .container.show {
            display: block;
            animation: containerAppear 0.5s ease-out 0.5s forwards;
        }
        #f9CornerRight {
            position: absolute;
            top: 0;
            right: 0;
            width: 26px;
            height: 26px;
            z-index: 1001;
        }
        .f9-mode .ai-search {
            background-color: #FF4500
        }
        .f9-mode .pharmacies {
            background-color: #00FF00;
        }
        .f9-mode .audiobooks {
            background-color: #1E90FF;
        }
        .f9-mode .quotes {
            background-color: #8A2BE2;
        }
        .f9-mode .marketplaces {
            background-color: #FF1493;
        }
        .f9-mode .organizations {
            background-color: #FFD700;
        }
        .f9-mode .legal-systems {
            background-color: #00cec8;
        }
        .f9-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 15px;
            border-radius: 8px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            margin-bottom: 5px;
            color: white;
            background-color: #1F75FE;
            transition: transform 0.3s ease;
        }
        .f9-mode .f9-button:hover {
            transform: scale(1.0);
            transition: all 0.2s ease;
        }
        .f9-button:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        .f9-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: all 0.6s;
            z-index: -1;
        }
        .f9-button i {
            margin-right: 8px;
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        @keyframes f9ButtonPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        #f9CornerRight {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 1001;
            border-radius: 50%;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        #f9CornerRight img {
            width: 30px;
            height: 30px;
            transition: opacity 0.3s ease;
            opacity: 0.4;
            transition: all 0.3s ease;
        }
        #f9CornerRight:hover img {
            opacity: 0.8;
            transform: scale(1.3);
        }
        #f9CornerRight:hover {
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.7);
        }
        .ai-search {
            background-color: #ff5c00;
        }
        @keyframes pulse-and-rotate {
            0% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
            }
            100% {
                transform: scale(1) rotate(360deg);
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
            }
        }
        .pulse-rotate {
            animation: pulse-and-rotate 0.6s ease-in-out;
        }
        @keyframes fadeInRotate {
            from {
                opacity: 0;
                transform: rotate(-90deg) scale(0.5);
            }
            to {
                opacity: 1;
                transform: rotate(0) scale(1);
            }
        }
        .social-icons a,
        .left-menu a {
            opacity: 0;
            transform: rotate(-90deg) scale(0.5);
            transition: all 0.3s ease;
        }
        .social-icons.visible a,
        .left-menu.visible a {
            animation: fadeInRotate 0.5s ease forwards;
        }
        .social-icons a:nth-child(2),
        .left-menu a:nth-child(2) {
            animation-delay: 0.1s;
        }
        .social-icons a:nth-child(3),
        .left-menu a:nth-child(3) {
            animation-delay: 0.2s;
        }
        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            60% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        .social-icons.visible,
        .left-menu.visible {
            animation: popIn 0.5s ease forwards;
        }
        #sunbeam {
            position: fixed;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(to bottom right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.1) 45%, rgba(255, 255, 255, 0.5) 50%, rgba(255, 255, 255, 0.1) 55%, rgba(255, 255, 255, 0) 100%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease-in-out;
            z-index: 9999;
        }
        .sunbeam-active {
            animation: sunbeam 4s ease-in-out;
        }
        @keyframes sunbeam {
            0% {
                opacity: 0;
            }
            20%,
            80% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        .bottom-centered-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 9999;
            padding: 10px;
        }
        .left-menu.in-bottom-row {
            position: static;
            display: inline-flex;
            flex-direction: row;
            margin: 0;
        }
        .social-icons.in-bottom-row {
            position: static;
            display: inline-flex;
            flex-direction: row;
            margin: 0;
        }
        .click-area {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 25mm;
            height: 25mm;
            z-index: 9999;
        }
        .social-icons a,
        .left-menu a {
            position: relative;
            overflow: hidden;
        }
        .social-icons a::before,
        .left-menu a::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 30%, transparent 70%);
            transform: scale(0);
            transition: transform 0.4s ease-out, opacity 0.3s ease-out;
            pointer-events: none;
            opacity: 0;
        }
        .social-icons a:hover::before,
        .left-menu a:hover::before {
            transform: scale(1);
            opacity: 1;
        }
        .social-icons a:hover,
        .left-menu a:hover {
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3), 0 0 25px rgba(255, 255, 255, 0.2), 0 0 35px rgba(255, 255, 255, 0.1);
            transform: scale(1.0);
            z-index: 2;
        }
        .social-icons a i,
        .left-menu a i,
        .social-icons a img,
        .left-menu a img {
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        .social-icons a:hover i,
        .left-menu a:hover i,
        .social-icons a:hover img,
        .left-menu a:hover img {
            transform: scale(1.1);
            filter: brightness(1.2);
        }
        .site-search {
            background-color: rgba(255, 255, 255, 0.2) !important;
            backdrop-filter: blur(5px);
        }
        .site-search input {
            display: none;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            color: #000;
            background: rgba(255, 255, 255, 0.9);
        }
        .site-search.active span {
            display: none;
        }
        .site-search.active input {
            display: block;
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropbtn {
            background-color: transparent;
            color: white;
            padding: 10px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            left: 100%; /* <-- ДОБАВИТЬ: Сдвигаем вправо за пределы основного меню */
            top: 0;     /* <-- ДОБАВИТЬ: Выравниваем верхний край */
            background-color: #2A5BCC;
            min-width: 180px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            transform: translate3d(0, 0, 0);
            border-radius: 0 10px 10px 10px; /* Красота: скругляем углы справа */
        }

        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #6395ee;
            transform: translate3d(0, 0, 0);
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }



        @keyframes slideSubmenuRight {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .separator {
            height: 1px;
            background-color: #ccc;
            margin: 5px 0;
        }
        
@media (max-width: 1500px) {
            .left-dropdown, .right-dropdown {
                max-height: none; /* <-- БЫЛО calc(100vh - 60px). Ставим none, чтобы не ограничивать высоту */
                overflow-y: visible; /* <-- БЫЛО auto. Ставим visible */
                overflow-x: visible; /* <-- БЫЛО hidden. Ставим visible */
            }

            .left-dropdown a,
            .right-dropdown a,
            .left-dropdown .dropbtn,
            .right-dropdown .dropbtn {
                font-size: 14px;      
                padding: 8px 12px;    
            }

            .left-dropdown i, .right-dropdown i {
                font-size: 18px;      
                width: 18px;          
                margin-right: 8px;    
            }

            .left-dropdown .dropdown-content a,
            .right-dropdown .dropdown-content a {
                 font-size: 14px;
                 padding: 8px 12px;
            }
             .left-dropdown .dropdown-content a i,
             .right-dropdown .dropdown-content a i {
                 font-size: 18px;
                 width: 18px;
                 margin-right: 8px;
            }


            .left-dropdown .separator,
            .right-dropdown .separator {
                margin: 3px 0;
            }
        }
        
        /* Styles for F9 Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            text-align: center; /* MODIFIED */
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        #f9ModalTitle {
            margin-top: 0;
            margin-bottom: 20px;
            color: #333;
            font-size: 22px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        #f9ModalList {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 60vh;
            overflow-y: auto;
            display: inline-block; /* ADDED */
            text-align: left;      /* ADDED */
        }

        #f9ModalList li a {
            display: flex;
            align-items: center;
            padding: 12px 10px;
            text-decoration: none;
            color: #1a1a1a;
            border-radius: 8px;
            transition: background-color 0.2s ease, transform 0.2s ease;
            font-size: 16px;
        }

        #f9ModalList li a:hover {
            background-color: rgba(0, 123, 255, 0.1);
            /* transform: translateX(5px); REMOVED */
        }

        #f9ModalList li img {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            border-radius: 4px;
            background-color: #f0f0f0;
        }

   .modal-footer {
    margin-top: 25px;
    display: flex;
    justify-content: center; /* <-- ИЗМЕНЕНИЕ ЗДЕСЬ */
    gap: 10px;
    border-top: 1px solid #eee;
    padding-top: 20px;
}

        .modal-footer button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }

        #f9ModalOpenAll {
            background-color: #007BFF;
            color: white;
        }

        #f9ModalOpenAll:hover {
            background-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }
        
        #f9ModalClose {
            background-color: #e9e9e9;
            color: #333;
        }

        #f9ModalClose:hover {
            background-color: #dcdcdc;
        }
        
            #infoModalBody {
            text-align: left;
            line-height: 1.6;
            color: #333;
        }

        .browser-instructions {
            background-color: #f0f8ff;
            border-left: 4px solid #007BFF;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 4px;
        }

        .browser-instructions strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: #0056b3;
        }

        .browser-instructions ol {
            padding-left: 20px;
            margin: 0;
        }
        
         #bottomRightHoverArea {
            position: fixed;
            bottom: 0;
            right: 0;
            /* 3cm is approx 113.4px at 96dpi */
            width: 115px;
            height: 115px;
            z-index: 9990;
        }

        .gmail-icon {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            opacity: 0;
            transform: scale(0.8) translateY(10px);
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            border-radius: 50%;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        #bottomRightHoverArea:hover .gmail-icon {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }

        .gmail-icon:hover {
            transform: scale(1.1) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .gmail-icon img {
            width: 28px;
            height: 28px;
        }

.rosreestr-dropdown {
    overflow: visible !important; 
}

.rosreestr-dropdown .dropdown-content {
    left: auto !important;    
    right: 100% !important; 
    top: 0 !important;
    
 
    border-radius: 10px 0 10px 10px; 
    transform-origin: top right;
    margin-right: 0px; 
}


.rosreestr-dropdown .dropdown:hover > .dropdown-content {
    animation: slideSubmenuLeft 0.2s ease forwards;
}

@keyframes slideSubmenuLeft {
    from {
        opacity: 0;
        transform: translateX(10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}
        
    </style>
</head>
<body>
    <div id="sunbeam"></div>
    <div class="hover-area-left"></div>
    <div class="hover-area-right"></div>
    <canvas id="snowCanvas" style="position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9998;"></canvas>
    <div class="container" id="draggableContainer">
        <h1 id="searchTitle"></h1>
        <input type="text" id="searchText" placeholder="">
        <div class="buttons" id="numberButtons">
            <a href="#" class="pkk" id="pkkButton"><img src="img/r.png" alt="PKK"><span>Публичная Карта</span></a>
            <a href="#" class="kadastrmap" id="kadastrmapButton"><img src="img/nr.png" alt="Н.Реестр"><span>Н.Реестр</span></a>
            <a href="#" class="rosreestr" id="rosreestrButton"><img src="img/mapr.png" alt="Rosreestr"><span>Кадастровая Карта</span></a>
           <a href="#" class="egrp" id="egrpButton"><img src="img/savannah.png" alt="EGRP"><span>ЕГРН</span></a>
            <a href="#" class="roscadastres" id="roscadastresButton"><img src="img/map.png" alt="Ros-Cadastres"><span>Карта</span></a>
        </div>
    
            <div class="buttons" id="addressButtons" style="display: none;">
            <a href="#" class="pkk" id="addressPKKButton"><img src="img/r.png" alt="PKK"><span>Публичная Карта</span></a>
            <a href="#" class="kadastrmap" id="addressKadastrmapButton"><img src="img/favicon-128x128-annotated.png" alt="Н.Реестр"><span>Н.Реестр</span></a>
            <a href="#" class="yandex" id="yandexButton"><img src="img/ymaps.png" alt="Yandex"><span>Яндекс Карты</span></a>
            <a href="#" class="google" id="googleButton"><img src="img/gmaps.png" alt="Google"><span>Google Карты</span></a>
            <a href="#" class="earth" id="earthButton"><img src="img/gearth.png" alt="Earth"><span>Планета Земля</span></a>
            <a href="#" class="bing" id="bingButton"><img src="img/bing-annotated.png" alt="Bing"><span>Bing Карты</span></a>
            <a href="#" class="gis" id="gisButton"><img src="img/2gis.png" alt="2GIS"><span>2ГИС</span></a>
            
               <a href="#" class="roscadastres" id="addressMapButton"><img src="img/map.png" alt="Map"><span>Карта</span></a>
               
            <a href="#" class="yandex-nav" id="yandexNavButton"> <span><img src="img/ynav.png" alt="Yandex Nav">Навигатор</span>
                <input type="text" placeholder="Конечный пункт (Enter-Yandex / Ctrl+Enter-Google)" style="display: none;">
            </a>
         
        </div>
        
    
        <div class="buttons" id="f9Buttons" style="display: none;">
            <a href="#" class="f9-button ai-search" id="aiSearchButton"><i class="fab fa-android"></i> <span></span></a>
            <a href="#" class="f9-button pharmacies" id="pharmaciesButton"><i class="fas fa-pills"></i> <span></span></a>
            <a href="#" class="f9-button audiobooks" id="audiobooksButton"><i class="fas fa-headphones"></i> <span></span></a>
            <a href="#" class="f9-button quotes" id="quotesButton"><i class="fas fa-chart-line"></i> <span></span></a>
            <a href="#" class="f9-button marketplaces" id="marketplacesButton"><i class="fas fa-shopping-cart"></i> <span></span></a>
            <a href="#" class="f9-button organizations" id="organizationsButton"><i class="fas fa-building"></i> <span></span></a>
            <a href="#" class="f9-button legal-systems" id="legalSystemsButton"><i class="fas fa-balance-scale"></i> <span></span></a>
            <a href="#" class="f9-button site-search" id="siteSearchButton">
                <span><i class="fas fa-search"></i></span>
                <input type="text" placeholder="Искать на сайте" style="display: none;">
            </a>
        </div>
    </div>
    <div class="checkbox-container">
        <label class="switch">
            <input type="checkbox" id="sevenDigitsCheckbox" style="display:none;">
            <span class="slider round"></span>
        </label>
        <label for="sevenDigitsCheckbox" style="display:none;">7 знаков в квартале</label>
    </div>

  <div class="rosreestr-dropdown" id="rosreestrDropdown">

     <a href="https://lk.rosreestr.ru/eservices/real-estate-objects-online" target="_blank" rel="noopener noreferrer"><i class="fas fa-info-circle"></i>Информация</a>
            <div class="separator"></div>

    <div class="dropdown">
      
    <a href="#" class="dropbtn"><i class="fas fa-id-card"></i>ЛК</a>
        <div class="dropdown-content">
          <a href="https://lk.rosreestr.ru/request-access-egrn/property-search" target="_blank" rel="noopener noreferrer"><i class="fas fa-search"></i>Поиск</a>
            <div class="separator"></div>
          
            <a href="https://lk.rosreestr.ru/request-access-egrn/my-claims" target="_blank" rel="noopener noreferrer"><i class="fas fa-clipboard-list"></i>Заявки</a>
            <div class="separator"></div>
           
            <a href="https://lk.rosreestr.ru/eservices/request-info-from-egrn/real-estate-object-or-its-rightholder" target="_blank" rel="noopener noreferrer"><i class="fas fa-shopping-cart"></i>Заказать</a>
            <div class="separator"></div>
            <a href="https://lk.rosreestr.ru/my-applications" target="_blank" rel="noopener noreferrer"><i class="fas fa-list-alt"></i>Выписки</a>
            <div class="separator"></div>
            <a href="https://lk.rosreestr.ru/my-plans" target="_blank" rel="noopener noreferrer"><i class="fas fa-check"></i>Проверка файла</a>
            <div class="separator"></div>
            <a href="https://lk.rosreestr.ru/eservices/check-request" target="_blank" rel="noopener noreferrer"><i class="fas fa-question-circle"></i>Статус</a>
        </div>
    </div>
    <div class="separator"></div>

    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-building-columns"></i>Госуслуги</a>
        <div class="dropdown-content">
            <a href="https://www.gosuslugi.ru/600447/1/form" target="_blank" rel="noopener noreferrer"><i class="fas fa-archive"></i>Материалы</a>
            <div class="separator"></div>
            <a href="https://www.gosuslugi.ru/600141/1/form" target="_blank" rel="noopener noreferrer"><i class="fas fa-check-circle"></i>Схема</a>
            <div class="separator"></div>
            <a href="https://lk.gosuslugi.ru/orders?" target="_blank" rel="noopener noreferrer"><i class="fas fa-file-signature"></i>Заявления</a>
        </div>
    </div>
    <div class="separator"></div>

    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-shapes"></i>Полигон</a>
        <div class="dropdown-content">
            <a href='https://polygon.top/ws/fir/' target="_blank" rel="noopener noreferrer"><i class="fas fa-book"></i>Архив КПТ</a>
            <div class="separator"></div>
            <a href='https://polygon.top/ws/k11/' target="_blank" rel="noopener noreferrer"><i class="fas fa-retweet"></i>Конвертер КПТ</a>
            <div class="separator"></div>
            <a href='https://polygon.top/ws/csc/' target="_blank" rel="noopener noreferrer"><i class="fas fa-arrow-right-arrow-left"></i>Конвертер координат</a>
        </div>
    </div>
    <div class="separator"></div>

    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-globe"></i>Сайты</a>
        <div class="dropdown-content">
            <a href='https://nspd.gov.ru/urban-analyze/search' target='_blank' rel="noopener noreferrer"><i class="fas fa-drafting-compass"></i>НСПД</a>
            <div class="separator"></div>
            <a href='rt' target='_blank' rel="noopener noreferrer"><i class="fas fa-tree"></i>РТ</a>
            <div class="separator"></div>
            <a href="fgistp" target="_blank" rel="noopener noreferrer"><i class="fas fa-street-view"></i>ФГИС ТП</a>
            <div class="separator"></div>
            <a href="https://fias.nalog.ru/" target="_blank" rel="noopener noreferrer"><i class="fas fa-location-dot"></i>ФИАС</a>
        </div>
    </div>

</div>

    <div class="social-icons">
        <a href="#" id="schemaIcon">
            <img src="img/xy.png" alt="mind map" />
        </a>
        <a href="#" class="rosreestr" id="rosreestrIcon">
            <img src="img/r.png" alt="ЛК">         </a>
            
                <a href="https://web.max.ru/" target="_blank" rel="noopener noreferrer" id="maxIcon">
             <img src="img/max.png" alt="Max" />        </a>
        <a href="https://web.whatsapp.com/" target="_blank" rel="noopener noreferrer" class="whatsapp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://web.telegram.org/" target="_blank" rel="noopener noreferrer" class="telegram"><i class="fab fa-telegram-plane"></i></a>
    </div>
    <div class="left-menu">
          <a href="#" id="AIbutton">
            <img src="img/favicon_v1_150160cddff7f294ce30.svg" alt="AI" />
        </a>
        
        <a href="#" id="fileIcon">
            <img src="img/sun.png" alt="desktop" />
        </a>
        <a href="#" id="imageIcon">
            <img src="img/img.png" alt="image" />
        </a>
      
        <a href="#" id="textIcon">
            <img src="img/txt.png" alt="text" />
        </a>
        
          <a href="#" id="desktopIcon">
            <img src="img/desktop.png" alt="desktop" />
        </a>
    </div>
    <div class="left-dropdown" id="imageDropdown">
        <a href='pdf' target="_blank" rel="noopener noreferrer"><i class="fas fa-file-pdf"></i>PDF</a>
        <div class="separator"></div>
     
  <a href="https://mapruapp.ru/pdf-converter/" target="_blank" rel="noopener noreferrer"><i class="fas fa-photo-video"></i>PDF в JPG</a>
   <div class="separator"></div>

<a href='animate' target='_blank' rel="noopener noreferrer"><i class="fas fa-wand-magic-sparkles"></i>Анимации</a>
           <div class="separator"></div>
   <a href="диаграммы.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-pie-chart"></i>Диаграммы</a>
           <div class="separator"></div>
        <a href="img.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-file-image"></i>Изображения</a>
        <div class="separator"></div>
     <a href='collage.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-puzzle-piece"></i>Коллаж</a>
        <div class="separator"></div>

<a href="подпись.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-file-signature"></i>Подпись</a>
        <div class="separator"></div>



        <a href="наложение.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-clone"></i>Наложение</a>
        <div class="separator"></div>
 <a href='pv' target='_blank' rel="noopener noreferrer"><i class="fas fa-external-link-alt"></i>Просмотр PDF</a>
        <div class="separator"></div>
    <a href='split' target='_blank' rel="noopener noreferrer"><i class="fas fa-cut"></i>Разделитель</a>
        <div class="separator"></div>
        <a href='image' target='_blank' rel="noopener noreferrer"><i class="fas fa-image"></i>Редактор изображений</a>
        <div class="separator"></div>
<a href="stereo.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-binoculars"></i> Стереокартинки</a>
           <div class="separator"></div>
        <a href="эскизы.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-images"></i>Эскизы</a>
    </div>
    <div class="left-dropdown" id="textDropdown">

 <a href="note.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-sticky-note"></i>Заметки</a>
        <div class="separator"></div>

        <a href="nb.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-book-open"></i>Записная книжка</a>
        <div class="separator"></div>
 
        <a href="кадастровый_номер.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-hashtag"></i>Кадастровый номер</a>
        <div class="separator"></div>
        <a href="поиск_текста.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-search"></i>Поиск текста</a>
      

            <div class="separator"></div>
        <a href="проверка.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-spell-check"></i>Проверка текста</a>
   <div class="separator"></div>
        <a href='doc.html' target="_blank" rel="noopener noreferrer"><i class="fas fa-keyboard"></i>Редактор текста</a>
        <div class="separator"></div>
        <a href='строки.html' target="_blank" rel="noopener noreferrer"><i class="fas fa-text-width"></i>Строки</a>
         <div class="separator"></div>
   <a href='table' target='_blank' rel="noopener noreferrer"><i class="fas fa-th-list"></i>Таблица</a>
         <div class="separator"></div>


<a href='eml' target='_blank' rel="noopener noreferrer"><i class="fas fa-envelope"></i>EML</a>
           <div class="separator"></div>

        <a href='xml' target='_blank' rel="noopener noreferrer"><i class="fab fa-readme"></i>Просмотр</a>
    </div>
    <div class="right-dropdown" id="schemaDropdown">

   <a href="схема.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-map-pin"></i>Схема</a>
        <div class="separator"></div>
  <a href='схема_xml.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-map"></i>Схема XML</a>
         <div class="separator"></div>
    
         <a href='editor' target='_blank' rel="noopener noreferrer"><i class="fas fa-pencil-alt"></i>ГеоРедактор</a>
<div class="separator"></div>

   <a href="cv.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-exchange"></i>Конвертер координат</a>
        <div class="separator"></div>

   <a href="conv.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-ruler-combined"></i>Конвертер XML</a>
        <div class="separator"></div>
   <a href="ot.html" target="_blank" rel="noopener noreferrer"><i class="fas fas fa-print"></i>Печать</a>
        <div class="separator"></div>
   <a href="kn.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-map-marker-alt"></i>Поиск в XML</a>
        <div class="separator"></div>

   <a href="kpt.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-file-export"></i>Создать XML КПТ</a>
        <div class="separator"></div>
       
  <a href='zu.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-vector-square"></i>ЗУ из XML</a>
         <div class="separator"></div>
     
  
        <a href="tools.html" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-screwdriver-wrench"></i>Инструменты</a>
        <div class="separator"></div>
  

  <a href='mapmini.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-globe"></i>Карта Мини</a>

 <div class="separator"></div>
  

  <a href='photomap.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-camera"></i>Фото на карте</a>
        
  </div>
  
      <div class="left-dropdown" id="desktopDropdown">
          
                     <div class="dropdown">
    <a href="#" class="dropbtn"><i class="fas fa-laptop-code"></i>Web</a>
    <div class="dropdown-content">


        <a href='html.html' target='_blank' rel="noopener noreferrer"><i class="fa-solid fa-code"></i> HTML</a>
        <div class="separator"></div>


        <a href="http.html" target='_blank' rel="noopener noreferrer"><i class="fas fa-link"></i>HTTP</a>
 <div class="separator"></div>
        <a href='supabase.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-database"></i>Supabase</a>
        <div class="separator"></div>
  <a href='parser.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-exchange-alt"></i>XML JSON</a>
    <div class="separator"></div>

            <a href='ps.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-terminal"></i>PS</a>
   <div class="separator"></div>

 <a href='int.html' target='_blank' rel="noopener noreferrer"><i class="fa-solid fa-microchip"></i>Интерпретатор</a>
        <div class="separator"></div>


        
            <a href='src.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-file-code"></i>Исходный код</a>
  
       
   
    </div>
</div>
   <div class="separator"></div>
            
   <a href="webcam" target="_blank" rel="noopener noreferrer"><i class="fas fa-camera"></i>Веб-камера</a>
    <div class="separator"></div>
   <a href="win" target="_blank" rel="noopener noreferrer"><i class="fas fa-desktop"></i>Виртуальный ПК</a>
    <div class="separator"></div>
   
    <a href="ipcam" target="_blank" rel="noopener noreferrer"><i class="fas fa-desktop"></i>Камеры</a>
                 <div class="separator"></div>
        <a href='setup.html' target='_blank' rel="noopener noreferrer"><i class="fa-solid fa-gear"></i>Настройка</a>
        <div class="separator"></div>
              <a href="https://mapruapp.ru/chat/" target="_blank" rel="noopener noreferrer"><i class="fas fa-sms"></i>Переписка</a>
            <div class="separator"></div>
        <a href="поиск_файлов.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-binoculars"></i>Поиск файлов</a>
          <div class="separator"></div>
              <a href="f1.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-question-circle"></i>Помощь F1</a>
      <div class="separator"></div>
        <a href='app.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-desktop"></i>Программы</a>
             <div class="separator"></div>
                    <a href='v.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-folder-open"></i>Просмотрщик</a>

            <div class="separator"></div>


            
        <a href='ext.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-puzzle-piece"></i>Расширения</a>
    <div class="separator"></div>

  <a href='files' target='_blank' rel="noopener noreferrer"><i class="fas fa-file-alt"></i>Файлы</a>
    </div>


    
<div class="left-dropdown" id="fileDropdown">



    <!-- 2. ГЕОГРАФИЯ -->
    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-map-marked-alt"></i>География</a>
        <div class="dropdown-content">
            <a href='city.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-globe"></i>Города</a>
            <div class="separator"></div>
            <a href="explorer.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-globe-europe"></i>Исследователь</a>
            <div class="separator"></div>
            <a href='vg.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-street-view"></i>ВидеоГид</a>
            <div class="separator"></div>
            <a href='https://mapruapp.ru/tracker/' target='_blank' rel="noopener noreferrer"><i class="fas fa-map-marker-alt"></i>Трекер</a>
            <div class="separator"></div>
            <a href='weather.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-cloud-sun"></i>Погода</a>
        </div>
    </div>
    <div class="separator"></div>

    <!-- 3. ИНСТРУМЕНТЫ -->
    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-toolbox"></i>Инструменты</a>
        <div class="dropdown-content">
            <a href="calendar.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-calendar-alt"></i>Календарь</a>
   <div class="separator"></div>
            <a href="lab.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-flask"></i>Лаборатория</a>
            <div class="separator"></div>
            <a href="ruler" target="_blank" rel="noopener noreferrer"><i class="fas fa-ruler"></i>Линейка</a>
            <div class="separator"></div>
 <a href="otk" target="_blank" rel="noopener noreferrer"><i class="fas fa-gift"></i>Открытка</a>
            <div class="separator"></div>
            <a href='timer.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-stopwatch"></i>Таймер</a>
         
        </div>
    </div>
    <div class="separator"></div>

    <!-- 4. МЕДИА (Добавлено Пианино) -->
    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-film"></i>Медиа</a>
        <div class="dropdown-content">
            <a href='audio.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-headphones"></i>Аудио</a>
            <div class="separator"></div>
            <a href='music.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-music"></i>Музыка</a>
            <div class="separator"></div>
            <a href='piano.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-keyboard"></i>Пианино</a>
            <div class="separator"></div>
            <a href='video.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-video"></i>Видео</a>
            <div class="separator"></div>
            <a href='youtube.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-play"></i>YouTube</a>
        </div>
    </div>
    <div class="separator"></div>

    <!-- 5. ОБУЧЕНИЕ И ОБЩЕНИЕ (Слова, Тесты, Чат, Боты) -->
    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-user-graduate"></i>Обучение</a>
        <div class="dropdown-content">
            <a href="book.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-book"></i>Книга</a>
            <div class="separator"></div>
  <a href="words.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-language"></i>Слова</a>
            <div class="separator"></div>
   <a href="wordsm.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-spell-check"></i>Слова Мини</a>
            <div class="separator"></div>
            <a href="тестирование.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-check-circle"></i>Тестирование</a>
            <div class="separator"></div>
      
            <a href='telegram' target='_blank' rel="noopener noreferrer"><i class="fas fa-comment-dots"></i>Боты</a>
        </div>
    </div>
 <div class="separator"></div>

    <!-- 1. ФИНАНСЫ -->
    <div class="dropdown">
        <a href="#" class="dropbtn"><i class="fas fa-coins"></i>Финансы</a>
        <div class="dropdown-content">
            <a href='pr.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-shopping-bag"></i>Анализ цен</a>
            <div class="separator"></div>
            <a href="https://mapruapp.ru/market-monitor/" target="_blank" rel="noopener noreferrer"><i class="fas fa-chart-area"></i>Котировки</a>
            <div class="separator"></div>
            <a href='trade.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-chart-line"></i>Торговый симулятор</a>
            <div class="separator"></div>
            <a href='food.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-apple-alt"></i>Продукты</a>
        </div>
    </div>
            <div class="separator"></div>
        <a href='edu\sim.html' target='_blank' rel="noopener noreferrer"><i class="fas fas fa-rocket"></i>Симулятор</a>


</div>

<div class="left-dropdown" id="AIDropdown">
            <a href="ai.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-star"></i>ИИ</a>
         
                  <div class="separator"></div>


            <a href='an.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-magnifying-glass-chart"></i>Анализ</a>
   <div class="separator"></div>

   <a href="https://mapruapp.ru/file-processor/" target="_blank" rel="noopener noreferrer"><i class="fas fa-file-signature"></i>Архивариус</a>
         <div class="separator"></div>
   <a href="wiki.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-question-circle"></i>Википедия</a>
         <div class="separator"></div>
 <a href="диаграмма.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-chart-line"></i>Диаграмма</a>
 <div class="separator"></div>
 
   <a href='https://mapruapp.ru/doc-parser/' target='_blank' rel="noopener noreferrer"><i class="fas fa-clipboard-check"></i>Документы</a>
    <div class="separator"></div>

        
    <a href='cons.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-headset"></i>Консультант</a>
            <div class="separator"></div>
   <a href='medcons.html' target='_blank' rel="noopener noreferrer"><i class="fas fa-first-aid"></i>МедПомощник</a>
       
            <div class="separator"></div>

   <a href="https://mapruapp.ru/doc-generator/" target="_blank" rel="noopener noreferrer"><i class="fas fa-user-tie"></i>Референт</a>
           <div class="separator"></div>
   <a href="versus.html" target="_blank" rel="noopener noreferrer"><i class="fas fa-balance-scale"></i>Сравнение</a>
       
        
          
</div>


    <div id="f9Corner"></div>
    <div id="f9CornerRight">
        <img src="img/earth.png" alt="Normal Mode" class="normal-mode-icon">
        <img src="img/sun2.png" alt="F9 Mode" class="f9-mode-icon" style="display: none;">
    </div>
    <div id="result"></div>
    
    <!-- F9 Modal HTML -->
    <div id="f9ModalOverlay" class="modal-overlay">
        <div id="f9ModalContent" class="modal-content">
            <h2 id="f9ModalTitle"></h2>
            <ul id="f9ModalList"></ul>
            <div class="modal-footer">
                            <button id="f9ModalOpenAll">Открыть все</button>
            </div>
        </div>
    </div>
    
       <div id="infoModalOverlay" class="modal-overlay">
        <div id="infoModalContent" class="modal-content">
            <h2 id="infoModalTitle"></h2>
            <div id="infoModalBody"></div>
            <div class="modal-footer">
                <button id="infoModalClose">ОК</button>
            </div>
        </div>
    </div>
    
  <div id="bottomRightHoverArea">
        <a href="email: mapruapp@gmail.com" id="copyEmailIcon" class="gmail-icon" title="email: mapruapp@gmail.com">
            <img src="img/gmail.png" alt="Скопировать email">
        </a>
    </div>


 <!--  <script src="cb.js"></script>  -->
 

<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');

    ym(102727374, 'init', {clickmap:true, accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/102727374" style="position:absolute; left:-9999px;" alt="" /></div></noscript>




      <script>
        // NEW: Info Modal Functions
        const infoModalOverlay = document.getElementById('infoModalOverlay');
        const infoModalTitle = document.getElementById('infoModalTitle');
        const infoModalBody = document.getElementById('infoModalBody');
        const infoModalClose = document.getElementById('infoModalClose');
        
        let clipboardPermissionRequested = false;


        function showInfoModal(title, contentHtml) {
            infoModalTitle.textContent = title;
            infoModalBody.innerHTML = contentHtml;
            infoModalOverlay.classList.add('show');
        }

        function hideInfoModal() {
            infoModalOverlay.classList.remove('show');
        }

        infoModalClose.addEventListener('click', hideInfoModal);
        infoModalOverlay.addEventListener('click', (e) => {
            if (e.target === infoModalOverlay) {
                hideInfoModal();
            }
        });
        


        // NEW: Function to get browser-specific instructions
        function getClipboardInstructions() {
            const ua = navigator.userAgent;
            if (ua.includes("YaBrowser")) {
                return `
                    <div class="browser-instructions">
                        <strong>Для Яндекс.Браузера:</strong>
                        <ol>
                            <li>Нажмите на значок <strong>🔒 (замок)</strong> в адресной строке.</li>
                            <li>Внизу появившегося меню выберите <strong>"Подробнее"</strong> и <strong> "Все настройки содержимого"</strong></li>
                            <li>В открывшейся вкладке найдите пункт <strong>"Буфер обмена"</strong> и выберите "Разрешить".</li>
                            <li>Или просто перейдите по  адресу: browser://settings/content/clipboard</li>
                        </ol>
                    </div>`;
            } else if (ua.includes("Firefox")) {
                 return `
                    <div class="browser-instructions">
                        <strong>Для Mozilla Firefox:</strong>
                        <ol>
                            <li>Нажмите на значок <strong>🎛️ (ползунки)</strong> слева от замка 🔒 в адресной строке.</li>
                            <li>Найдите разрешение "Использовать буфер обмена" со статусом "Заблокировано".</li>
                            <li>Нажмите на крестик <strong>(❌)</strong> рядом, чтобы удалить эту блокировку.</li>
                            <li>Перезагрузите страницу.</li>
                        </ol>
                    </div>`;
            } else if (ua.includes("Chrome") && !ua.includes("Edg")) {
                 return `
                    <div class="browser-instructions">
                        <strong>Для Google Chrome:</strong>
                        <ol>
                            <li>Нажмите на значок <strong>🔒 (замок)</strong> в адресной строке.</li>
                            <li>В появившемся меню найдите пункт <strong>"Буфер обмена"</strong>.</li>
                            <li>Включите переключатель или выберите "Спрашивать" / "Разрешить".</li>
                            <li>Браузер предложит перезагрузить страницу.</li>
                        </ol>
                    </div>`;
            } else {
                 return `
                    <div class="browser-instructions">
                        <strong>Общая инструкция:</strong>
                        <ol>
                            <li>Нажмите на значок <strong>🔒 (замок)</strong> в адресной строке.</li>
                            <li>Перейдите в "Настройки сайта" или "Разрешения".</li>
                            <li>Найдите пункт, связанный с "Буфером обмена" (Clipboard), и измените его статус с "Блокировать" на "Спрашивать" или "Разрешить".</li>
                        </ol>
                    </div>`;
            }
        }

        // NEW: Smart clipboard copy function
async function copyToClipboard(text, onSuccessCallback) {
    if (!text || text.length <= 5) {
        if (onSuccessCallback) onSuccessCallback();
        return;
    }

    if (!navigator.clipboard || !navigator.permissions) {
        if (onSuccessCallback) onSuccessCallback();
        return;
    }

    try {
        // Сначала пытаемся просто записать. Это самый надёжный способ.
        // Если разрешение 'prompt', появится запрос.
        // Если 'granted', запись пройдет.
        // Если 'denied', вызов будет отклонён и мы попадём в блок catch.
        await navigator.clipboard.writeText(text);
        console.log('Текст успешно скопирован в буфер обмена!');
        if (onSuccessCallback) onSuccessCallback();
    } catch (err) {
        // Ошибка произошла. Скорее всего, из-за запрета доступа.
        console.error('Ошибка при записи в буфер обмена:', err);

        // Проверим статус разрешения, чтобы убедиться, что причина в запрете.
        try {
            const permissionStatus = await navigator.permissions.query({ name: 'clipboard-write', allowWithoutGesture: false });
            if (permissionStatus.state === 'denied') {
                const instructions = getClipboardInstructions();
                showInfoModal(
                    'Доступ заблокирован',
                    `<p>Не удалось скопировать текст, так как доступ к буферу обмена заблокирован.</p>
                     <p>Чтобы разрешить эту функцию, пожалуйста, следуйте инструкции для вашего браузера:</p>
                     ${instructions}
                     <p>После изменения настроек может потребоваться перезагрузить страницу.</p>`
                );
                // Важно: не вызываем колбэк, так как основное действие (копирование) не удалось.
            } else {
                // Если ошибка была по другой причине, просто выполняем действие
                if (onSuccessCallback) onSuccessCallback();
            }
        } catch (permissionError) {
             // Если даже проверка разрешений не работает, просто выполняем действие
             console.error('Не удалось проверить разрешение:', permissionError);
             if (onSuccessCallback) onSuccessCallback();
        }
    }
}
 
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        let snowflakes = [];
        const numSnowflakes = 30;
        let lastMouseMovement = Date.now();
        const mouseActiveTime = 3000;
        const baseSpeed = 1.5;
        const speedMultiplier = 2;
        const slowdownFactor = 2;
        const baseOpacity = 0.8;
        const fadeFactor = 2;
        const minOpacity = 0.1;
        const swayMagnitude = 0.5;

            let targetSnowflakes = numSnowflakes;
    const minSnowflakes = numSnowflakes;
    const maxSnowflakes = 400;
    const snowIncreaseSpeed = 100;
    let lastSnowflakeUpdate = Date.now();

            let mouseX = 0;
    let mouseY = 0;

        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        function createSnowflake() {
            return {
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 3 + 1,
                speedY: baseSpeed,
                speedX: Math.random() * 0.2 - 0.1,
                opacity: baseOpacity,
            };
        }
        function drawSnowflake(snowflake) {
            ctx.beginPath();
            ctx.arc(snowflake.x, snowflake.y, snowflake.size, 0, 2 * Math.PI);
            ctx.fillStyle = `rgba(255, 255, 255, ${snowflake.opacity})`;
            ctx.fill();
        }

      function updateSnowflakes() {
            const now = Date.now();
            const mouseIsMoving = now - lastMouseMovement < mouseActiveTime;

            if (mouseIsMoving) {
                targetSnowflakes = Math.min(maxSnowflakes, targetSnowflakes + snowIncreaseSpeed * (now-lastSnowflakeUpdate) / 1000);
            } else {
                 targetSnowflakes = Math.max(minSnowflakes, targetSnowflakes - snowIncreaseSpeed * (now-lastSnowflakeUpdate) / 1000) ;

            }
            lastSnowflakeUpdate = now;
            if (snowflakes.length !== Math.round(targetSnowflakes)) {

                if (snowflakes.length < Math.round(targetSnowflakes)) {
                    while (snowflakes.length < Math.round(targetSnowflakes)) {
                           snowflakes.push(createSnowflake());
                    }
                } else if (snowflakes.length > Math.round(targetSnowflakes)){
                    while (snowflakes.length > Math.round(targetSnowflakes)) {
                        snowflakes.pop();
                  }
                }

            }

            snowflakes.forEach(snowflake => {
                if (mouseIsMoving) {
                   snowflake.speedY = baseSpeed * speedMultiplier;
                  snowflake.opacity = baseOpacity;

                    const dx = snowflake.x - mouseX;
                    const dy = snowflake.y - mouseY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if(distance < 80){
                        const pushForce = 1.5;
                            snowflake.speedX += (dx / distance) * pushForce;
                            snowflake.speedY += (dy / distance) * pushForce;
                       }
                    } else {
                    snowflake.speedY = baseSpeed / slowdownFactor;
                    snowflake.opacity = baseOpacity / fadeFactor;
                    snowflake.x += Math.sin(now / 200) * swayMagnitude;

                }

                snowflake.y += snowflake.speedY;
               snowflake.x += snowflake.speedX;
                 if (!mouseIsMoving && snowflake.opacity > minOpacity) {
                       snowflake.opacity -= 0.01;
                    }
                 if (snowflake.y > canvas.height || snowflake.opacity <= minOpacity) {
                     snowflake.y = 0;
                      snowflake.x = Math.random() * canvas.width;
                        snowflake.opacity = baseOpacity;
                 }
               snowflake.speedX *= 0.98;
               snowflake.speedY *= 0.98;
           });
       }


        function animateSnow() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            updateSnowflakes();
            snowflakes.forEach(drawSnowflake);
            requestAnimationFrame(animateSnow);
        }
        function setupSnow() {
            initCanvas();
            for (let i = 0; i < numSnowflakes; i++) {
                snowflakes.push(createSnowflake());
            }
            animateSnow();
            window.addEventListener('resize', initCanvas);
            document.addEventListener('mousemove', () => {
                lastMouseMovement = Date.now();
            });
        }


    let isF9Mode = false;
    const originalPlaceholder = document.getElementById('searchText').placeholder;
    const numberButtons = document.getElementById('numberButtons');
    const addressButtons = document.getElementById('addressButtons');
    const f9Buttons = document.getElementById('f9Buttons');
    const searchInput = document.getElementById('searchText');
    const title = document.getElementById('searchTitle');
    const container = document.getElementById('draggableContainer');
    let isDraggable = true;
    let isDragging = false;
    let moveAtHandler;
    
   
    let backgroundStateIndex = -1;
    const backgroundColors = [
        '#FFFFFF', // 1. Белый
        '#FF4136', // 2. Красный
        '#0074D9', // 3. Синий
        '#2ECC40', // 4. Зеленый
        '#FFDC00', // 5. Желтый
        '#FF851B', // 6. Оранжевый
        '#B10DC9', // 7. Фиолетовый
        '#39CCCC', // 8. Бирюзовый
        '#F012BE', // 9. Пурпурный
        '#AAAAAA', // 10. Серый
    ];
   

   const sevenDigitsRegions = [
  '06', '07', '09', '10', '11', '12', '13', '14', '17', '23',
  '24', '27', '31', '32', '35', '36', '41', '42', '47', '48',
  '50', '52', '53', '56', '57', '58', '59', '60', '61', '62',
  '63', '64', '65', '66', '67', '69', '70', '71', '72', '74',
  '77', '78', '79'];

    function formatCadastralNumber(text) {
        text = text.replace(/[^\d]/g, '');
        const firstTwoDigits = text.slice(0, 2);
        const isSevenDigits = sevenDigitsRegions.includes(firstTwoDigits);
        const thirdBlockLength = isSevenDigits ? 7 : 6;

        let formattedText = '';
        if (text.length > 0) formattedText += text.slice(0, 2);
        if (text.length > 2) formattedText += ':' + text.slice(2, 4);
        if (text.length > 4) {
            const remainingDigits = text.slice(4);
            if (remainingDigits.length <= thirdBlockLength) {
                formattedText += ':' + remainingDigits;
            } else {
                formattedText += ':' + remainingDigits.slice(0, thirdBlockLength) + ':' + remainingDigits.slice(thirdBlockLength);
            }
        }
        return formattedText;
    }
    function addPulseRotateEffect() {
        const f9CornerRight = document.getElementById('f9CornerRight');
        f9CornerRight.classList.add('pulse-rotate');
        setTimeout(() => {
            f9CornerRight.classList.remove('pulse-rotate');
        }, 300);
    }
    function changeBackgroundImage() {
  const backgroundImages = [
            'wall/photo-1539667547529-84c607280d20.jpg',
            'wall/photo-1470329508532-be27fda94658.jpg',
            'wall/photo-1542259009477-d625272157b7.jpg',
            'wall/photo-1464822759023-fed622ff2c3b.jpg',
            'wall/photo-1495107334309-fcf20504a5ab.jpg',
            'wall/photo-1440558929809-1412944a6225.jpg',
            'wall/photo-1509088960169-ecb53eda6ed8.jpg',
            'wall/photo-1444723121867-7a241cacace9.jpg',
            'wall/photo-1639787422603-67df3f9759e2.jpg',
            'wall/photo-1613988800332-3e20b47801a4.jpg',
            'wall/photo-1452302372225-a5ba1edd65ca.jpg',
            'wall/photo-1585130401366-fe05a8d813c4.jpg',
            'wall/photo-1507525428034-b723cf961d3e.jpg',
        ];
        const randomIndex = Math.floor(Math.random() * backgroundImages.length);
        document.body.style.background = `url("${backgroundImages[randomIndex]}") no-repeat center center fixed`;
        document.body.style.backgroundSize = 'cover';
    }
    function showButtons(buttonsContainer) {
        buttonsContainer.style.display = 'flex';
    }
    function hideButtons(buttonsContainer) {
        buttonsContainer.style.display = 'none';
    }
    function replaceEnglishWithRussian(text) {
        const map = {
            'q': 'й', 'w': 'ц', 'e': 'у', 'r': 'к', 't': 'е', 'y': 'н', 'u': 'г', 'i': 'ш', 'o': 'щ', 'p': 'з', '[': 'х', ']': 'ъ', 'a': 'ф', 's': 'ы', 'd': 'в', 'f': 'а', 'g': 'п', 'h': 'р', 'j': 'о', 'k': 'л', 'l': 'д', ';': 'ж', '\'': 'э', 'z': 'я', 'x': 'ч', 'c': 'с', 'v': 'м', 'b': 'и', 'n': 'т', 'm': 'ь', ',': 'б', '.': 'ю', '/': '.', 'Q': 'Й', 'W': 'Ц', 'E': 'У', 'R': 'К', 'T': 'Е', 'Y': 'Н', 'U': 'Г', 'I': 'Ш', 'O': 'Щ', 'P': 'З', '{': 'Х', '}': 'Ъ', 'A': 'Ф', 'S': 'Ы', 'D': 'В', 'F': 'А', 'G': 'П', 'H': 'Р', 'J': 'О', 'K': 'Л', 'L': 'Д', ':': 'Ж', '"': 'Э', 'Z': 'Я', 'X': 'Ч', 'C': 'С', 'V': 'М', 'B': 'И', 'N': 'Т', 'M': 'Ь', '<': 'Б', '>': 'Ю', '?': ','
        };
        return text.split('').map(char => map[char] || char).join('');
    }

    function isValidCadastralNumber(text) {
         const firstTwoDigits = text.slice(0, 2);
        const isSevenDigits = sevenDigitsRegions.includes(firstTwoDigits);
        const digitsAfterSecondColon = isSevenDigits ? 7 : 6;
        const pattern = new RegExp(`^\\d{2}:\\d{2}:\\d{${digitsAfterSecondColon}}:\\d+$`);
        return pattern.test(text);
    }
    
    
    
let clipboardCheckedOnFocus = false;

async function pasteFromClipboardOnFocus() {
    if (clipboardCheckedOnFocus || searchInput.value.length > 0 || !navigator.clipboard) {
        return;
    }
    clipboardCheckedOnFocus = true;

    try {
        // Просто пытаемся читать. Если разрешение есть, сработает. Если нет, будет ошибка, которую мы игнорируем.
        const clipboardText = await navigator.clipboard.readText();
        if (isValidCadastralNumber(clipboardText)) {
            searchInput.value = clipboardText;
            searchInput.style.transition = 'background-color 0.3s ease';
            searchInput.style.backgroundColor = '#e6ffed';
            setTimeout(() => {
                searchInput.style.backgroundColor = '';
            }, 1000);
        }
    } catch (err) {
        // Мы ожидаем ошибку, если пользователь не дал разрешение. Молча ее игнорируем.
        console.log('Чтение из буфера обмена не удалось (вероятно, нет разрешения).');
    }
}



async function requestClipboardReadPermission() {
    // Если уже запрашивали или браузер не поддерживает API, выходим.
    if (clipboardPermissionRequested || !navigator.permissions || !navigator.clipboard) {
        return;
    }
    
    // Отмечаем, что запрос был.
    clipboardPermissionRequested = true;
    
    try {
        // Мы не будем ничего читать. Нам важно просто "спросить".
        // Лучший способ это сделать — запросить статус разрешения.
        // Браузер сам покажет окно, если статус 'prompt'.
        const permissionStatus = await navigator.permissions.query({ name: 'clipboard-read', allowWithoutGesture: false });

        // Нам не нужно обрабатывать результат. Главное, что запрос был инициирован.
        // Если пользователь разрешит, 'granted' сохранится для всего сайта.
        // Если запретит, 'denied' сохранится, и мы больше не будем его беспокоить.
        console.log('Статус разрешения на чтение из буфера обмена:', permissionStatus.state);

    } catch (err) {
        console.error('Не удалось запросить разрешение на чтение из буфера обмена:', err);
    }
}


    async function checkClipboardForCadastralNumber() {
        try {
            const clipboardText = await navigator.clipboard.readText();
            console.log('Текст из буфера обмена:', clipboardText);
            if (isValidCadastralNumber(clipboardText)) {
                console.log('В буфере обмена найден кадастровый номер. Вставляем в searchText.');
                document.getElementById('searchText').value = clipboardText;
            } else {
                console.log('Текст в буфере обмена не является кадастровым номером.');
            }
        } catch (error) {
            console.error('Ошибка при чтении буфера обмена:', error);
        }
    }

    function openSite(baseUrl, isAddress, isSpecialKadastrMap = false, isPkkOks = false) {
        const text = document.getElementById('searchText').value;
        if (isAddress) {
            if (/[А-Яа-я]/.test(text.charAt(0))) {
                const url = isSpecialKadastrMap ? `${baseUrl}${encodeURIComponent(text)}` : `${baseUrl}${encodeURIComponent(text)}`;
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        } else {
            if (isValidCadastralNumber(text)) {
                if (isSpecialKadastrMap) {
                    const formattedText = text.replace(/:/g, '-');
                    window.open(`${baseUrl}${formattedText}/`, '_blank', 'noopener,noreferrer');
                } else if (isPkkOks) {
                } else {
                    const isKadastrovyKvartal = (text.match(/:/g) || []).length === 2;
                    if (baseUrl === 'https://pkk.rosreestr.ru/#/search/?text=') {
                        let url;
                        if (isKadastrovyKvartal) {
                            url = `${baseUrl}${text}&type=2`;
                        } else {
                            let encodedText = text.replace(/:/g, '%3A');
                            encodedText = encodedText.replace(/%3A0/g, '%3A');
                            url = `${baseUrl}${text}&opened=${encodedText}`;
                        }
                        window.open(url, '_blank', 'noopener,noreferrer');
                    } else {
                        window.open(`${baseUrl}${text}`, '_blank', 'noopener,noreferrer');
                    }
                }
            }
        }
    }
    function snapToLeft(container) {
        container.style.left = '0px';
        container.style.top = '0px';
        container.style.height = '100vh';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.justifyContent = 'center';
        container.style.transition = 'all 0.3s ease-in-out';
        saveContainerState('snaptoleft');
    }
    function resetContainer() {
        container.style.left = '';
        container.style.top = '';
        container.style.height = '';
        container.style.display = '';
        container.style.flexDirection = '';
        container.style.justifyContent = 'center';
        container.style.transition = 'all 0.3s ease-in-out';
        saveContainerState('center');
    }
    function saveContainerState(state) {
        localStorage.setItem('containerState', state);
    }
    function loadContainerState() {
        return localStorage.getItem('containerState') || 'center';
    }
    function initDraggable() {
        const f9Corner = document.getElementById('f9Corner');
        f9Corner.onmousedown = function(event) {
            event.preventDefault();
            event.stopPropagation();
            const containerState = loadContainerState();
            if (containerState === 'snaptoleft') {
                resetContainer();
            } else {
                snapToLeft(container);
            }
        };
        container.onmousedown = function(event) {
            if (!isDraggable || event.target.tagName === 'A' || event.target.tagName === 'INPUT' || event.target === f9Corner) {
                return;
            }
            if (event.button === 1) {
                event.preventDefault();
                toggleF9Mode();
                return;
            }
            isDragging = true;
            let shiftX = event.clientX - container.getBoundingClientRect().left;
            let shiftY = event.clientY - container.getBoundingClientRect().top;
            container.style.position = 'fixed';
            container.style.zIndex = 1000;
            document.body.append(container);
            moveAtHandler = function(pageX, pageY) {
                container.style.left = pageX - shiftX + 'px';
                container.style.top = pageY - shiftY + 'px';
            };
            document.addEventListener('mousemove', moveAtHandler);
            container.onmouseup = function() {
                document.removeEventListener('mousemove', moveAtHandler);
                container.onmouseup = null;
                isDragging = false;
                saveContainerState('center');
            };
        };
        container.ondragstart = function() {
            return false;
        };
    }

    function toggleMobileVersion() {
        const isMobile = window.matchMedia("(max-width: 768px), (orientation: portrait)").matches;
        document.body.classList.toggle('mobile-version', isMobile);
    }
    function showContainer() {
        const container = document.getElementById('draggableContainer');
        container.classList.add('show');
    }
    function saveF9Mode() {
        localStorage.setItem('isF9Mode', JSON.stringify(isF9Mode));
    }
    function updateF9Icon() {
        const normalModeIcon = document.querySelector('#f9CornerRight .normal-mode-icon');
        const f9ModeIcon = document.querySelector('#f9CornerRight .f9-mode-icon');
        if (isF9Mode) {
            normalModeIcon.style.display = 'none';
            f9ModeIcon.style.display = 'block';
            f9ModeIcon.style.opacity = '0.8';
            normalModeIcon.style.opacity = '0.4';
        } else {
            normalModeIcon.style.display = 'block';
            f9ModeIcon.style.display = 'none';
            normalModeIcon.style.opacity = '0.8';
            f9ModeIcon.style.opacity = '0.4';
        }
    }
    function toggleF9Mode() {
        isF9Mode = !isF9Mode;
        if (isF9Mode) {
            enterF9Mode();
        } else {
            exitF9Mode();
        }
        updateFavicon();
        saveF9Mode();
        addPulseRotateEffect();
        updateF9Icon();
        console.log('F9 Mode:', isF9Mode);
    }
    function enterF9Mode() {
        numberButtons.style.display = 'none';
        addressButtons.style.display = 'none';
        f9Buttons.style.display = 'flex';
        searchInput.placeholder = '';
        searchInput.value = '';
        title.textContent = '';
        title.classList.remove('text-address', 'text-cadastral');
        searchInput.removeEventListener('input', normalModeInputHandler);
        searchInput.addEventListener('input', f9ModeInputHandler);
        document.title = 'Ассистент - Поиск';
        document.body.classList.add('f9-mode');
    }
    function exitF9Mode() {
        f9Buttons.style.display = 'none';
        searchInput.placeholder = originalPlaceholder;
        searchInput.value = '';
        numberButtons.style.display = 'flex';
        addressButtons.style.display = 'none';
        title.classList.add('text-cadastral');
        title.classList.remove('text-address');
        searchInput.removeEventListener('input', f9ModeInputHandler);
        searchInput.addEventListener('input', normalModeInputHandler);
        document.title = 'Ассистент';
        document.body.classList.remove('f9-mode');
    }
    function f9ModeInputHandler() {}
    let addressPKKButtonListenerAdded = false;
    let addressKadastrmapButtonListenerAdded = false;
    let addressMapButtonListenerAdded = false;

   function normalModeInputHandler() {
        if (isF9Mode) return;
        const input = searchInput;
        input.value = replaceEnglishWithRussian(input.value);
        const firstChar = input.value.trim().charAt(0);
        if (/[А-Яа-я]/.test(firstChar)) {
            numberButtons.style.display = 'none';
            addressButtons.style.display = 'flex';
            title.textContent = '';
            title.classList.add('text-address');
            title.classList.remove('text-cadastral');

            const addressPKKButton = document.getElementById('addressPKKButton');
            const addressKadastrmapButton = document.getElementById('addressKadastrmapButton');
            const addressMapButton = document.getElementById('addressMapButton');

            if (addressPKKButton && !addressPKKButtonListenerAdded) {
                addressPKKButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    const text = document.getElementById('searchText').value;
                    copyToClipboard(text, () => {
                         window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
                    });
                });
                addressPKKButtonListenerAdded = true;
            }

            if (addressMapButton && !addressMapButtonListenerAdded) {
                addressMapButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    const text = document.getElementById('searchText').value;
                    copyToClipboard(text, () => {
                        window.open('map.html', '_blank', 'noopener,noreferrer');
                    });
                });
                addressMapButtonListenerAdded = true;
            }


        } else {
            input.value = formatCadastralNumber(input.value.replace(/[^\d]/g, ''));
            addressButtons.style.display = 'none';
            numberButtons.style.display = 'flex';
            title.textContent = '';
            title.classList.add('text-cadastral');
            title.classList.remove('text-address');
            addressPKKButtonListenerAdded = false;
            addressKadastrmapButtonListenerAdded = false;
            addressMapButtonListenerAdded = false;
        }
    }
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F9') {
            e.preventDefault();
            toggleF9Mode();
        }
    });;
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F8') {
            e.preventDefault();
            backgroundStateIndex++;
            if (backgroundStateIndex >= backgroundColors.length) {
                backgroundStateIndex = -1;
                document.body.style.backgroundColor = '';
                changeBackgroundImage();
            } else {
                document.body.style.backgroundImage = 'none';
                document.body.style.backgroundColor = backgroundColors[backgroundStateIndex];
            }
        }
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        const f9CornerRight = document.getElementById('f9CornerRight');
        f9CornerRight.addEventListener('click', function(e) {
            e.preventDefault();
            toggleF9Mode();
        });
        f9CornerRight.addEventListener('mouseenter', function() {
            this.querySelector('img:not([style*="display: none"])').style.opacity = '1';
        });
        f9CornerRight.addEventListener('mouseleave', function() {
            if (!isF9Mode) {
                this.querySelector('.normal-mode-icon').style.opacity = '0.4';
            } else {
                this.querySelector('.f9-mode-icon').style.opacity = '0.4';
            }
        });

        let activeDropdown = null;
        
        const leftIcons = ['fileIcon', 'imageIcon', 'AIbutton', 'textIcon', 'desktopIcon'];
        const leftDropdowns = ['fileDropdown', 'imageDropdown', 'AIDropdown', 'textDropdown', 'desktopDropdown'];

        leftIcons.forEach((iconId, index) => {
            const icon = document.getElementById(iconId);
            const dropdown = document.getElementById(leftDropdowns[index]);
            if(icon && dropdown) {
                icon.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (activeDropdown && activeDropdown !== dropdown) {
                        activeDropdown.classList.remove('show');
                    }
                    dropdown.classList.toggle('show');
                    activeDropdown = dropdown.classList.contains('show') ? dropdown : null;
                });
            }
        });
        
        const schemaIcon = document.getElementById('schemaIcon');
        const schemaDropdown = document.getElementById('schemaDropdown');
        if(schemaIcon && schemaDropdown) {
            schemaIcon.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (activeDropdown && activeDropdown !== schemaDropdown) {
                    activeDropdown.classList.remove('show');
                }
                schemaDropdown.classList.toggle('show');
                activeDropdown = schemaDropdown.classList.contains('show') ? schemaDropdown : null;
            });
        }

        const rosreestrIcon = document.getElementById('rosreestrIcon');
        const rosreestrDropdown = document.getElementById('rosreestrDropdown');
        let isMenuVisible = false;
        rosreestrIcon.addEventListener('click', function(e) {
            e.preventDefault();
            isMenuVisible = !isMenuVisible;
            rosreestrDropdown.classList.toggle('show', isMenuVisible);
            if(isMenuVisible && activeDropdown){
                activeDropdown.classList.remove('show');
                activeDropdown = null;
            }
        });

        document.addEventListener('click', function(e) {
            if (activeDropdown && !e.target.closest('.left-menu') && !e.target.closest('.left-dropdown') && !e.target.closest('.social-icons') && !e.target.closest('.right-dropdown')) {
                activeDropdown.classList.remove('show');
                activeDropdown = null;
            }
            if (isMenuVisible && !rosreestrIcon.contains(e.target) && !rosreestrDropdown.contains(e.target)) {
                isMenuVisible = false;
                rosreestrDropdown.classList.remove('show');
            }
        });
    });
        
    const f9ModalOverlay = document.getElementById('f9ModalOverlay');
    const f9ModalTitle = document.getElementById('f9ModalTitle');
    const f9ModalList = document.getElementById('f9ModalList');
    const f9ModalOpenAll = document.getElementById('f9ModalOpenAll');

    let currentModalUrls = [];

    function showF9Modal(title, services) {
        const searchText = document.getElementById('searchText').value;
        const searchQuery = encodeURIComponent(searchText);

        f9ModalTitle.textContent = title;
        f9ModalList.innerHTML = '';
        currentModalUrls = [];

        services.forEach(service => {
            const fullUrl = service.url.includes('{query}') 
                ? service.url.replace('{query}', searchQuery)
                : service.url;
            currentModalUrls.push(fullUrl);
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = fullUrl;
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
            const favicon = document.createElement('img');
            const domain = new URL(service.url).hostname;
            favicon.src = `https://www.google.com/s2/favicons?sz=32&domain_url=${domain}`;
            favicon.alt = `${service.name} favicon`;
            favicon.onerror = function() { this.style.visibility = 'hidden'; };
            const nameSpan = document.createElement('span');
            nameSpan.textContent = service.name;
            link.appendChild(favicon);
            link.appendChild(nameSpan);
            listItem.appendChild(link);
            f9ModalList.appendChild(listItem);
        });
        f9ModalOverlay.classList.add('show');
    }

    function hideF9Modal() {
        f9ModalOverlay.classList.remove('show');
    }

    f9ModalOpenAll.addEventListener('click', () => {
        openMultipleUrls(currentModalUrls);
        hideF9Modal();
    });

    f9ModalOverlay.addEventListener('click', (e) => {
        if (e.target === f9ModalOverlay) {
            hideF9Modal();
        }
    });

    window.onload = function() {
       
        changeBackgroundImage();
        toggleMobileVersion();
        loadF9Mode();
        let snowEnabled = false;
        if(snowEnabled) {
            setupSnow();
        }
        const containerState = loadContainerState();
        if (containerState === 'snaptoleft') {
            snapToLeft(container);
        } else {
            resetContainer();
        }
        setTimeout(showContainer, 1);
        const socialIcons = document.querySelector('.social-icons');
        const leftMenu = document.querySelector('.left-menu');
        function loadF9Mode() {
            const savedMode = localStorage.getItem('isF9Mode');
            if (savedMode !== null) {
                isF9Mode = JSON.parse(savedMode);
                if (isF9Mode) {
                    enterF9Mode();
                } else {
                    exitF9Mode();
                }
            }
        }
         let iconsVisible = localStorage.getItem('iconsVisible') !== 'false';
        updateIconsVisibility();
        function showIcons() {
            iconsVisible = true;
            updateIconsVisibility();
            saveIconsState();
        }
        function hideIcons() {
            iconsVisible = false;
            updateIconsVisibility();
            saveIconsState();
        }
        function toggleIcons() {
            iconsVisible = !iconsVisible;
            updateIconsVisibility();
            saveIconsState();
            if (iconsVisible) {
                socialIcons.style.animation = 'none';
                leftMenu.style.animation = 'none';
                void socialIcons.offsetWidth;
                void leftMenu.offsetWidth;
                socialIcons.style.animation = '';
                leftMenu.style.animation = '';
            }
        }
        function updateIconsVisibility() {
            if (iconsVisible) {
                socialIcons.classList.add('visible');
                leftMenu.classList.add('visible');
                socialIcons.style.pointerEvents = 'auto';
                leftMenu.style.pointerEvents = 'auto';
                socialIcons.querySelectorAll('a').forEach((icon, index) => {
                    icon.style.animationDelay = `${index * 0.1}s`;
                });
                leftMenu.querySelectorAll('a').forEach((icon, index) => {
                    icon.style.animationDelay = `${index * 0.1}s`;
                });
            } else {
                socialIcons.classList.remove('visible');
                leftMenu.classList.remove('visible');
                socialIcons.style.pointerEvents = 'none';
                leftMenu.style.pointerEvents = 'none';
                socialIcons.querySelectorAll('a').forEach(icon => {
                    icon.style.animationDelay = '';
                });
                leftMenu.querySelectorAll('a').forEach(icon => {
                    icon.style.animationDelay = '';
                });
            }
        }
        function saveIconsState() {
            localStorage.setItem('iconsVisible', iconsVisible);
        }
        document.addEventListener('dblclick', function(event) {
            if (!socialIcons.contains(event.target) && !leftMenu.contains(event.target)) {
                toggleIcons();
            }
        });
        searchInput.addEventListener('input', function() {
            if (isF9Mode) {
                f9ModeInputHandler();
            } else {
                normalModeInputHandler();
            }
        });

        searchInput.addEventListener('input', normalModeInputHandler);
        window.addEventListener('resize', toggleMobileVersion);
        document.getElementById('yandexNavButton').addEventListener('click', function(e) {
            e.preventDefault();
            this.classList.add('active');
            const input = this.querySelector('input');
            input.style.display = 'block';
            input.focus();
        });
        document.querySelector('#yandexNavButton input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const startPoint = document.getElementById('searchText').value;
                const endPoint = this.value;
                let url;
                if (e.ctrlKey) {
                    url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(startPoint)}&destination=${encodeURIComponent(endPoint)}`;
                } else {
                    url = `https://yandex.ru/maps/?rtext=${encodeURIComponent(startPoint)}~${encodeURIComponent(endPoint)}&rtt=auto`;
                }
                window.open(url, '_blank', 'noopener,noreferrer');
                this.value = '';
                this.style.display = 'none';
                this.parentElement.classList.remove('active');
            }
        });

        document.getElementById('searchText').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const searchText = this.value.trim();
                if (isF9Mode) {
                    if (searchText) {
                        const url = `https://iask.ai/?mode=question&q=${encodeURIComponent(searchText)}`;
                        window.open(url, '_blank', 'noopener,noreferrer');
                    }
                } else {
                    document.getElementById('pkkButton').click();
                }
            }
        });

        document.querySelector('#yandexNavButton input').addEventListener('input', function() {
            this.value = replaceEnglishWithRussian(this.value);
        });
        document.addEventListener('click', function(e) {
            const yandexNavButton = document.getElementById('yandexNavButton');
            if (!yandexNavButton.contains(e.target)) {
                yandexNavButton.classList.remove('active');
                yandexNavButton.querySelector('input').style.display = 'none';
            }
        });
        initDraggable();

        document.getElementById('roscadastresButton').addEventListener('click', function() {
            const text = document.getElementById('searchText').value;
            copyToClipboard(text, () => {
                window.open('map.html', '_blank', 'noopener,noreferrer');
            });
        });

        document.getElementById('rosreestrButton').addEventListener('click', function() {
            const text = document.getElementById('searchText').value;
            const url = 'https://map.ru/pkk?kad=' + encodeURIComponent(text);
            window.open(url, '_blank', 'noopener,noreferrer');
        });
        
        document.getElementById('egrpButton').addEventListener('click', function() {
            const text = document.getElementById('searchText').value;
            copyToClipboard(text, () => {
                 window.open('egrn.html', '_blank', 'noopener,noreferrer');
            });
        });
  
        document.getElementById('yandexButton').addEventListener('click', function() { openSite('https://yandex.ru/maps/?text=', true); });
        document.getElementById('googleButton').addEventListener('click', function() { openSite('https://www.google.com/maps/search/', true); });
        document.getElementById('earthButton').addEventListener('click', function() { openSite('https://earth.google.com/web/search/', true); });
        document.getElementById('bingButton').addEventListener('click', function() { openSite('https://www.bing.com/maps?q=', true); });
        document.getElementById('gisButton').addEventListener('click', function() { openSite('https://2gis.ru/search/', true); });
        
        document.getElementById('aiSearchButton').addEventListener('click', function(e) {
            e.preventDefault();
            const services = [ { name: "Yandex", url: "https://ya.ru/n?from=dbro_ntp_box&clid=2261451&banerid=0600000000%3ASW-5c6316afa997&win=628&text={query}" }, { name: "Phind", url: "https://www.phind.com/search?q={query}" }, { name: "Perplexity", url: "https://www.perplexity.ai/search?q={query}" }, { name: "iAsk.ai", url: "https://iask.ai/?mode=question&q={query}" } ];
            showF9Modal('AI Поиск', services);
        });

        document.getElementById('pharmaciesButton').addEventListener('click', function(e) {
            e.preventDefault();
            const services = [ { name: "Фармленд", url: "https://farmlend.ru/search?keyword={query}" }, { name: "Аптека.ру", url: "https://apteka.ru/search/?q={query}" }, { name: "Вита", url: "https://vitaexpress.ru/search/?q={query}" }, { name: "Аптеки Плюс", url: "https://aptekiplus.ru/kazan/catalog/root/?q={query}" } ];
            showF9Modal('Аптеки', services);
        });

        document.getElementById('audiobooksButton').addEventListener('click', function(e) {
            e.preventDefault();
            const services = [ { name: "aKniga", url: "https://akniga.org/search/books/?q={query}" }, { name: "Книги в Ухе", url: "https://knigivuhe.com/index.php?do=search&subaction=search&search_start=0&full_search=0&story={query}" }, { name: "KnigaVuhe", url: "https://knigavuhe.org/search/?q={query}" } ];
            showF9Modal('Аудиокниги', services);
        });
        
        document.getElementById('quotesButton').addEventListener('click', function(e) {
            e.preventDefault();
            const searchText = document.getElementById('searchText').value.trim();
            let services;
            if (searchText === "") {
                services = [ { name: "Finviz Forex", url: "https://finviz.com/forex.ashx" }, { name: "Finviz Crypto", url: "https://finviz.com/crypto.ashx" }, { name: "Finviz Stock Map", url: "https://finviz.com/map.ashx?t=sec_all" } ];
            } else {
                services = [{ name: "Investing.com", url: "https://ru.investing.com/search/?q={query}" }];
            }
            showF9Modal('Котировки', services);
        });

        document.getElementById('marketplacesButton').addEventListener('click', function(e) {
            e.preventDefault();
            const services = [ { name: "Ozon", url: "https://www.ozon.ru/search/?text={query}" }, { name: "МегаМаркет", url: "https://megamarket.ru/catalog/?q={query}" }, { name: "Wildberries", url: "https://www.wildberries.ru/catalog/0/search.aspx?search={query}" }, { name: "Яндекс.Маркет", url: "https://market.yandex.ru/search?text={query}" }, { name: "МагнитМаркет", url: "https://mm.ru/search?query={query}" }, { name: "AliExpress", url: "https://aliexpress.ru/wholesale?SearchText={query}" }, { name: "Pepper.ru", url: "https://www.pepper.ru/search_result?keyword={query}&search_list=deals&ref=most_searched" } ];
            showF9Modal('Маркетплейсы', services);
        });

        document.getElementById('siteSearchButton').addEventListener('click', function(e) {
            e.preventDefault();
            this.classList.add('active');
            const input = this.querySelector('input');
            input.style.display = 'block';
            input.focus();
        });
        document.querySelector('#siteSearchButton input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const searchText = document.getElementById('searchText').value;
                const siteUrl = this.value.trim();
                let yandexQuery, googleQuery;
                if (siteUrl) {
                    yandexQuery = `site:${siteUrl} ${searchText}`;
                    googleQuery = `site:${siteUrl} ${searchText}`;
                } else {
                    yandexQuery = searchText;
                    googleQuery = searchText;
                }
                window.open(`https://yandex.ru/search/?text=${encodeURIComponent(yandexQuery)}`, '_blank', 'noopener,noreferrer');
                window.open(`https://www.google.com/search?q=${encodeURIComponent(googleQuery)}`, '_blank', 'noopener,noreferrer');
                this.value = '';
                this.style.display = 'none';
                this.parentElement.classList.remove('active');
            }
        });
        document.addEventListener('click', function(e) {
            const siteSearchButton = document.getElementById('siteSearchButton');
            if (!siteSearchButton.contains(e.target)) {
                siteSearchButton.classList.remove('active');
                siteSearchButton.querySelector('input').style.display = 'none';
            }
        });
        document.getElementById('organizationsButton').addEventListener('click', function(e) {
            e.preventDefault();
             const services = [ { name: "ФНС", url: "https://pb.nalog.ru/search.html#t=1&mode=search-all&queryAll={query}" }, { name: "СПАРК-Интерфакс", url: "https://spark-interfax.ru/search?Query={query}&type=all&sort=" }, { name: "List-Org", url: "https://www.list-org.com/search?val={query}" } ];
            showF9Modal('Организации', services);
        });
        
        document.getElementById('legalSystemsButton').addEventListener('click', function(e) {
            e.preventDefault();
            const services = [ { name: "Техэксперт", url: "https://docs.cntd.ru/search?q={query}" }, { name: "Гарант", url: "https://ivo.garant.ru/#/basesearch/{query}" }, { name: "Контур.Норматив", url: "https://normativ.kontur.ru/?query={query}&searching=true&sortby=1&searchquerysource=2&from=Main" }, { name: "КонсультантПлюс", url: "https://www.consultant.ru/search/?q={query}" } ];
            showF9Modal('Правовые системы', services);
        });
    };
    function openMultipleUrls(urls) {
        function openWindows(index = 0) {
            if (index >= urls.length) return;
            const newWindow = window.open(urls[index], '_blank', 'noopener,noreferrer');
            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                showPopupInstructions(() => openWindows(index));
            } else {
                setTimeout(() => openWindows(index + 1), 100);
            }
        }
        function showPopupInstructions(retryCallback) {
            const instructions = document.createElement('div');
            instructions.style.cssText = ` position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; border: 1px solid #ccc; border-radius: 5px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 1000; `;
            instructions.innerHTML = ` <h3>Всплывающие окна заблокированы</h3> <p>Пожалуйста, разрешите всплывающие окна для этого сайта в настройках вашего браузера, затем нажмите кнопку ниже, чтобы повторить попытку.</p> <button id="retryButton">Повторить</button> `;
            document.body.appendChild(instructions);
            document.getElementById('retryButton').addEventListener('click', function() {
                instructions.remove();
                retryCallback();
            });
        }
        openWindows();
    };
    document.addEventListener('keydown', function(e) {
        if (e.key === 'F4') {
            e.preventDefault();
            openHTMLFile();
        }
    });
    function openHTMLFile() {
        const filePath = '193.124.64.31:8000';
        window.open(filePath, '_blank', 'noopener,noreferrer');
    }
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function activateSunbeam() {
        const sunbeam = document.getElementById('sunbeam');
        const directions = [ { transform: 'rotate(0deg) translateX(-100%)', to: 'translateX(100%)' }, { transform: 'rotate(0deg) translateX(100%)', to: 'translateX(-100%)' }, { transform: 'rotate(90deg) translateY(-100%)', to: 'translateY(100%)' }, { transform: 'rotate(90deg) translateY(100%)', to: 'translateY(-100%)' }, { transform: 'rotate(45deg) translate(-100%, -100%)', to: 'translate(100%, 100%)' }, { transform: 'rotate(45deg) translate(100%, 100%)', to: 'translate(-100%, -100%)' }, { transform: 'rotate(-45deg) translate(-100%, 100%)', to: 'translate(100%, -100%)' }, { transform: 'rotate(-45deg) translate(100%, -100%)', to: 'translate(-100%, 100%)' } ];
        const randomDirection = directions[Math.floor(Math.random() * directions.length)];
        sunbeam.style.transform = randomDirection.transform;
        const keyframes = [ { transform: randomDirection.transform, opacity: 0 }, { opacity: 1, offset: 0.2 }, { opacity: 1, offset: 0.8 }, { transform: randomDirection.to, opacity: 0 } ];
        const animation = sunbeam.animate(keyframes, { duration: 2500, easing: 'ease-in-out' });
        animation.onfinish = () => { scheduleSunbeam(); };
    }
    function scheduleSunbeam() {
        const delay = getRandomInt(30000, 200000);
        setTimeout(activateSunbeam, delay);
    }
 
    function updateFavicon() {
        const favicon = document.getElementById('favicon');
        if (favicon) {
            if (isF9Mode) {
                favicon.href = "img/search.png";
            } else {
                favicon.href = "img/globe.png";
            }
        }
    }

    setTimeout(activateSunbeam, 15000);

    document.addEventListener('mousemove', (event) => {
        lastMouseMovement = Date.now();
        mouseX = event.clientX;
        mouseY = event.clientY;
    });

    document.addEventListener('DOMContentLoaded', function() {
        const clickArea = document.createElement('div');
        clickArea.classList.add('click-area');
        document.body.appendChild(clickArea);
        const leftMenu = document.querySelector('.left-menu');
        const socialIcons = document.querySelector('.social-icons');
        let isBottomCentered = false;
        const originalLeftParent = leftMenu.parentElement;
        const originalSocialParent = socialIcons.parentElement;
        const bottomContainer = document.createElement('div');
        bottomContainer.classList.add('bottom-centered-container');
        bottomContainer.style.display = 'none';
        document.body.appendChild(bottomContainer);
        function loadState() {
            try {
                const settings = JSON.parse(localStorage.getItem('pageSettings')) || {};
                if (settings.isBottomCentered) {
                    isBottomCentered = false;
                    toggleButtonsPosition();
                }
            } catch (e) {
                console.error('Ошибка загрузки настроек:', e);
            }
        }
        function saveState() {
            try {
                const settings = JSON.parse(localStorage.getItem('pageSettings')) || {};
                settings.isBottomCentered = isBottomCentered;
                localStorage.setItem('pageSettings', JSON.stringify(settings));
            } catch (e) {
                console.error('Ошибка сохранения настроек:', e);
            }
        }
        function toggleButtonsPosition() {
            const leftMenuVisible = window.getComputedStyle(leftMenu).display !== 'none';
            const socialIconsVisible = window.getComputedStyle(socialIcons).display !== 'none';
            if (!leftMenuVisible || !socialIconsVisible) {
                return;
            }
            if (!isBottomCentered) {
                bottomContainer.appendChild(leftMenu);
                bottomContainer.appendChild(socialIcons);
                leftMenu.classList.add('in-bottom-row');
                socialIcons.classList.add('in-bottom-row');
                bottomContainer.style.display = 'flex';
            } else {
                originalLeftParent.insertBefore(leftMenu, originalLeftParent.firstChild);
                originalSocialParent.appendChild(socialIcons);
                leftMenu.classList.remove('in-bottom-row');
                socialIcons.classList.remove('in-bottom-row');
                bottomContainer.style.display = 'none';
            }
            isBottomCentered = !isBottomCentered;
            saveState();
        }
        clickArea.addEventListener('click', function(e) {
            e.preventDefault();
            toggleButtonsPosition();
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F10') {
                e.preventDefault();
                toggleButtonsPosition();
            }
        });
        loadState();
    });

    function isValidCoordinates(x, y) {
        return ( typeof x === 'number' && typeof y === 'number' && !isNaN(x) && !isNaN(y) && x !== 5632576.166001884 && y !== 7286391.274432113 );
    }

async function handlePkkButtonClick(layers = encodeURIComponent('36048,36328,36329,36049')) {
        const searchText = document.getElementById('searchText').value;
        const cadastralNumber = searchText.trim();

        if (!searchText || !isValidCadastralNumber(searchText)) {
            const textToCopyInitial = searchText || '';
            copyToClipboard(textToCopyInitial, () => {
                window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
            });
            return;
        }

        try {
            const apiUrl = `https://nspd.gov.ru/api/geoportal/v2/search/geoportal?thematicSearchId=1&query=${cadastralNumber}`;
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.code === 204) {
                copyToClipboard(searchText, () => {
                    window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
                });
                return;
            }

            if (data.data?.features?.length > 0) {
                const feature = data.data.features[0];
                const geometry = feature.geometry;
                let coordinates;
                if (geometry.type === 'Polygon') {
                    coordinates = geometry.coordinates[0][0];
                } else if (geometry.type === 'Point') {
                    coordinates = geometry.coordinates;
                } else {
                    throw new Error('Неподдерживаемый тип геометрии');
                }
                const [x, y] = coordinates;
                if (x.toString().includes("5632576") || y.toString().includes("5632576")) {
                    copyToClipboard(searchText, () => {
                        window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
                    });
                } else {
              
                    const mapUrl = `https://nspd.gov.ru/map?query=${encodeURIComponent(cadastralNumber)}&zoom=20&coordinate_x=${x}&coordinate_y=${y}&theme_id=1&is_copy_url=true&active_layers=${layers}`;
                    copyToClipboard(searchText, () => {
                        window.open(mapUrl, '_blank', 'noopener,noreferrer');
                    });
                }
            } else {
                copyToClipboard(searchText, () => {
                    window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
                });
            }
        } catch (error) {
            copyToClipboard(searchText, () => {
                window.open('https://nspd.gov.ru/map', '_blank', 'noopener,noreferrer');
            });
        }
    }

    document.getElementById('pkkButton').addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const buttonWidth = rect.width;
        const textWidth = this.querySelector('span').offsetWidth;
        const textLeft = (buttonWidth - textWidth) / 2;
        const textRight = textLeft + textWidth;
        const rightEdgeThreshold = buttonWidth * 0.85;

        if (mouseX < textLeft) {
            this.style.backgroundColor = 'red';
            this.dataset.layers = encodeURIComponent('36048,36328,36329,36049,36315');
        } else if (mouseX > textRight) {
            if (mouseX > rightEdgeThreshold) {
                this.style.backgroundColor = '#ff13f0';
                this.dataset.layers = encodeURIComponent('36048,36328,36329,36049,37578');
            } else {
                this.style.backgroundColor = '#7f00ff';
                this.dataset.layers = encodeURIComponent('36048,36328,36329,36049,36071');
            }
        } else {
            this.style.backgroundColor = '';
            this.dataset.layers = encodeURIComponent('36048,36328,36329,36049');
        }
    });

    document.getElementById('pkkButton').addEventListener('mouseleave', function(e) {
        this.style.backgroundColor = '';
        delete this.dataset.layers;
    });

    document.getElementById('pkkButton').addEventListener('click', function(e) {
        e.preventDefault();
        const layers = this.dataset.layers || encodeURIComponent('36048,36328,36329,36049');
        handlePkkButtonClick(layers);
    });

    document.querySelector('#rosreestrDropdown a[href="https://lk.rosreestr.ru/request-access-egrn/property-search"]').addEventListener('click', function(e) {
        e.preventDefault();
        const searchTextValue = document.getElementById('searchText').value;
        const linkUrl = 'https://lk.rosreestr.ru/request-access-egrn/property-search';
        const openRosreestrLink = () => {
            window.open(linkUrl, '_blank', 'noopener,noreferrer');
        };
        copyToClipboard(searchTextValue, openRosreestrLink);
    });
        
    document.getElementById('kadastrmapButton').addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const buttonWidth = rect.width;
        const leftEdgeThreshold = buttonWidth * 0.2;
        const text = document.getElementById('searchText').value;

        if (mouseX < leftEdgeThreshold) {
            this.style.backgroundColor = '#FF46A2';
            this.querySelector('span').textContent = 'RosreestrDoc';
            this.dataset.specialUrl = 'map.ru';
        } else {
            this.style.backgroundColor = '';
            this.querySelector('span').textContent = 'Н.Реестр';
            delete this.dataset.specialUrl;
        }
    });

    document.getElementById('kadastrmapButton').addEventListener('mouseleave', function(e) {
        this.style.backgroundColor = '';
        this.querySelector('span').textContent = 'Н.Реестр'; 
        delete this.dataset.specialUrl;
    });

    document.getElementById('kadastrmapButton').addEventListener('click', function(e) {
        e.preventDefault();
        const text = document.getElementById('searchText').value;
        const openRosreestrDocLink = () => {
            window.open('https://rosreestr-doc.ru/кадастровая_карта', '_blank', 'noopener,noreferrer');
        };

        if (this.dataset.specialUrl === 'map.ru') {
            copyToClipboard(text, openRosreestrDocLink);
        } else {
            if (isValidCadastralNumber(text)) {
                const formattedText = text.replace(/:/g, ':');
                window.open(`https://kadastrcheck.ru/search/${formattedText}`, '_blank', 'noopener,noreferrer');
            } else {
                window.open('https://kadastrcheck.ru/search?query=' + encodeURIComponent(text) , '_blank', 'noopener,noreferrer');
            }
        }
    });
    
    document.getElementById('addressKadastrmapButton').addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const buttonWidth = rect.width;
        const leftEdgeThreshold = buttonWidth * 0.2;
        const text = document.getElementById('searchText').value;

        if (mouseX < leftEdgeThreshold) {
            this.style.backgroundColor = '#FF46A2';
            this.querySelector('span').textContent = 'Map.Ru';
            this.dataset.specialUrl = 'https://map.ru/pkk?kad='+ encodeURIComponent(text);
        } else {
            this.style.backgroundColor = '';
            this.querySelector('span').textContent = 'Н.Реестр';
            delete this.dataset.specialUrl;
        }
    });
    
async function checkAndShowClipboardInstructions() {
    if (!navigator.permissions || !navigator.clipboard) {
        showInfoModal('Проверка невозможна', '<p>Ваш браузер не поддерживает API для проверки разрешений.</p>');
        return;
    }

    let readStatusHtml = '';
    let writeStatusHtml = '';

    // --- Проверка разрешения на ЧТЕНИЕ (clipboard-read) ---
    try {
        const readPermission = await navigator.permissions.query({ name: 'clipboard-read', allowWithoutGesture: false });
        let statusText = '';
        switch (readPermission.state) {
            case 'granted': statusText = '<strong style="color: green;">РАЗРЕШЕНО</strong>'; break;
            case 'denied': statusText = '<strong style="color: red;">ЗАБЛОКИРОВАНО</strong>'; break;
            case 'prompt': statusText = '<strong style="color: orange;">БУДЕТ ЗАПРОШЕНО</strong>'; break;
        }
        readStatusHtml = `<p><strong>Чтение из буфера обмена:</strong> ${statusText}</p>`;
    } catch (e) {
        readStatusHtml = `<p><strong>Чтение из буфера обмена:</strong> <span style="color: red;">Ошибка проверки</span></p>`;
    }

    // --- Проверка разрешения на ЗАПИСЬ (clipboard-write) ---
    try {
        // Используем метод тестовой записи, т.к. permissions.query для write ненадежен в Chrome
        await navigator.clipboard.writeText(' ');
        writeStatusHtml = `<p><strong>Запись в буфер обмена:</strong> <strong style="color: green;">РАЗРЕШЕНО</strong></p>`;
    } catch (err) {
        writeStatusHtml = `<p><strong>Запись в буфер обмена:</strong> <strong style="color: red;">ЗАБЛОКИРОВАНО</strong></p>`;
    }

    // --- Отображение результата ---
    const instructions = getClipboardInstructions();
    showInfoModal(
        'Статус доступа к буферу обмена',
        `<div>${readStatusHtml}${writeStatusHtml}</div>
         <hr style="margin: 15px 0;">
         <p>Если доступ заблокирован, используйте инструкцию ниже, чтобы его сбросить:</p>
         ${instructions}`
    );
}


document.addEventListener('keydown', function(e) {
    if (e.key === 'F6') {
        e.preventDefault();
        checkAndShowClipboardInstructions();
    }
});

searchInput.addEventListener('focus', pasteFromClipboardOnFocus);

document.body.addEventListener('click', requestClipboardReadPermission, { once: true });
document.body.addEventListener('keydown', requestClipboardReadPermission, { once: true });


    document.getElementById('addressKadastrmapButton').addEventListener('mouseleave', function(e) {
        this.style.backgroundColor = '';
        this.querySelector('span').textContent = 'Н.Реестр'; 
        delete this.dataset.specialUrl;
    });

    document.getElementById('addressKadastrmapButton').addEventListener('click', function(e) {
        e.preventDefault();
        const text = document.getElementById('searchText').value;
        const openAddressKadastrMapLink = () => {
            if (this.dataset.specialUrl) {
                window.open(this.dataset.specialUrl, '_blank', 'noopener,noreferrer');
            } else {
                window.open('https://kadastrcheck.ru/search?query=' + encodeURIComponent(text) , '_blank', 'noopener,noreferrer');
            }
        };
        copyToClipboard(text, openAddressKadastrMapLink);
    });

    const copyEmailIcon = document.getElementById('copyEmailIcon');
    if (copyEmailIcon) {
        copyEmailIcon.addEventListener('click', (e) => {
            e.preventDefault(); 
            const showSuccessAnimation = () => {
                const iconImg = copyEmailIcon.querySelector('img');
                const originalSrc = iconImg.src;
                iconImg.src = 'img/check-mark.png'; 
                copyEmailIcon.style.backgroundColor = '#28a745';
                setTimeout(() => {
                    iconImg.src = originalSrc;
                    copyEmailIcon.style.backgroundColor = 'white';
                }, 2000);
            };
            copyToClipboard('mapruapp@gmail.com', showSuccessAnimation);
        });
    }
    
    

    </script>
</body>
</html>
