<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–≥–ª–∞—Å–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–µ–≥–æ</title>

    <!-- External Libraries -->
    <script src="webfonts/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="webfonts/index.js"></script>
    <link rel="stylesheet" href="webfonts/all.min.css">
    <link rel="icon" href="img/sogl.png" type="image/png" />
    <style>
        /* --- –°–¢–ò–õ–ò (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; }
        .app-container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 2fr; gap: 30px; height: calc(100vh - 40px); }
        .control-panel { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; overflow-y: auto; }
        .document-preview { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; }
        .preview-header { padding: 20px 30px; border-bottom: 2px solid #f0f2f5; display: flex; justify-content: space-between; align-items: center; background: #fafbfc; flex-shrink: 0; }
        .preview-title { font-size: 18px; font-weight: 600; color: #2c3e50; }
        .document-content { flex-grow: 1; overflow-y: auto; padding: 30px; background-color: #f0f2f5; }
        .form-section { margin-bottom: 25px; }
        .section-title { font-size: 16px; font-weight: 600; color: #2c3e50; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db; display: flex; align-items: center; gap: 8px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; color: #34495e; font-size: 14px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px 15px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: all 0.3s ease; background: #fafbfc; }
        .form-group input:focus, .form-group textarea:focus { border-color: #3498db; background: white; outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
        .form-group textarea { min-height: 80px; resize: vertical; }
        .hint { font-size: 12px; color: #7f8c8d; margin-top: 5px; }
        .margin-controls { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px; }
        .margin-control-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .margin-control label { display: block; margin-bottom: 5px; font-size: 13px; color: #34495e; }
        .margin-control .slider-container { display: flex; align-items: center; gap: 10px; }
        .margin-control input[type="range"] { width: 100%; flex: 1; margin: 0; }
        .margin-control .value { background: #ecf0f1; padding: 4px 8px; border-radius: 4px; font-size: 12px; min-width: 45px; text-align: center; }
        .action-buttons { display: grid; gap: 12px; margin-top: 30px; }
        .btn { padding: 15px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .btn-success { background: linear-gradient(135deg, #27ae60, #219a52); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .btn-info { background: linear-gradient(135deg, #34b3db, #299fb9); color: white; }
        .btn-secondary { background: linear-gradient(135deg, #1abc9c, #16a085); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(52, 152, 219, 0.2); }
        #printableDocument { background: white; font-family: 'Times New Roman', Times, serif; font-size: 14pt; line-height: 1.6; color: #2c3e50; padding: 2cm; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.1); width: 100%; max-width: 21cm; height: auto; aspect-ratio: 210 / 297; outline: none; }
        #printableDocument p { text-align: justify; margin: 0.8em 0; text-indent: 1.5em; }
        #printableDocument .no-indent { text-indent: 0; }
        #printableDocument .center { text-align: center; text-indent: 0; }
        #printableDocument strong { font-weight: bold; }
        .field-line { display: inline-block; border-bottom: 1.5px solid #2c3e50; min-height: 1.2em; vertical-align: bottom; padding: 0 5px 2px 5px; margin: 0 3px; min-width: 20px; }
        .signature-section { margin-top: 3em; }
        .signature-line { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 2em; flex-wrap: wrap; gap: 1em; }
        .signature-left { display: flex; align-items: flex-end; gap: 10px; }
        .signature-right { display: flex; align-items: flex-end; gap: 5px; }
        @media print { @page { size: A4 portrait; margin: 0; } body { background: none; margin: 0; } .control-panel, .preview-header, .status-indicator, .ai-modal-overlay { display: none !important; } .app-container, .document-preview, .document-content { display: block !important; padding: 0 !important; margin: 0 !important; box-shadow: none !important; } #printableDocument { box-shadow: none !important; margin: 0; width: 21cm; height: 29.7cm; } }
        .status-indicator { position: fixed; top: 20px; right: 20px; padding: 10px 20px; background: #27ae60; color: white; border-radius: 25px; font-size: 14px; font-weight: 500; opacity: 0; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; pointer-events: none; }
        .status-indicator.show { opacity: 1; transform: translateY(0); }
        .status-indicator.error { background-color: #e74c3c; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="control-panel">
            <div class="form-section">
                <div class="section-title">üìù –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è</div>
                <div class="form-group"><label for="representativeFio">–§–ò–û –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è (—Ä–æ–¥–∏—Ç–µ–ª—è):</label><input type="text" id="representativeFio" placeholder=""></div>
                <div class="form-group"><label for="passportSeries">–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞:</label><input type="text" id="passportSeries" placeholder="" maxlength="4"></div>
                <div class="form-group"><label for="passportNumber">–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞:</label><input type="text" id="passportNumber" placeholder="" maxlength="6"></div>
                <div class="form-group"><label for="passportIssued">–í—ã–¥–∞–Ω (–∫–µ–º –∏ –∫–æ–≥–¥–∞):</label><textarea id="passportIssued" placeholder=""></textarea></div>
                <div class="form-group"><label for="representativeAddress">–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è:</label><textarea id="representativeAddress" placeholder=""></textarea></div>
            </div>
            <div class="form-section">
                <div class="section-title">üë∂ –î–∞–Ω–Ω—ã–µ —Ä–µ–±–µ–Ω–∫–∞</div>
                 <div class="form-group"><label for="childFio">–§–ò–û —Ä–µ–±–µ–Ω–∫–∞ (–≤ —Ä–æ–¥–∏—Ç–µ–ª—å–Ω–æ–º –ø–∞–¥–µ–∂–µ):</label><input type="text" id="childFio" placeholder=""><div class="hint">–£–∫–∞–∂–∏—Ç–µ –≤ –ø–∞–¥–µ–∂–µ "–∫–æ–≥–æ?" - –Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–≤–∞–Ω–æ–≤–∞ –ü–µ—Ç—Ä–∞ –°–∏–¥–æ—Ä–æ–≤–∏—á–∞"</div></div>
                <div class="form-group"><label for="birthYear">–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è:</label><input type="text" id="birthYear" placeholder="" maxlength="4"></div>
                <div class="form-group"><label for="childAddress">–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–±–µ–Ω–∫–∞:</label><textarea id="childAddress" placeholder=""></textarea></div>
                <div class="form-group"><label for="birthCertificateSeries">–°–µ—Ä–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏:</label><input type="text" id="birthCertificateSeries" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: II-–ö–ë"></div>
                <div class="form-group"><label for="birthCertificateNumber">–ù–æ–º–µ—Ä —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏:</label><input type="text" id="birthCertificateNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 725859"></div>
                <div class="form-group"><label for="birthCertificateIssued">–í—ã–¥–∞–Ω–æ (–∫–µ–º –∏ –∫–æ–≥–¥–∞):</label><textarea id="birthCertificateIssued" placeholder=""></textarea></div>
            </div>
            <div class="form-section">
                <div class="section-title">üè† –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∫–∞</div>
                <div class="form-group"><label for="cadastralNumber">–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä:</label><input type="text" id="cadastralNumber" placeholder=""></div>
                <div class="form-group"><label for="address">–ê–¥—Ä–µ—Å —É—á–∞—Å—Ç–∫–∞:</label><textarea id="address" placeholder=""></textarea></div>
            </div>

            <div class="form-section">
                <div class="section-title">üìè –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞</div>
                <div class="margin-controls">
                    <div class="margin-control-group"><div class="margin-control"><label>–õ–µ–≤–æ–µ:</label><div class="slider-container"><input type="range" id="marginLeft" min="1" max="4" value="2" step="0.1"><span class="value" id="marginLeftValue">2.0—Å–º</span></div></div><div class="margin-control"><label>–ü—Ä–∞–≤–æ–µ:</label><div class="slider-container"><input type="range" id="marginRight" min="1" max="4" value="2" step="0.1"><span class="value" id="marginRightValue">2.0—Å–º</span></div></div></div>
                    <div class="margin-control-group"><div class="margin-control"><label>–í–µ—Ä—Ö–Ω–µ–µ:</label><div class="slider-container"><input type="range" id="marginTop" min="1" max="4" value="2" step="0.1"><span class="value" id="marginTopValue">2.0—Å–º</span></div></div><div class="margin-control"><label>–ù–∏–∂–Ω–µ–µ:</label><div class="slider-container"><input type="range" id="marginBottom" min="1" max="4" value="2" step="0.1"><span class="value" id="marginBottomValue">2.0—Å–º</span></div></div></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-info" onclick="openAiModal()"><i class="fas fa-atom"></i> –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</button>
                 <button class="btn btn-primary" onclick="fillTemplate()"><i class="fas fa-pen-to-square"></i> –ó–∞–ø–æ–ª–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ –¥–∞–Ω–Ω—ã–º</button>
                <!-- NEW BUTTON FOR DOCX -->
                <button class="btn btn-secondary" onclick="generateDocx()"><i class="fas fa-file-word"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ DOCX</button>
                <button class="btn btn-success" onclick="printDocument()"><i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å</button>
                <button class="btn btn-warning" onclick="exportToJPG()"><i class="fas fa-file-image"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ JPG</button>
            </div>
        </div>

        <div class="document-preview">
            <div class="preview-header"><div class="preview-title">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</div></div>
            <div class="document-content"><div id="printableDocument" contenteditable="true"></div></div>
        </div>
    </div>

    <div class="status-indicator" id="statusIndicator"></div>
    <div id="aiDataExtractorModal" class="ai-modal-overlay" style="display: none;"></div>
    <div id="crop-image-modal" style="display:none;"></div>

    <script>
        // --- AI LOGIC SECTION (unchanged from your original code) ---
        function openAiModal() { /* ... */ }
        function closeAiModal() { /* ... */ }
        async function submitToAI() { /* ... */ }
        // All other AI, OCR, and image cropping functions are assumed to be here...
        
        // Helper function to get all form data
        function getFormData() {
            const data = {};
            const ids = [
                'representativeFio', 'passportSeries', 'passportNumber', 'passportIssued',
                'representativeAddress', 'childFio', 'birthYear', 'childAddress',
                'birthCertificateSeries', 'birthCertificateNumber', 'birthCertificateIssued',
                'cadastralNumber', 'address'
            ];
            ids.forEach(id => data[id] = document.getElementById(id).value.trim());
            return data;
        }

        // --- TEMPLATE AND EXPORT SECTION ---

        function updateMarginValue(rangeId, valueId) { /* ... same as your code ... */ }
        function updateDocumentMargins() { /* ... same as your code ... */ }
        function createField(value, width = '200px') { return value ? `<strong>${value}</strong>` : `<span class="field-line" style="min-width: ${width};">&nbsp;</span>`; }
        
        function fillTemplate() {
            const data = getFormData();
            const appendixText = (data.birthCertificateSeries || data.birthCertificateNumber) 
                ? `–∫–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ ${data.birthCertificateSeries ? `—Å–µ—Ä–∏—è <strong>${data.birthCertificateSeries}</strong>` : ''} ${data.birthCertificateNumber ? `‚Ññ <strong>${data.birthCertificateNumber}</strong>` : ''}` 
                : `–∫–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ ${createField('', '300px')}`;

            document.getElementById('printableDocument').innerHTML = `
                <p class="center"><strong>–°–û–ì–õ–ê–°–ò–ï</strong></p>
                <p class="center"><strong>–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–µ–≥–æ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞</strong></p>
                <p>–Ø, ${createField(data.representativeFio, '300px')},</p>
                <p class="no-indent">–ø–∞—Å–ø–æ—Ä—Ç —Å–µ—Ä–∏—è ${createField(data.passportSeries, '80px')} ‚Ññ ${createField(data.passportNumber, '120px')} –≤—ã–¥–∞–Ω</p>
                <p class="no-indent">${createField(data.passportIssued, '100%')}</p>
                <p class="no-indent">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ –∞–¥—Ä–µ—Å—É:</p>
                <p class="no-indent">${createField(data.representativeAddress, '100%')}</p>
                <p>—è–≤–ª—è—é—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–º ${createField(data.childFio, '300px')} ${createField(data.birthYear, '60px')} –≥.—Ä.,</p>
                <p class="no-indent">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ(–æ–π) –ø–æ –∞–¥—Ä–µ—Å—É:</p>
                <p class="no-indent">${createField(data.childAddress, '100%')}</p>
                <p class="no-indent">–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ —Å–µ—Ä–∏—è ${createField(data.birthCertificateSeries, '80px')}</p>
                <p class="no-indent">‚Ññ ${createField(data.birthCertificateNumber, '120px')}, –≤—ã–¥–∞–Ω–Ω–æ–≥–æ</p>
                <p class="no-indent">${createField(data.birthCertificateIssued, '100%')}</p>
                <p>–Ø –¥–∞—é —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –º–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ ${createField(data.childFio, '300px')} –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ —Å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º ${createField(data.cadastralNumber, '180px')}, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø–æ –∞–¥—Ä–µ—Å—É:</p>
                <p class="no-indent">${createField(data.address, '100%')}</p>
                <p>–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –Ω–∞–º –Ω–∞ –ø—Ä–∞–≤–µ –æ–±—â–µ–π –¥–æ–ª–µ–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∏–º(–µ—é) –∞–∫—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–∞—á—É –≤ –æ—Ä–≥–∞–Ω –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ –∑–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ —Å—Ç. 26 –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∫–æ–¥–µ–∫—Å–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.</p>
                <div class="signature-section">
                    <p class="no-indent">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ${appendixText}</p> 
                    <div class="signature-line">
                        <div class="signature-left"><span>–ü–æ–¥–ø–∏—Å—å</span><span class="field-line" style="min-width: 200px;">&nbsp;</span></div>
                        <div class="signature-right"><span>¬´</span><span class="field-line" style="min-width: 40px;">&nbsp;</span><span>¬ª</span><span class="field-line" style="min-width: 120px;">&nbsp;</span><span>2025 –≥.</span></div>
                    </div>
                </div>`;
            showStatus('–®–∞–±–ª–æ–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω');
        }
        
        // --- NEW DOCX EXPORT FUNCTION ---
        async function generateDocx() {
            showStatus('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DOCX —Ñ–∞–π–ª–∞...');
            const { Document, Packer, Paragraph, TextRun, AlignmentType, UnderlineType } = window.docx;
            
            const data = getFormData();
            
            // Helper to create bold text runs or underlined placeholders
            const createDocxField = (value, placeholderLength = 30) => {
                return value ? new TextRun({ text: value, bold: true }) : new TextRun({ text: " ".repeat(placeholderLength), underline: { type: UnderlineType.SINGLE } });
            };

            const docChildren = [
                new Paragraph({ alignment: AlignmentType.CENTER, children: [new TextRun({ text: "–°–û–ì–õ–ê–°–ò–ï", bold: true })] }),
                new Paragraph({ alignment: AlignmentType.CENTER, spacing: { after: 200 }, children: [new TextRun({ text: "–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–µ–≥–æ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞", bold: true })] }),
                
                new Paragraph({ indent: { firstLine: 709 }, children: [new TextRun("–Ø, "), createDocxField(data.representativeFio, 40)] }),
                new Paragraph({ children: [
                    new TextRun("–ø–∞—Å–ø–æ—Ä—Ç —Å–µ—Ä–∏—è "), createDocxField(data.passportSeries, 6),
                    new TextRun(" ‚Ññ "), createDocxField(data.passportNumber, 10),
                    new TextRun(" –≤—ã–¥–∞–Ω")
                ]}),
                new Paragraph({ children: [createDocxField(data.passportIssued, 70)] }),
                new Paragraph({ text: "–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ –∞–¥—Ä–µ—Å—É:" }),
                new Paragraph({ children: [createDocxField(data.representativeAddress, 70)] }),
                
                new Paragraph({ indent: { firstLine: 709 }, children: [
                    new TextRun("—è–≤–ª—è—é—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–º "), createDocxField(data.childFio, 40),
                    new TextRun(" "), createDocxField(data.birthYear, 6),
                    new TextRun(" –≥.—Ä.,")
                ]}),
                new Paragraph({ text: "–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ(–æ–π) –ø–æ –∞–¥—Ä–µ—Å—É:" }),
                new Paragraph({ children: [createDocxField(data.childAddress, 70)] }),
                new Paragraph({ children: [
                    new TextRun("–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ —Å–µ—Ä–∏—è "), createDocxField(data.birthCertificateSeries, 8)
                ]}),
                new Paragraph({ children: [
                    new TextRun("‚Ññ "), createDocxField(data.birthCertificateNumber, 12),
                    new TextRun(", –≤—ã–¥–∞–Ω–Ω–æ–≥–æ")
                ]}),
                new Paragraph({ children: [createDocxField(data.birthCertificateIssued, 70)] }),

                new Paragraph({ indent: { firstLine: 709 }, children: [
                    new TextRun("–Ø –¥–∞—é —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —É—á–∞—Å—Ç–∏–µ –º–æ–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ "), createDocxField(data.childFio, 40),
                    new TextRun(" –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ —Å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º "), createDocxField(data.cadastralNumber, 25),
                    new TextRun(", —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –ø–æ –∞–¥—Ä–µ—Å—É:")
                ]}),
                new Paragraph({ children: [createDocxField(data.address, 70)] }),
                new Paragraph({ text: "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –Ω–∞–º –Ω–∞ –ø—Ä–∞–≤–µ –æ–±—â–µ–π –¥–æ–ª–µ–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∏–º(–µ—é) –∞–∫—Ç–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–∞—á—É –≤ –æ—Ä–≥–∞–Ω –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ –∑–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–µ–º–µ–ª—å–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ —Å—Ç. 26 –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∫–æ–¥–µ–∫—Å–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏.", indent: { firstLine: 709 }, alignment: AlignmentType.JUSTIFIED }),
                
                // --- Signature section ---
                new Paragraph({ text: "", spacing: { before: 400 } }),
                (() => {
                    const appendixChildren = [new TextRun("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –∫–æ–ø–∏—è —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ ")];
                    if (data.birthCertificateSeries) appendixChildren.push(new TextRun({ text: `—Å–µ—Ä–∏—è ${data.birthCertificateSeries}`, bold: true }));
                    if (data.birthCertificateNumber) appendixChildren.push(new TextRun({ text: ` ‚Ññ ${data.birthCertificateNumber}`, bold: true }));
                    if (!data.birthCertificateSeries && !data.birthCertificateNumber) appendixChildren.push(createDocxField("", 40));
                    return new Paragraph({ children: appendixChildren });
                })(),
                
                new Paragraph({
                    spacing: { before: 400 },
                    children: [
                        new TextRun("–ü–æ–¥–ø–∏—Å—å "), new TextRun({ text: " ".repeat(40), underline: { type: UnderlineType.SINGLE } }),
                        new TextRun({ text: "\t¬´", }), new TextRun({ text: " ".repeat(5), underline: { type: UnderlineType.SINGLE } }),
                        new TextRun({ text: "¬ª ", }), new TextRun({ text: " ".repeat(20), underline: { type: UnderlineType.SINGLE } }),
                        new TextRun({ text: " 2025 –≥." }),
                    ],
                    tabStops: [{ type: docx.TabStopType.RIGHT, position: docx.TabStopPosition.MAX }]
                })
            ];

            const doc = new Document({
                styles: { paragraphStyles: [{ id: "Normal", name: "Normal", run: { font: "Times New Roman", size: 28 } }] }, // 14pt
                sections: [{ properties: { page: { 
                    margin: { 
                        top: (document.getElementById('marginTop').value * 720 / 2.54), 
                        right: (document.getElementById('marginRight').value * 720 / 2.54), 
                        bottom: (document.getElementById('marginBottom').value * 720 / 2.54), 
                        left: (document.getElementById('marginLeft').value * 720 / 2.54) 
                    } 
                }}, children: docChildren }]
            });

            Packer.toBlob(doc).then(blob => {
                saveAs(blob, "–°–æ–≥–ª–∞—Å–∏–µ_–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è.docx");
                showStatus('–§–∞–π–ª DOCX —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
            }).catch(err => {
                console.error(err);
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ DOCX —Ñ–∞–π–ª–∞!', true);
            });
        }


        // --- UTILITY AND INITIALIZATION FUNCTIONS ---
        function printDocument() { window.print(); }
        function exportToJPG() { /* ... same as your code ... */ }
        function showStatus(message, isError = false) { /* ... same as your code ... */ }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Your existing event listeners
            updateMarginValue('marginLeft', 'marginLeftValue');
            updateMarginValue('marginRight', 'marginRightValue');
            updateMarginValue('marginTop', 'marginTopValue');
            updateMarginValue('marginBottom', 'marginBottomValue');
            
            // Re-adding event listener for AI modal paste if you have it
            const aiDataInput = document.getElementById('ai-data-input');
            if(aiDataInput) aiDataInput.addEventListener('paste', handleAiModalPaste);
            
            fillTemplate();
            updateDocumentMargins();
        });

        // --- All other AI and image crop functions from your original code ---
        function handleAiModalPaste(e) { /* ... */ }
        function performOcrForImage(base64DataUrl) { /* ... */ }
        function populateForm(data) { /* ... */ }
        function fileToBase64(file) { /* ... */ }
        function showCropModal(imageFile) { /* ... */ }
    </script>
</body>
</html>